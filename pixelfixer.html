<!DOCTYPE html>
<html lang="en">
<head>
    <script>
      window.SHC_API_BASE_URL = "https://api.secondhandcell.com/";
    </script>
<meta charset="UTF-8" />
  <title>Google Pixel Image URL Injector</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 1.5rem;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    h1 { margin-top: 0; font-size: 1.6rem; }
    .card {
      background: #020617;
      border-radius: 0.75rem;
      border: 1px solid #1f2937;
      padding: 1rem 1.25rem;
      margin-bottom: 1rem;
      box-shadow: 0 18px 40px rgba(15,23,42,0.7);
    }
    label { font-size: 0.9rem; color: #9ca3af; }
    input[type="file"] {
      margin-top: 0.3rem;
      margin-bottom: 1rem;
    }
    textarea {
      width: 100%;
      min-height: 280px;
      background: #020617;
      border: 1px solid #374151;
      border-radius: 0.5rem;
      padding: 0.75rem;
      color: #e5e7eb;
      resize: vertical;
      font-family: monospace;
      font-size: 0.9rem;
      white-space: pre;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 0.5rem 1.1rem;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #0b1120;
      margin-right: 0.5rem;
    }
    button:disabled { opacity: 0.5; cursor: default; }
    .badge {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #111827;
      border: 1px solid #1f2937;
      margin-right: 0.3rem;
      margin-bottom: 0.25rem;
    }
    .ok { border-color: #22c55e; color: #bbf7d0; }
    a.download-link {
      display: inline-block;
      margin-top: 0.75rem;
      text-decoration: none;
      color: #38bdf8;
    }
  </style>
</head>

<body>
  <h1>Google Pixel Image URL Injector</h1>

  <div class="card">
    <label>
      1Ô∏è‚É£ Upload XML file  
      <input type="file" id="xmlFile" accept=".xml" />
    </label>

    <div class="muted">
      This tool will:<br>
      ‚Ä¢ Detect Google models<br>
      ‚Ä¢ Match slugs ‚Üí image filenames<br>
      ‚Ä¢ Inject <code>&lt;imageUrl&gt;</code> tags (no extension)<br>
      ‚Ä¢ Export a pretty-printed updated XML  
    </div>

    <button id="injectBtn" disabled>üîÅ Inject Image URLs</button>
    <button id="downloadBtn" disabled>üíæ Download Updated XML</button>
    <div id="status" style="margin-top:0.5rem; font-size:0.85rem; color:#9ca3af;"></div>

    <div id="mappingInfo" style="margin-top:1rem;"></div>
    <a id="downloadLink" class="download-link" style="display:none;">Download XML</a>
  </div>

  <div class="card">
    <label>Updated XML Preview:</label>
    <textarea id="xmlPreview" readonly></textarea>
  </div>

<script>
  // Your slug ‚Üí filename mapping (these filenames are from your screenshot)
  const slugToFilename = {
    "7-pro":       "gp7.webp",
    "8":           "gp8.webp",
    "8a":          "gp8a.webp",
    "8-pro":       "gp8p.webp",
    "9":           "gp9.webp",
    "9a":          "gp9a.webp",
    "9-pro":       "gp9p.webp",
    "9-pro-fold":  "gp9pfold.webp",
    "9-pro-xl":    "gp9pxl.webp",
    "10":          "gp10.webp",
    "10-pro":      "gp10p.webp",
    "10-pro-fold": "gp10pfold.webp",
    "10-pro-xl":   "gp10pxl.png"
  };

  // FINAL prefix (no extension will be added)
  const FULL_PREFIX =
    "https://raw.githubusercontent.com/ToratYosef/BuyBacking/main/google/assets/";

  const xmlFileInput = document.getElementById("xmlFile");
  const injectBtn = document.getElementById("injectBtn");
  const downloadBtn = document.getElementById("downloadBtn");
  const previewEl = document.getElementById("xmlPreview");
  const statusEl = document.getElementById("status");
  const mappingInfo = document.getElementById("mappingInfo");
  const downloadLink = document.getElementById("downloadLink");

  let originalFileName = "updated.xml";
  let xmlText = "";
  let updatedXml = "";
  let downloadUrl = null;

  function showMapping() {
    mappingInfo.innerHTML =
      Object.entries(slugToFilename)
        .map(([slug, file]) =>
          `<span class="badge ok">${slug} ‚Üí ${file.replace(/\.[^/.]+$/, "")}</span>`
        )
        .join(" ");
  }
  showMapping();

  xmlFileInput.addEventListener("change", () => {
    const file = xmlFileInput.files[0];
    if (!file) return;

    originalFileName = file.name;
    const reader = new FileReader();

    reader.onload = e => {
      xmlText = e.target.result;
      previewEl.value = xmlText;
      injectBtn.disabled = false;
      downloadBtn.disabled = true;
      statusEl.textContent = "XML loaded. Ready to inject image URLs.";
    };

    reader.readAsText(file);
  });

  function formatXml(xml) {
    const PADDING = "  ";
    const reg = /(>)(<)(\/*)/g;
    let xmlStr = xml.replace(reg, "$1\n$2$3");
    let pad = 0;
    return xmlStr.split("\n").map(line => {
      if (!line.trim()) return "";
      if (line.match(/^<\/\w/)) pad--;
      const indent = PADDING.repeat(Math.max(pad, 0));
      if (line.match(/^<\w([^>]*[^/])?>.*$/) && !line.startsWith("</") && !line.endsWith("/>")) {
        pad++;
      }
      return indent + line;
    }).join("\n");
  }

  injectBtn.addEventListener("click", () => {
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(xmlText, "application/xml");

    if (xmlDoc.getElementsByTagName("parsererror").length) {
      statusEl.textContent = "‚ùå XML parse error.";
      return;
    }

    const models = [...xmlDoc.getElementsByTagName("model")];
    let googleCount = 0, updatedCount = 0;

    for (const model of models) {
      const parentDevice = model.getElementsByTagName("parentDevice")[0]?.textContent.trim();
      if (parentDevice !== "google") continue;

      googleCount++;

      const slug = model.getElementsByTagName("slug")[0]?.textContent.trim();
      const filename = slugToFilename[slug];
      if (!filename) continue;

      const noExt = filename.replace(/\.[^/.]+$/, ""); // remove extension

      let img = model.getElementsByTagName("imageUrl")[0];
      if (!img) {
        img = xmlDoc.createElement("imageUrl");
        model.insertBefore(img, model.firstChild);
      }

      img.textContent = FULL_PREFIX + noExt;
      updatedCount++;
    }

    const serializer = new XMLSerializer();
    updatedXml = serializer.serializeToString(xmlDoc);
    updatedXml = '<?xml version="1.0" encoding="UTF-8"?>\n' + formatXml(updatedXml);

    previewEl.value = updatedXml;

    if (downloadUrl) URL.revokeObjectURL(downloadUrl);
    downloadUrl = URL.createObjectURL(new Blob([updatedXml], { type: "application/xml" }));

    downloadLink.href = downloadUrl;
    downloadLink.download = originalFileName.replace(/\.xml$/, "") + "-updated.xml";
    downloadLink.style.display = "inline-block";

    downloadBtn.disabled = false;

    statusEl.textContent = `‚úÖ Updated ${updatedCount}/${googleCount} Google models.`;
  });

  downloadBtn.addEventListener("click", () => downloadLink.click());
</script>

</body>
</html>
