<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>secondhandcell Template Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .container { max-width: 800px; }
        .input-group label { font-weight: 600; }
        .input-group input, .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            margin-top: 0.25rem;
        }
        .output-box {
            background-color: #f1f5f9;
            border: 1px dashed #94a3b8;
            padding: 1.5rem;
            border-radius: 0.75rem;
        }
    </style>
    
    <link rel="stylesheet" href="/assets/css/site-chrome.css">
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen p-8">
<!-- Site Header -->
<header class="site-header" data-site-header>
    <div class="site-header__inner site-header__inner--centered">
        <div class="logo-container-left">
            <a href="/" class="logo-link" aria-label="SecondHandCell home">
                <img src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/assets/logo.png" alt="SecondHandCell Logo" class="logo-image" onerror="this.onerror=null;this.src='https://placehold.co/200x64/ffffff/1e293b?text=SecondHandCell';">
            </a>
        </div>
        <div class="logo-text-container-center">
            <div class="logo-wordmark">
                <span class="logo-wordmark__primary">Second</span><span class="logo-wordmark__accent">HandCell</span>
            </div>
            <p class="logo-tagline">Turn Your Old <span>Phone Into Cash!</span></p>
        </div>
        <nav class="header-auth-nav" aria-label="Account navigation">
            <div id="authStatusContainer" class="site-header__auth-wrapper">
                <a href="#" id="loginNavBtn" class="site-header__login">Login/Sign Up</a>
                <div id="userMonogram" class="user-monogram hidden"></div>
                <div id="authDropdown" class="auth-dropdown hidden">
                    <a href="/my-account.html" class="auth-dropdown__link">My Account</a>
                    <button id="logoutBtn" type="button" class="auth-dropdown__button btn-red-logout">Logout</button>
                </div>
            </div>
        </nav>
    </div>
</header>
<section class="ship48-banner" data-ship48-banner hidden>
    <div class="ship48-banner__inner">
        <p class="ship48-banner__message" title="Email label orders sent within 48 hours get +$10 with SHIP48 when you send within 48h.">
            <strong>SHIP48</strong> Email label orders sent within 48h earn +$10 with code <span class="ship48-banner__code">SHIP48</span>. Email label only. <span class="ship48-banner__counter" data-ship48-counter></span>
            <span class="ship48-banner__status" data-ship48-status></span>
        </p>
        <div class="ship48-banner__actions">
            <button type="button" class="ship48-banner__apply" data-ship48-apply>Apply SHIP48</button>
            <button type="button" class="ship48-banner__start" data-ship48-start>Start my quote now</button>
        </div>
    </div>
    <button type="button" class="ship48-banner__dismiss" aria-label="Dismiss Ship48 promo" data-ship48-dismiss>&times;</button>
</section>

    <div class="container mx-auto bg-white p-8 rounded-xl shadow-lg">
        <h1 class="text-4xl font-extrabold text-center text-indigo-700 mb-8">secondhandcell Template Creator</h1>
        <p class="text-center text-lg text-slate-600 mb-8">
            Fill out the form below to generate a new HTML file for a device page.
        </p>

        <form id="templateForm" class="space-y-6">
            <div class="input-group">
                <label for="company">Company</label>
                <input type="text" id="company" value="Apple" required>
            </div>
            <div class="input-group">
                <label for="model">Device Model</label>
                <input type="text" id="model" value="iPhone 16 Pro Max" required>
            </div>
            <div class="input-group">
                <label for="image">Image URL</label>
                <input type="url" id="image" value="https://raw.githubusercontent.com/ToratYosef/BuyBacking/main/iphone/assets/i16pm.webp" required>
            </div>
            <div class="input-group">
                <label class="block text-xl font-bold text-slate-800 mb-4">Storage Options and Pricing</label>
                <div id="pricingInputs" class="space-y-4">
                    <div class="flex items-center space-x-4">
                        <label for="storage1" class="w-1/3">128GB</label>
                        <input type="number" id="price1" placeholder="Unlocked price" value="400" required>
                    </div>
                    <div class="flex items-center space-x-4">
                        <label for="storage2" class="w-1/3">256GB</label>
                        <input type="number" id="price2" placeholder="Unlocked price" value="500" required>
                    </div>
                    <div class="flex items-center space-x-4">
                        <label for="storage3" class="w-1/3">512GB</label>
                        <input type="number" id="price3" placeholder="Unlocked price" value="600" required>
                    </div>
                    <div class="flex items-center space-x-4">
                        <label for="storage4" class="w-1/3">1TB</label>
                        <input type="number" id="price4" placeholder="Unlocked price" value="800" required>
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label for="carrierLockedDeduction">Carrier-Locked Deduction</label>
                <input type="number" id="carrierLockedDeduction" value="25" required>
                <p class="text-sm text-slate-500 mt-1">This amount will be subtracted from the quote if the device is not unlocked.</p>
            </div>
            <div class="input-group">
                <label for="noPowerDeduction">No Power Deduction (%)</label>
                <input type="number" id="noPowerDeduction" value="50" required>
                <p class="text-sm text-slate-500 mt-1">Percentage of the quote to deduct if the device doesn't power on.</p>
            </div>
            <div class="input-group">
                <label for="notFunctionalDeduction">Not Functional Deduction (%)</label>
                <input type="number" id="notFunctionalDeduction" value="25" required>
                <p class="text-sm text-slate-500 mt-1">Percentage of the quote to deduct if the device isn't fully functional.</p>
            </div>
            <div class="input-group">
                <label class="block text-xl font-bold text-slate-800 mb-2">Cosmetic Deductions</label>
                <div class="space-y-2">
                    <div class="flex items-center space-x-4">
                        <label for="flawlessDeduction" class="w-1/3">Flawless</label>
                        <input type="number" id="flawlessDeduction" value="0" required>
                    </div>
                    <div class="flex items-center space-x-4">
                        <label for="goodDeduction" class="w-1/3">Good</label>
                        <input type="number" id="goodDeduction" value="15" required>
                    </div>
                    <div class="flex items-center space-x-4">
                        <label for="fairDeduction" class="w-1/3">Fair</label>
                        <input type="number" id="fairDeduction" value="25" required>
                    </div>
                    <div class="flex items-center space-x-4">
                        <label for="damagedDeduction" class="w-1/3">Damaged</label>
                        <input type="number" id="damagedDeduction" value="45" required>
                    </div>
                </div>
            </div>
            <button type="button" id="generateBtn" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg shadow-md hover:bg-indigo-700 transition duration-300">
                Generate HTML
            </button>
        </form>

        <div id="outputContainer" class="mt-8 hidden">
            <h2 class="text-2xl font-bold mb-4">Generated HTML</h2>
            <div class="relative">
                <textarea id="outputHtml" rows="20" readonly class="w-full text-sm font-mono output-box overflow-auto"></textarea>
                <button id="copyBtn" class="absolute top-4 right-4 bg-slate-200 text-slate-600 p-2 rounded-md hover:bg-slate-300">
                    <i class="fa-solid fa-copy"></i>
                </button>
            </div>
            <p id="copyMessage" class="text-green-600 mt-2 hidden">Copied to clipboard!</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('templateForm');
            const generateBtn = document.getElementById('generateBtn');
            const outputContainer = document.getElementById('outputContainer');
            const outputHtml = document.getElementById('outputHtml');
            const copyBtn = document.getElementById('copyBtn');
            const copyMessage = document.getElementById('copyMessage');

            generateBtn.addEventListener('click', () => {
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const company = document.getElementById('company').value;
                const model = document.getElementById('model').value;
                const image = document.getElementById('image').value;
                const carrierDeduction = parseInt(document.getElementById('carrierLockedDeduction').value);
                const noPowerDeduction = parseInt(document.getElementById('noPowerDeduction').value) / 100;
                const notFunctionalDeduction = parseInt(document.getElementById('notFunctionalDeduction').value) / 100;

                const prices = {
                    '128GB': parseInt(document.getElementById('price1').value),
                    '256GB': parseInt(document.getElementById('price2').value),
                    '512GB': parseInt(document.getElementById('price3').value),
                    '1TB': parseInt(document.getElementById('price4').value),
                };
                
                const cosmeticDeductions = {
                    'flawless': parseInt(document.getElementById('flawlessDeduction').value),
                    'good': parseInt(document.getElementById('goodDeduction').value),
                    'fair': parseInt(document.getElementById('fairDeduction').value),
                    'damaged': parseInt(document.getElementById('damagedDeduction').value),
                };

                const formattedHtml = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>secondhandcell - Sell ${model}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/brands.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .carrier-option input[type="radio"],
        .payment-option input[type="radio"],
        .shipping-option input[type="radio"] { display: none; }
        .carrier-option label, .payment-option label, .shipping-option label {
            cursor: pointer; border: 2px solid transparent; border-radius: 0.75rem;
            transition: all 0.2s ease-in-out; display: flex; flex-direction: column;
            align-items: center; justify-content: center; height: 100%; text-align: center;
        }
        .carrier-option input[type="radio"]:checked + label, .payment-option input[type="radio"]:checked + label, .shipping-option input[type="radio"]:checked + label {
            border-color: #4f46e5; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2); transform: scale(1.02); background-color: #e0e7ff;
        }
        .carrier-option label:hover, .payment-option label:hover, .shipping-option label:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;
        }
        .modal { transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; opacity: 0; visibility: hidden; }
        .modal.is-visible { opacity: 1; visibility: visible; }
        .modal-content { transform: translateY(-20px); transition: transform 0.3s ease-out; }
        .modal.is-visible .modal-content { transform: translateY(0); }
        #quoteModal { transition: opacity 0.4s ease-out, transform 0.4s ease-out, visibility 0.4s ease-out; opacity: 0; transform: scale(0.9); visibility: hidden; }
        #quoteModal.is-visible { opacity: 1; transform: scale(1); visibility: visible; }
        .custom-checkbox input[type="checkbox"] { display: none; }
        .custom-checkbox .checkmark {
            display: inline-block; width: 1.25rem; height: 1.25rem; border: 2px solid #94a3b8;
            border-radius: 0.25rem; position: relative; transition: all 0.2s ease; flex-shrink: 0;
        }
        .custom-checkbox input[type="checkbox"]:checked + .checkmark { background-color: #4f46e5; border-color: #4f46e5; }
        .custom-checkbox input[type="checkbox"]:checked + .checkmark::after {
            content: ''; position: absolute; top: 50%; left: 50%; width: 0.5rem; height: 1rem;
            border: solid white; border-width: 0 3px 3px 0; transform: translate(-50%, -60%) rotate(45deg);
        }
        .btn-primary-blue {
            background-color: #2563eb; color: white; padding: 1rem 2rem; border-radius: 9999px;
            font-weight: 700; font-size: 1.125rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease; transform: scale(1); display: flex; align-items: center; justify-content: center;
            border: none; cursor: pointer;
        }
        .btn-primary-blue:hover { background-color: #1d4ed8; transform: scale(1.05); }
        .btn-primary-blue:focus { outline: none; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.5); }
        .btn-secondary-green {
            background-color: #22c55e; color: white; padding: 1rem 2rem; border-radius: 9999px;
            font-weight: 700; font-size: 1.125rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease; transform: scale(1); display: flex; align-items: center; justify-content: center;
            border: none; cursor: pointer;
        }
        .btn-secondary-green:hover { background-color: #16a34a; transform: scale(1.05); }
        .btn-secondary-green:focus { outline: none; box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.5); }
        .btn-google-style {
            display: flex; align-items: center; justify-content: center; width: 100%; background-color: white;
            color: #475569; padding: 0.75rem 1rem; border-radius: 0.5rem; border: 1px solid #cbd5e1;
            font-weight: 600; transition: all 0.3s ease; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); cursor: pointer;
        }
        .btn-google-style:hover { background-color: #f8fafc; }
        .btn-dark-slate {
            width: 100%; background-color: #1e293b; color: white; padding: 0.75rem 1rem;
            border-radius: 0.5rem; font-weight: 600; transition: all 0.3s ease; border: none; cursor: pointer;
        }
        .btn-dark-slate:hover { background-color: #0f172a; }
        .btn-red-logout {
            display: block; width: 100%; text-align: left; padding: 0.5rem 1rem;
            font-size: 0.875rem; color: #dc2626; background-color: transparent; border: none;
            transition: background-color 0.2s ease; cursor: pointer;
        }
        .btn-red-logout:hover { background-color: #fef2f2; }
        .btn-primary-indigo {
            background-color: #4f46e5; color: white; padding: 1rem 2rem; border-radius: 9999px;
            font-weight: 700; font-size: 1.125rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease; transform: scale(1); display: flex; align-items: center; justify-content: center;
            border: none; cursor: pointer;
        }
        .btn-primary-indigo:hover { background-color: #4338ca; transform: scale(1.05); }
        .btn-primary-indigo:focus { outline: none; box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.5); }
        .btn-disabled {
            opacity: 0.6; cursor: not-allowed; background-color: #94a3b8 !important; box-shadow: none; transform: none;
        }
        @media (max-width: 1023px) {
            .main-content-layout { flex-direction: column-reverse; }
            .quote-display-mobile-first { order: -1; margin-bottom: 2rem; }
            .main-content-layout > div:nth-child(1) { margin-top: 2rem; }
        }
        @media (min-width: 1024px) {
            .lg\\:text-left .question-group .flex { justify-content: flex-start; }
            .quote-display-mobile-first { order: unset; }
        }
        .highlight-missing { border-color: #ef4444 !important; box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5) !important; }
        .carrier-option input[type="radio"]:not(:checked) + label.highlight-missing, .payment-option input[type="radio"]:not(:checked) + label.highlight-missing, .shipping-option input[type="radio"]:not(:checked) + label.highlight-missing {
            border-color: #ef4444 !important; box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5) !important;
        }
        .custom-checkbox input[type="checkbox"]:not(:checked) + .checkmark.highlight-missing {
            border-color: #ef4444 !important; box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5) !important;
        }
        .user-monogram {
            display: flex; align-items: center; justify-content: center; width: 2.5rem; height: 2.5rem;
            border-radius: 9999px; background-color: #e0e7ff; color: #4338ca; font-weight: 700;
            font-size: 1.125rem; cursor: pointer; user-select: none;
        }
        .auth-dropdown {
            position: absolute; right: 0; margin-top: 0.5rem; width: 12rem; background-color: white;
            border-radius: 0.375rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding-top: 0.25rem; padding-bottom: 0.25rem; z-index: 20;
        }
    </style>
    
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen flex flex-col">


    <main class="flex-grow container mx-auto px-4 py-12">
        <div class="bg-white p-8 rounded-3xl shadow-xl flex flex-col lg:flex-row items-center justify-center gap-12 main-content-layout">
            <div class="w-full lg:w-2/5 text-center quote-display-mobile-first">
                <div class="relative w-full max-w-sm mx-auto mb-6 rounded-3xl shadow-lg overflow-hidden transform transition-transform duration-500 hover:scale-105">
                    <img src="${image}" alt="${model}" class="w-full h-full object-cover">
                </div>
                <div class="bg-indigo-600 text-white p-6 rounded-2xl shadow-lg hidden" id="mainQuoteDisplay">
                    <h2 class="text-3xl font-extrabold mb-2">Your Instant Quote</h2>
                    <p class="text-5xl font-extrabold" id="finalQuoteAmountMain">$0</p>
                    <p class="text-sm mt-2 opacity-80">Final offer subject to certified inspection.</p>
                </div>
            </div>

            <div class="w-full lg:w-3/5 text-center lg:text-left">
                <h1 class="text-4xl font-extrabold text-slate-900 mb-4">Sell Your ${model}</h1>
                <p class="text-lg text-slate-600 mb-8 max-w-xl mx-auto lg:mx-0">
                    Ready to sell your ${model}? Get an instant, competitive quote for your device today.
                    We offer a quick, transparent, and hassle-free process with flexible shipping options and certified inspection.
                </p>

                <div class="mb-8" id="carrierSection">
                    <label class="block text-xl font-bold text-slate-800 mb-4">1. Select Your Carrier</label>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4" id="carrierOptions">
                        <div class="carrier-option">
                            <input type="radio" id="att" name="carrier" value="ATT">
                            <label for="att" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200">
                                <i class="fa-solid fa-signal text-3xl text-indigo-600 mb-2"></i>
                                <span class="block text-slate-700 font-medium">AT&T</span>
                            </label>
                        </div>
                        <div class="carrier-option">
                            <input type="radio" id="tmobile" name="carrier" value="TMobile">
                            <label for="tmobile" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200">
                                <i class="fa-solid fa-mobile-screen-button text-3xl text-pink-600 mb-2"></i>
                                <span class="block text-slate-700 font-medium">T-Mobile</span>
                            </label>
                        </div>
                        <div class="carrier-option">
                            <input type="radio" id="verizon" name="carrier" value="Verizon">
                            <label for="verizon" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200">
                                <i class="fa-solid fa-wifi text-3xl text-red-600 mb-2"></i>
                                <span class="block text-slate-700 font-medium">Verizon</span>
                            </label>
                        </div>
                        <div class="carrier-option">
                            <input type="radio" id="unlocked" name="carrier" value="Unlocked">
                            <label for="unlocked" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200">
                                <i class="fa-solid fa-lock-open text-3xl text-teal-600 mb-2"></i>
                                <span class="block text-slate-700 font-medium">Unlocked</span>
                            </label>
                        </div>
                        <div class="carrier-option">
                            <input type="radio" id="other-carrier" name="carrier" value="Other">
                            <label for="other-carrier" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200">
                                <i class="fa-solid fa-globe text-3xl text-yellow-600 mb-2"></i>
                                <span class="block text-slate-700 font-medium">Other</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="mb-8" id="storageSection">
                    <label class="block text-xl font-bold text-slate-800 mb-4">2. Select Storage Amount</label>
                    <div class="flex justify-center lg:justify-start">
                        <select id="storage" class="mt-1 block w-full md:w-1/2 px-4 py-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Select Storage</option>
                            <option value="128GB">128GB</option>
                            <option value="256GB">256GB</option>
                            <option value="512GB">512GB</option>
                            <option value="1TB">1TB</option>
                        </select>
                    </div>
                </div>

                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6">3. Let’s determine the condition</h2>
                    <div class="space-y-6">
                        <div class="p-6 rounded-lg bg-slate-50 border border-slate-200 shadow-sm question-group" id="powerOnSection">
                            <p class="text-lg font-semibold text-slate-700 mb-3 text-center lg:text-left">Does the device power on?</p>
                            <div class="flex space-x-6 justify-center lg:justify-start" id="q1Options">
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="radio" name="q1_power_on" value="yes" class="form-radio text-indigo-600 h-5 w-5">
                                    <span class="ml-2 text-slate-700">Yes</span>
                                </label>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="radio" name="q1_power_on" value="no" class="form-radio text-indigo-600 h-5 w-5">
                                    <span class="ml-2 text-slate-700">No</span>
                                </label>
                            </div>
                        </div>
                        <div class="p-6 rounded-lg bg-slate-50 border border-slate-200 shadow-sm question-group" id="functionalSection">
                            <p class="text-lg font-semibold text-slate-700 mb-3 text-center lg:text-left flex items-center justify-center lg:justify-start">
                                Is the screen fully functional and free of defects?
                            </p>
                            <div id="functionalDetails" class="mt-2 p-3 bg-blue-50 rounded-md text-sm text-blue-800 text-left">
                                <p class="font-semibold mb-2">For "Fully Functional", all of these must work correctly:</p>
                                <ul class="list-disc list-inside ml-4 space-y-1">
                                    <li>Screen works and fully lights up (no dead pixels, discoloration, <strong>image burn or black dot/LCD dead pixels</strong>)</li>
                                    <li>All exterior buttons (power, volume, mute)</li>
                                    <li>Front/back camera and flashes</li>
                                    <li>Speakers and microphones</li>
                                    <li>Headphone jack and charging port</li>
                                    <li>Cellular, Wi-Fi, Bluetooth and GPS</li>
                                    <li>Touchscreen and voice commands</li>
                                    <li>Facial recognition and fingerprint sensor</li>
                                    <li>The battery health is sufficient, and the device can hold a charge</li>
                                </ul>
                            </div>
                            <div class="flex space-x-6 justify-center lg:justify-start" id="q2Options">
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="radio" name="q2_fully_functional" value="yes" class="form-radio text-indigo-600 h-5 w-5">
                                    <span class="ml-2 text-slate-700">Yes</span>
                                </label>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="radio" name="q2_fully_functional" value="no" class="form-radio text-indigo-600 h-5 w-5">
                                    <span class="ml-2 text-slate-700">No</span>
                                </label>
                            </div>
                        </div>
                        <div class="p-6 rounded-lg bg-slate-50 border border-slate-200 shadow-sm question-group" id="cosmeticSection">
                            <p class="text-lg font-semibold text-slate-700 mb-3 text-center lg:text-left">What’s the overall cosmetic condition?</p>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="q4Options">
                                <label class="flex items-center p-3 border border-slate-300 rounded-md hover:bg-indigo-50 transition-colors duration-200 cursor-pointer">
                                    <input type="radio" name="q4_cosmetic_condition" value="flawless" class="form-radio text-indigo-600 h-5 w-5">
                                    <span class="ml-2 text-slate-700">Flawless</span>
                                </label>
                                <label class="flex items-center p-3 border border-slate-300 rounded-md hover:bg-indigo-50 transition-colors duration-200 cursor-pointer">
                                    <input type="radio" name="q4_cosmetic_condition" value="good" class="form-radio text-indigo-600 h-5 w-5">
                                    <span class="ml-2 text-slate-700">Good</span>
                                </label>
                                <label class="flex items-center p-3 border border-slate-300 rounded-md hover:bg-indigo-50 transition-colors duration-200 cursor-pointer">
                                    <input type="radio" name="q4_cosmetic_condition" value="fair" class="form-radio text-indigo-600 h-5 w-5">
                                    <span class="ml-2 text-slate-700">Fair</span>
                                </label>
                                <label class="flex items-center p-3 border border-slate-300 rounded-md hover:bg-indigo-50 transition-colors duration-200 cursor-pointer">
                                    <input type="radio" name="q4_cosmetic_condition" value="damaged" class="form-radio text-indigo-600 h-5 w-5">
                                    <span class="ml-2 text-slate-700">Damaged</span>
                                </label>
                            </div>
                            <div id="cosmeticConditionDescription" class="mt-4 p-3 bg-slate-100 rounded-md text-sm text-slate-700 text-left hidden">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="cta-section" class="flex flex-col items-center">
                    <button id="getQuoteBtn" class="btn-primary-blue w-full max-w-sm">
                        Get My Instant Quote!
                    </button>
                    <div id="quoteMessage" class="mt-4 p-3 rounded-lg text-sm text-center hidden w-full max-w-sm"></div>
                </div>

                <div id="nextSteps" class="mt-12 hidden flex flex-col items-center gap-8">
                    <div id="paymentAndShipping" class="hidden w-full">
                        <hr class="my-10 border-slate-200">
                        <h2 class="text-2xl font-bold text-slate-800 mb-6">4. How would you like to get paid?</h2>
                        <div class="mb-8 grid grid-cols-2 md:grid-cols-4 gap-4" id="paymentOptions">
                            <div class="payment-option">
                                <input type="radio" id="venmo" name="payment_method" value="venmo">
                                <label for="venmo" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200">
                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48" viewBox="0 0 512 512" class="h-10 w-10 mb-2 mx-auto" aria-label="Venmo" role="img">
                                        <rect width="512" height="512" rx="15%" fill="#3396cd"/>
                                        <path d="m381.4 105.3c11 18.1 15.9 36.7 15.9 60.3 0 75.1-64.1 172.7-116.2 241.2h-118.8l-47.6-285 104.1-9.9 25.3 202.8c23.5-38.4 52.6-98.7 52.6-139.7 0-22.5-3.9-37.8-9.9-50.4z" fill="#fff"/>
                                    </svg>
                                    <span class="font-semibold block">Venmo</span>
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" id="zelle" name="payment_method" value="zelle">
                                <label for="zelle" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200">
                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48" viewBox="0 0 48 48" class="h-10 w-10 mb-2 mx-auto">
                                        <path fill="#a0f" d="M35,42H13c-3.866,0-7-3.134-7-7V13c0-3.866,3.134-7,7-7h22c3.866,0,7,3.134,7,7v22 C42,38.866,38.866,42,35,42z"></path><path fill="#fff" d="M17.5,18.5h14c0.552,0,1-0.448,1-1V15c0-0.552-0.448-1-1-1h-14c-0.552,0-1,0.448-1,1v2.5	C16.5,18.052,16.948,18.5,17.5,18.5z"></path><path fill="#fff" d="M17,34.5h14.5c0.552,0,1-0.448,1-1V31c0-0.552-0.448-1-1-1H17c-0.552,0-1,0.448-1,1v2.5	C16,34.052,16.448,34.5,17,34.5z"></path><path fill="#fff" d="M22.25,11v6c0,0.276,0.5,0.5,0.5,0.5h3.5c0.276,0,0.5-0.224,0.5-0.5v-6c0-0.276-0.224-0.5-0.5-0.5	h-3.5C22.474,10.5,22.25,10.724,22.25,11z"></path><path fill="#fff" d="M22.25,32v6c0,0.276,0.224,0.5,0.5,0.5h3.5c0.276,0,0.5-0.224,0.5-0.5v-6c0-0.276-0.224-0.5-0.5-0.5	h-3.5C22.474,31.5,22.25,31.724,22.25,32z"></path><path fill="#fff" d="M16.578,30.938H22l10.294-12.839c0.178-0.222,0.019-0.552-0.266-0.552H26.5L16.275,30.298	C16.065,30.553,16.247,30.938,16.578,30.938z"></path>
                                    </svg>
                                    <span class="font-semibold block">Zelle</span>
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" id="paypal" name="payment_method" value="paypal">
                                <label for="paypal" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200">
                                    <i class="fa-brands fa-paypal text-4xl text-blue-600 mb-2"></i>
                                    <span class="font-semibold block">PayPal</span>
                                </label>
                            </div>
                        </div>

                        <div id="venmoFields" class="mb-8 p-6 bg-slate-50 rounded-lg shadow-sm hidden">
                            <h3 class="text-lg font-semibold text-slate-700 mb-3">Venmo Details</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="venmoUsername" class="block text-sm font-medium text-slate-700">Venmo Username</label>
                                    <input type="text" id="venmoUsername" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="venmoUsernameConfirm" class="block text-sm font-medium text-slate-700">Verify Venmo Username</label>
                                    <input type="text" id="venmoUsernameConfirm" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                        </div>

                        <div id="zelleFields" class="mb-8 p-6 bg-slate-50 rounded-lg shadow-sm hidden">
                            <h3 class="text-lg font-semibold text-slate-700 mb-3">Zelle Details</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="zelleIdentifier" class="block text-sm font-medium text-slate-700">Zelle Email or Phone Number</label>
                                    <input type="text" id="zelleIdentifier" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                        </div>

                        <div id="paypalFields" class="mb-8 p-6 bg-slate-50 rounded-lg shadow-sm hidden">
                            <h3 class="text-lg font-semibold text-slate-700 mb-3">PayPal Details</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="paypalEmail" class="block text-sm font-medium text-slate-700">PayPal Email Address</label>
                                    <input type="email" id="paypalEmail" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-10 border-slate-200">
                        <h2 class="text-2xl font-bold text-slate-800 mb-6">5. How would you like to ship your device?</h2>
                        <div class="mb-8 grid grid-cols-1 md:grid-cols-2 gap-4" id="shippingOptions">
                            <div class="shipping-option">
                                <input type="radio" id="ship_kit" name="shipping_preference" value="ship_kit">
                                <label for="ship_kit" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200">
                                    <i class="fa-solid fa-box text-4xl text-indigo-600 mb-2"></i>
                                    <span class="font-semibold block">Ship Me a Box (Shipping Kit)</span>
                                </label>
                            </div>
                            <div class="shipping-option">
                                <input type="radio" id="email_label" name="shipping_preference" value="email_label">
                                <label for="email_label" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200">
                                    <i class="fa-solid fa-envelope text-4xl text-green-600 mb-2"></i>
                                    <span class="font-semibold block">Email Me a Label (I have a box)</span>
                                </label>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-slate-800 mb-6">6. Shipping Information</h2>
                        <div class="mb-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="fullName" class="block text-sm font-medium text-slate-700">Full Name</label>
                                <input type="text" id="fullName" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2">
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-slate-700">Email Address</label>
                                <input type="email" id="email" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2">
                            </div>
                            <div class="md:col-span-2">
                                <label for="streetAddress" class="block text-sm font-medium text-slate-700">Street Address</label>
                                <input type="text" id="streetAddress" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2">
                            </div>
                            <div>
                                <label for="city" class="block text-sm font-medium text-slate-700">City</label>
                                <input type="text" id="city" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2">
                            </div>
                            <div>
                                <label for="state" class="block text-sm font-medium text-slate-700">State</label>
                                <input type="text" id="state" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2">
                            </div>
                            <div>
                                <label for="zipCode" class="block text-sm font-medium text-slate-700">ZIP Code</label>
                                <input type="text" id="zipCode" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2">
                            </div>
                        </div>

                        <div id="orderOverview" class="mt-8 p-6 bg-indigo-50 rounded-xl shadow-inner">
                            <h3 class="text-2xl font-bold text-indigo-800 mb-4">Order Overview</h3>
                            <div class="space-y-2 text-lg text-slate-700">
                                <p><span class="font-semibold">Device:</span> <span id="overviewDevice">${model}</span></p>
                                <p><span class="font-semibold">Estimated Payout:</span> <span id="overviewQuote" class="text-indigo-600 font-bold">$0</span></p>
                                <p><span class="font-semibold">Payment Method:</span> <span id="overviewPayment">Not Selected</span></p>
                                <p><span class="font-semibold">Shipping Preference:</span> <span id="overviewShippingPreference">Not Selected</span></p>
                                <p><span class="font-semibold">Shipping Address:</span> <span id="overviewAddress">Not Entered</span></p>
                            </div>

                            <div class="mt-6 p-4 rounded-lg bg-white shadow-sm">
                                <label class="custom-checkbox flex items-start cursor-pointer">
                                    <input type="checkbox" id="termsAccepted">
                                    <span class="checkmark mt-1"></span>
                                    <span class="ml-4 text-sm text-slate-700">I accept the terms and conditions and certify that this device is not lost or stolen.</span>
                                </label>
                            </div>

                            <button id="sendPhoneBtn" class="btn-primary-indigo w-full mt-6">
                                Send Phone In Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="quoteModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.6);">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-md p-6 relative modal-content text-center">
            <h2 class="text-3xl font-extrabold text-indigo-800 mb-4">Your Instant Quote!</h2>
            <p class="text-5xl font-extrabold text-indigo-600 mb-4" id="finalQuoteAmountPopup">$0</p>
            <p class="text-md text-slate-600 mb-6">This is an estimate. Final offer subject to certified inspection.</p>
            <button id="quoteModalContinueBtn" class="btn-secondary-green w-full max-w-xs mx-auto">
                Continue
            </button>
        </div>
    </div>


    <div id="loginModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.6);">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-md p-6 relative modal-content">
            <button id="closeModalBtn" class="absolute top-3 right-3 text-slate-400 hover:text-slate-600 transition-colors duration-200">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold text-slate-800 mb-6 text-center">Your secondhandcell Account</h2>

            <div class="flex border-b border-slate-200 mb-6">
                <button id="loginTabBtn" class="flex-1 py-3 text-center text-lg font-medium border-b-2 border-transparent text-slate-500 hover:text-indigo-600 hover:border-indigo-600 transition-colors duration-200">Login</button>
                <button id="signupTabBtn" class="flex-1 py-3 text-center text-lg font-medium border-b-2 border-transparent text-slate-500 hover:text-indigo-600 hover:border-indigo-600 transition-colors duration-200">Sign Up</button>
            </div>

            <form id="loginForm" class="space-y-4">
                <p class="text-slate-600 text-center">Log in to continue with your order.</p>
                <button type="button" id="googleLoginBtn" class="btn-google-style">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google icon" class="w-5 h-5">
                    Login with Google
                </button>
                <div class="text-center text-slate-500 relative">
                    <span class="bg-white px-2 z-10 relative">or</span>
                    <hr class="absolute inset-0 top-1/2 border-slate-200 -z-10">
                </div>
                <div>
                    <label for="loginEmail" class="sr-only">Email Address</label>
                    <input type="email" id="loginEmail" placeholder="Email Address" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="loginPassword" class="sr-only">Password</label>
                    <input type="password" id="loginPassword" placeholder="Password" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" autocomplete="current-password">
                </div>
                <button type="submit" id="emailLoginBtn" class="btn-dark-slate">Login</button>
                <p class="text-center text-sm text-slate-600">Forgot your password? <a href="#" id="forgotPasswordLink" class="text-indigo-600 font-semibold hover:underline">Reset it here</a></p>
            </form>

            <form id="signupForm" class="space-y-4 hidden">
                <p class="text-slate-600 text-center">Create an account to complete your order.</p>
                <button type="button" id="googleSignupBtn" class="btn-google-style">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google icon" class="w-5 h-5">
                    Sign Up with Google
                </button>
                <div class="text-center text-slate-500 relative">
                    <span class="bg-white px-2 z-10 relative">or</span>
                    <hr class="absolute inset-0 top-1/2 border-slate-200 -z-10">
                </div>
                <div>
                    <label for="signupName" class="sr-only">Full Name</label>
                    <input type="text" id="signupName" placeholder="Full Name" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="signupEmail" class="sr-only">Email Address</label>
                    <input type="email" id="signupEmail" placeholder="Email Address" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="signupPassword" class="sr-only">Password</label>
                    <input type="password" id="signupPassword" placeholder="Password" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" autocomplete="new-password">
                </div>
                <div>
                    <label for="signupPhone" class="sr-only">Phone Number (Optional)</label>
                    <input type="tel" id="signupPhone" placeholder="Phone Number (Optional)" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <button type="submit" id="emailSignupBtn" class="btn-dark-slate">Sign Up</button>
                <p class="text-center text-sm text-slate-600">Already have an account? <a href="#" id="switchToLogin" class="text-indigo-600 font-semibold hover:underline">Log in here</a></p>
            </form>

            <form id="forgotPasswordForm" class="space-y-4 hidden">
                <p class="text-slate-600 text-center">Enter your email address to receive a password reset link.</p>
                <div>
                    <label for="forgotEmail" class="sr-only">Email Address</label>
                    <input type="email" id="forgotEmail" placeholder="Email Address" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <button type="submit" id="sendResetEmailBtn" class="btn-dark-slate">Send Reset Email</button>
                <p class="text-center text-sm text-slate-600">Remember your password? <a href="#" id="returnToLogin" class="text-indigo-600 font-semibold hover:underline">Return to Login</a></p>
            </form>
            <div id="authMessage" class="mt-4 p-3 rounded-lg text-sm text-center hidden w-full"></div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const auth = window.firebaseAuth;
            const GoogleAuthProvider = window.GoogleAuthProvider;
            const signInWithPopup = window.signInWithPopup;
            const signInWithEmailAndPassword = window.signInWithEmailAndPassword;
            const createUserWithEmailAndPassword = window.createUserWithEmailAndPassword;
            const signOut = window.signOut;
            const onAuthStateChanged = window.onAuthStateChanged;
            const updateProfile = window.updateProfile;
            const sendPasswordResetEmail = window.sendPasswordResetEmail;
            const db = window.firebaseDb;
            const serverTimestamp = window.firebaseServerTimestamp;

            const getQuoteBtn = document.getElementById('getQuoteBtn');
            const quoteMessage = document.getElementById('quoteMessage');
            const nextSteps = document.getElementById('nextSteps');
            const finalQuoteAmountMain = document.getElementById('mainQuoteDisplay');
            const finalQuoteAmountMainText = document.getElementById('finalQuoteAmountMain');
            const finalQuoteAmountPopup = document.getElementById('finalQuoteAmountPopup');
            const paymentAndShipping = document.getElementById('paymentAndShipping');
            const venmoFields = document.getElementById('venmoFields');
            const zelleFields = document.getElementById('zelleFields');
            const paypalFields = document.getElementById('paypalFields');
            const shippingOptions = document.getElementById('shippingOptions');
            const overviewShippingPreference = document.getElementById('overviewShippingPreference');
            const orderOverview = document.getElementById('orderOverview');
            const overviewQuote = document.getElementById('overviewQuote');
            const overviewPayment = document.getElementById('overviewPayment');
            const overviewAddress = document.getElementById('overviewAddress');
            const sendPhoneBtn = document.getElementById('sendPhoneBtn');
            const loginModal = document.getElementById('loginModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const loginTabBtn = document.getElementById('loginTabBtn');
            const signupTabBtn = document.getElementById('signupTabBtn');
            const loginNavBtn = document.getElementById('loginNavBtn');
            const quoteModal = document.getElementById('quoteModal');
            const quoteModalContinueBtn = document.getElementById('quoteModalContinueBtn');
            const authStatusContainer = document.getElementById('authStatusContainer');
            const userMonogram = document.getElementById('userMonogram');
            const authDropdown = document.getElementById('authDropdown');
            const logoutBtn = document.getElementById('logoutBtn');
            const functionalDetails = document.getElementById('functionalDetails');
            const cosmeticConditionDescription = document.getElementById('cosmeticConditionDescription');
            const googleLoginBtn = document.getElementById('googleLoginBtn');
            const emailLoginBtn = document.getElementById('emailLoginBtn');
            const loginEmailInput = document.getElementById('loginEmail');
            const loginPasswordInput = document.getElementById('loginPassword');
            const googleSignupBtn = document.getElementById('googleSignupBtn');
            const emailSignupBtn = document.getElementById('emailSignupBtn');
            const signupNameInput = document.getElementById('signupName');
            const signupEmailInput = document.getElementById('signupEmail');
            const signupPasswordInput = document.getElementById('signupPassword');
            const signupPhoneInput = document.getElementById('signupPhone');
            const authMessage = document.getElementById('authMessage');
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const switchToLogin = document.getElementById('switchToLogin');
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            const forgotEmailInput = document.getElementById('forgotEmail');
            const sendResetEmailBtn = document.getElementById('sendResetEmailBtn');
            const returnToLoginLink = document.getElementById('returnToLogin');
            const shippingInfoEmailInput = document.getElementById('email');
            
            let isUserLoggedIn = false;
            let currentUserId = null;
            let finalQuote = 0;

            function getRandomLightColor() {
                const hue = Math.floor(Math.random() * 360);
                const saturation = Math.floor(Math.random() * 30) + 70;
                const lightness = Math.floor(Math.random() * 20) + 70;
                return 'hsl(' + hue + ', ' + saturation + '%, ' + lightness + '%)';
            }

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    isUserLoggedIn = true;
                    currentUserId = user.uid;
                    loginNavBtn.classList.add('hidden');
                    userMonogram.classList.remove('hidden');

                    const displayName = user.displayName;
                    const email = user.email;
                    let initials = '';

                    if (displayName) {
                        initials = displayName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                    } else if (email) {
                        const username = email.split('@')[0];
                        const nameParts = username.split('.');
                        initials = nameParts.map(part => part.charAt(0)).join('').toUpperCase().substring(0, 2);
                    }

                    userMonogram.textContent = initials;
                    userMonogram.style.backgroundColor = getRandomLightColor();

                    hideLoginModal();

                    if (shippingInfoEmailInput && user.email) {
                        shippingInfoEmailInput.value = user.email;
                    }

                    if (finalQuote > 0 && nextSteps.classList.contains('hidden')) {
                        nextSteps.classList.remove('hidden');
                        paymentAndShipping.classList.remove('hidden');
                        updateOverview();
                    }
                } else {
                    isUserLoggedIn = false;
                    currentUserId = null;
                    loginNavBtn.classList.remove('hidden');
                    loginNavBtn.textContent = 'Login/Sign Up';
                    userMonogram.classList.add('hidden');
                    userMonogram.textContent = '';
                    authDropdown.classList.add('hidden');

                    if (shippingInfoEmailInput) {
                        shippingInfoEmailInput.value = '';
                    }
                }
            });
            userMonogram.addEventListener('click', (e) => {
                e.stopPropagation();
                authDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', (e) => {
                if (!authStatusContainer.contains(e.target)) {
                    authDropdown.classList.add('hidden');
                }
            });

            logoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                } catch (error) {
                    console.error("Logout error:", error);
                }
            });

            const BACKEND_URL = 'https://us-central1-buyback-a0f05.cloudfunctions.net/api';

            function showAuthMessage(msg, type) {
                authMessage.textContent = msg;
                authMessage.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
                if (type === 'error') {
                    authMessage.classList.add('bg-red-100', 'text-red-700');
                } else if (type === 'success') {
                    authMessage.classList.add('bg-green-100', 'text-green-700');
                } else if (type === 'info') {
                    authMessage.classList.add('bg-blue-100', 'text-blue-700');
                }
                authMessage.classList.remove('hidden');
            }

            function clearAuthMessage() {
                authMessage.classList.add('hidden');
                authMessage.textContent = '';
            }

            function showLoginModal() {
                loginModal.classList.add('is-visible');
                clearAuthMessage();
                showTab('login');
            }

            function hideLoginModal() {
                loginModal.classList.remove('is-visible');
            }

            function showTab(tabName) {
                clearAuthMessage();
                loginTabBtn.classList.remove('border-indigo-600', 'text-indigo-600');
                signupTabBtn.classList.remove('border-indigo-600', 'text-indigo-600');
                loginTabBtn.classList.add('border-transparent', 'text-slate-500');
                signupTabBtn.classList.add('border-transparent', 'text-slate-500');
                loginTabBtn.classList.remove('hidden');
                signupTabBtn.classList.remove('hidden');

                if (tabName === 'login') {
                    loginForm.classList.remove('hidden');
                    signupForm.classList.add('hidden');
                    forgotPasswordForm.classList.add('hidden');
                    loginTabBtn.classList.add('border-indigo-600', 'text-indigo-600');
                } else if (tabName === 'signup') {
                    signupForm.classList.remove('hidden');
                    loginForm.classList.add('hidden');
                    forgotPasswordForm.classList.add('hidden');
                    signupTabBtn.classList.add('border-indigo-600', 'text-indigo-600');
                } else if (tabName === 'forgotPassword') {
                    forgotPasswordForm.classList.remove('hidden');
                    loginForm.classList.add('hidden');
                    signupForm.classList.add('hidden');
                    loginTabBtn.classList.add('hidden');
                    signupTabBtn.classList.add('hidden');
                }
            }

            function showQuotePopup() {
                quoteModal.classList.add('is-visible');
            }

            function hideQuotePopup() {
                quoteModal.classList.remove('is-visible');
            }

            window.addEventListener('shc:ship48-start-order', () => {
                showQuotePopup();
            });

            closeModalBtn.addEventListener('click', hideLoginModal);
            loginModal.addEventListener('click', (e) => {
                if (e.target.id === 'loginModal') {
                    hideLoginModal();
                }
            });
            loginTabBtn.addEventListener('click', () => {
                showTab('login');
            });
            signupTabBtn.addEventListener('click', () => {
                showTab('signup');
            });
            loginNavBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showLoginModal();
            });
            switchToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                showTab('login');
            });
            returnToLoginLink.addEventListener('click', (e) => {
                e.preventDefault();
                showTab('login');
            });
            
            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                showTab('forgotPassword');
            });

            forgotPasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = forgotEmailInput.value;
                if (!email) {
                    showAuthMessage('Please enter your email address.', 'error');
                    return;
                }
                
                try {
                    clearAuthMessage();
                    showAuthMessage('Sending password reset email...', 'info');
                    await sendPasswordResetEmail(auth, email);
                    showAuthMessage('A password reset link has been sent to your email. Check your inbox and spam folder.', 'success');
                    forgotEmailInput.value = '';
                } catch (error) {
                    console.error("Password reset error:", error);
                    showAuthMessage('Password reset failed: ' + error.message, 'error');
                }
            });


            quoteModalContinueBtn.addEventListener('click', () => {
                hideQuotePopup();
                finalQuoteAmountMain.classList.remove('hidden');
                if (isUserLoggedIn) {
                    nextSteps.classList.remove('hidden');
                    paymentAndShipping.classList.remove('hidden');
                    updateOverview();
                } else {
                    showLoginModal();
                }
            });


            // --- Firebase Authentication Logic --- 

            const googleProvider = new GoogleAuthProvider();

            googleLoginBtn.addEventListener('click', async () => {
                try {
                    clearAuthMessage();
                    showAuthMessage('Signing in with Google...', 'info');
                    await signInWithPopup(auth, googleProvider);
                } catch (error) {
                    console.error("Google login error:", error);
                    showAuthMessage('Google login failed: ' + error.message, 'error');
                }
            });

            googleSignupBtn.addEventListener('click', async () => {
                try {
                    clearAuthMessage();
                    showAuthMessage('Signing up with Google...', 'info');
                    await signInWithPopup(auth, googleProvider);
                } catch (error) {
                    console.error("Google signup error:", error);
                    showAuthMessage('Google signup failed: ' + error.message, 'error');
                }
            });

            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = loginEmailInput.value;
                const password = loginPasswordInput.value;
                if (!email || !password) {
                    showAuthMessage('Please enter both email and password.', 'error');
                    return;
                }
                try {
                    clearAuthMessage();
                    showAuthMessage('Logging in...', 'info');
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    console.error("Email login error:", error);
                    showAuthMessage('Login failed: ' + error.message, 'error');
                }
            });

            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = signupNameInput.value;
                const email = signupEmailInput.value;
                const password = signupPasswordInput.value;
                const phone = signupPhoneInput.value;

                if (!name || !email || !password) {
                    showAuthMessage('Please enter your name, email, and password.', 'error');
                    return;
                }
                if (password.length < 6) {
                    showAuthMessage('Password should be at least 6 characters.', 'error');
                    return;
                }

                try {
                    clearAuthMessage();
                    showAuthMessage('Creating account...', 'info');
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await updateProfile(userCredential.user, {
                        displayName: name
                    });
                    showAuthMessage('Account created successfully! You are now logged in.', 'success');
                } catch (error) {
                    console.error("Email signup error:", error);
                    showAuthMessage('Sign up failed: ' + error.message, 'error');
                }
            });


            function showQuoteMessage(msg, type) {
                quoteMessage.textContent = msg;
                quoteMessage.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
                if (type === 'error') {
                    quoteMessage.classList.add('bg-red-100', 'text-red-700');
                } else if (type === 'success') {
                    quoteMessage.classList.add('bg-green-100', 'text-green-700');
                } else if (type === 'info') {
                    quoteMessage.classList.add('bg-blue-100', 'text-blue-700');
                }
                quoteMessage.classList.remove('hidden');
            }

            function clearQuoteMessage() {
                quoteMessage.classList.add('hidden');
                quoteMessage.textContent = '';
            }

            function clearHighlights() {
                document.querySelectorAll('.highlight-missing').forEach(el => {
                    el.classList.remove('highlight-missing');
                });
                document.querySelectorAll('.carrier-option label, .payment-option label, .shipping-option label').forEach(label => {
                    label.classList.remove('highlight-missing');
                });
                document.querySelectorAll('.custom-checkbox .checkmark').forEach(checkmark => {
                    checkmark.classList.remove('highlight-missing');
                });
            }

            function getFirstMissingRadioGroup(groupName, sectionId) {
                if (!document.querySelector('input[name="' + groupName + '"]:checked')) {
                    return document.getElementById(sectionId);
                }
                return null;
            }

            const cosmeticDescriptions = {
                'flawless': 'Looks new with no signs of use. This is the best condition a used device can be in. There are no scratches, scuffs, or any other cosmetic imperfections visible to the naked eye. The device appears as if it just came out of its original packaging, offering a pristine aesthetic and feel.',
                'good': 'There may be a few light scuffs or scratches that are smaller than the size of a pencil eraser. These minor imperfections are typically on the casing or screen, but do not affect the device\\'s functionality or overall aesthetic significantly. They are generally only noticeable upon close inspection and do not detract from the device\\'s premium feel.',
                'fair': 'There are noticeable scratches or scuffs on the front and back. These could include multiple visible scratches, minor dents, or paint chips on the frame or back glass. While these cosmetic issues are more prominent, they do not impede the device\\'s core functions, and the screen remains fully usable despite the marks.',
                'damaged': 'Major cosmetic damage includes being bent, chipped, dented, or sunbleached. This category also covers devices with significant wear and tear, deep scratches, or other substantial visual defects that clearly impact the device\\'s appearance. These issues are immediately apparent and go beyond normal wear, affecting the overall integrity and look of the device.'
            };

            document.querySelectorAll('input[name="q4_cosmetic_condition"]').forEach(radio => {
                radio.addEventListener('change', (event) => {
                    const selectedCondition = event.target.value;
                    const description = cosmeticDescriptions[selectedCondition];
                    if (description) {
                        cosmeticConditionDescription.textContent = description;
                        cosmeticConditionDescription.classList.remove('hidden');
                    } else {
                        cosmeticConditionDescription.classList.add('hidden');
                        cosmeticConditionDescription.textContent = '';
                    }
                });
            });

            getQuoteBtn.addEventListener('click', () => {
                clearQuoteMessage();
                clearHighlights();
                nextSteps.classList.add('hidden');
                paymentAndShipping.classList.add('hidden');
                finalQuoteAmountMain.classList.add('hidden');

                const selectedCarrier = document.querySelector('input[name="carrier"]:checked');
                const selectedStorage = document.getElementById('storage');
                const q1PowerOn = document.querySelector('input[name="q1_power_on"]:checked');
                const q2Functional = document.querySelector('input[name="q2_fully_functional"]:checked');
                const q4Cosmetic = document.querySelector('input[name="q4_cosmetic_condition"]:checked');

                let firstMissingElement = null;

                if (!selectedCarrier) {
                    document.getElementById('carrierOptions').classList.add('highlight-missing');
                    if (!firstMissingElement) firstMissingElement = document.getElementById('carrierSection');
                }
                if (selectedStorage.value === '') {
                    selectedStorage.classList.add('highlight-missing');
                    if (!firstMissingElement) firstMissingElement = selectedStorage;
                }
                if (!q1PowerOn) {
                    document.getElementById('q1Options').classList.add('highlight-missing');
                    if (!firstMissingElement) firstMissingElement = document.getElementById('powerOnSection');
                }
                if (!q2Functional) {
                    document.getElementById('q2Options').classList.add('highlight-missing');
                    if (!firstMissingElement) firstMissingElement = document.getElementById('functionalSection');
                }
                if (!q4Cosmetic) {
                    document.getElementById('q4Options').classList.add('highlight-missing');
                    if (!firstMissingElement) firstMissingElement = document.getElementById('cosmeticSection');
                }

                if (firstMissingElement) {
                    showQuoteMessage('Please answer all questions to get an accurate quote.', 'error');
                    firstMissingElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }

                let currentQuote = 0;
                const prices = {
                    '128GB': ${prices['128GB']},
                    '256GB': ${prices['256GB']},
                    '512GB': ${prices['512GB']},
                    '1TB': ${prices['1TB']},
                };
                currentQuote = prices[selectedStorage.value];

                if (selectedCarrier.value !== 'Unlocked') { currentQuote -= ${carrierDeduction}; }
                if (q1PowerOn.value === 'no') { currentQuote *= (1 - ${noPowerDeduction}); }
                if (q2Functional.value === 'no') { currentQuote *= (1 - ${notFunctionalDeduction}); }
                switch (q4Cosmetic.value) {
                    case 'damaged': currentQuote -= ${cosmeticDeductions.damaged}; break;
                    case 'fair': currentQuote -= ${cosmeticDeductions.fair}; break;
                    case 'good': currentQuote -= ${cosmeticDeductions.good}; break;
                    case 'flawless': currentQuote -= ${cosmeticDeductions.flawless}; break;
                }

                finalQuote = Math.max(0, currentQuote);
                finalQuoteAmountMainText.textContent = '$' + finalQuote.toFixed(2);
                finalQuoteAmountPopup.textContent = '$' + finalQuote.toFixed(2);

                showQuotePopup();
            });

            document.querySelectorAll('input[name="payment_method"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    venmoFields.classList.add('hidden');
                    zelleFields.classList.add('hidden');
                    paypalFields.classList.add('hidden');

                    document.querySelectorAll('.payment-option label').forEach(label => label.classList.remove('highlight-missing'));

                    const selectedMethod = e.target.value;
                    if (selectedMethod === 'venmo') {
                        venmoFields.classList.remove('hidden');
                    } else if (selectedMethod === 'zelle') {
                        zelleFields.classList.remove('hidden');
                    } else if (selectedMethod === 'paypal') {
                        paypalFields.classList.remove('hidden');
                    }
                    updateOverview();
                });
            });

            document.querySelectorAll('input[name="shipping_preference"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    document.querySelectorAll('.shipping-option label').forEach(label => label.classList.remove('highlight-missing'));
                    updateOverview();
                });
            });

            const shippingInputs = document.querySelectorAll('#paymentAndShipping input[type="text"], #paymentAndShipping input[type="email"]');
            shippingInputs.forEach(input => {
                input.addEventListener('input', updateOverview);
            });

            function updateOverview() {
                const selectedPayment = document.querySelector('input[name="payment_method"]:checked')?.value || 'Not Selected';
                const selectedShippingPreference = document.querySelector('input[name="shipping_preference"]:checked')?.value;
                const fullName = document.getElementById('fullName').value;
                const streetAddress = document.getElementById('streetAddress').value;
                const city = document.getElementById('city').value;
                const state = document.getElementById('state').value;
                const zipCode = document.getElementById('zipCode').value;

                overviewQuote.textContent = '$' + finalQuote.toFixed(2);
                overviewPayment.textContent = selectedPayment.charAt(0).toUpperCase() + selectedPayment.slice(1);
                
                let displayShippingPreferenceText = 'Not Selected';
                if (selectedShippingPreference === 'ship_kit') {
                    displayShippingPreferenceText = 'Shipping Kit Requested';
                } else if (selectedShippingPreference === 'email_label') {
                    displayShippingPreferenceText = 'Email Label Requested';
                }
                overviewShippingPreference.textContent = displayShippingPreferenceText;

                const fullAddress = [fullName, streetAddress, city, state, zipCode].filter(Boolean).join(', ');
                overviewAddress.textContent = fullAddress || 'Not Entered';
            }

            sendPhoneBtn.addEventListener('click', async () => {
                clearQuoteMessage();
                clearHighlights();

                const selectedPayment = document.querySelector('input[name="payment_method"]:checked');
                const selectedShippingPreference = document.querySelector('input[name="shipping_preference"]:checked');
                const termsAccepted = document.getElementById('termsAccepted');
                const fullName = document.getElementById('fullName');
                const email = document.getElementById('email');
                const streetAddress = document.getElementById('streetAddress');
                const city = document.getElementById('city');
                const state = document.getElementById('state');
                const zipCode = document.getElementById('zipCode');

                let firstMissingElement = null;

                if (!selectedPayment) {
                    const paymentOptionsContainer = document.getElementById('paymentOptions');
                    if (paymentOptionsContainer) {
                        paymentOptionsContainer.classList.add('highlight-missing');
                        if (!firstMissingElement) firstMissingElement = paymentOptionsContainer;
                    }
                } else {
                    if (selectedPayment.value === 'venmo') {
                        const venmoUsername = document.getElementById('venmoUsername');
                        const venmoUsernameConfirm = document.getElementById('venmoUsernameConfirm');
                        if (!venmoUsername.value) { venmoUsername.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = venmoUsername; }
                        if (!venmoUsernameConfirm.value || venmoUsername.value !== venmoUsernameConfirm.value) { venmoUsernameConfirm.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = venmoUsernameConfirm; }
                    } else if (selectedPayment.value === 'zelle') {
                        const zelleIdentifier = document.getElementById('zelleIdentifier');
                        if (!zelleIdentifier.value) { zelleIdentifier.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = zelleIdentifier; }
                    } else if (selectedPayment.value === 'paypal') {
                        const paypalEmail = document.getElementById('paypalEmail');
                        if (!paypalEmail.value) { paypalEmail.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = paypalEmail; }
                    }
                }

                if (!selectedShippingPreference) {
                    const shippingOptionsContainer = document.getElementById('shippingOptions');
                    if (shippingOptionsContainer) {
                        shippingOptionsContainer.classList.add('highlight-missing');
                        if (!firstMissingElement) firstMissingElement = shippingOptionsContainer;
                    }
                }

                if (!fullName.value) { fullName.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = fullName; }
                if (!email.value) { email.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = email; }
                if (!streetAddress.value) { streetAddress.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = streetAddress; }
                if (!city.value) { city.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = city; }
                if (!state.value) { state.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = state; }
                if (!zipCode.value) { zipCode.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = zipCode; }
                if (!termsAccepted.checked) {
                    document.querySelector('#orderOverview .checkmark').classList.add('highlight-missing');
                    if (!firstMissingElement) firstMissingElement = termsAccepted;
                }

                if (firstMissingElement) {
                    showQuoteMessage('Please fill out all required fields to proceed.', 'error');
                    firstMissingElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }
                
                sendPhoneBtn.disabled = true;
                sendPhoneBtn.textContent = 'Order Submitting...';
                sendPhoneBtn.classList.remove('btn-primary-indigo');
                sendPhoneBtn.classList.add('btn-disabled');

                const orderData = {
                    device: "${model}",
                    carrier: document.querySelector('input[name="carrier"]:checked').value,
                    storage: document.getElementById('storage').value,
                    condition_power_on: document.querySelector('input[name="q1_power_on"]:checked').value,
                    condition_functional: document.querySelector('input[name="q2_fully_functional"]:checked').value,
                    condition_cracks: 'Included in cosmetic condition',
                    condition_cosmetic: document.querySelector('input[name="q4_cosmetic_condition"]:checked').value,
                    estimatedQuote: finalQuote,
                    paymentMethod: selectedPayment.value,
                    shippingPreference: selectedShippingPreference.value,
                    paymentDetails: {},
                    shippingInfo: {
                        fullName: fullName.value,
                        email: email.value,
                        streetAddress: streetAddress.value,
                        city: city.value,
                        state: state.value,
                        zipCode: zipCode.value
                    },
                    termsAccepted: termsAccepted.checked,
                    userId: currentUserId,
                    createdAt: serverTimestamp()
                };

                if (selectedPayment.value === 'venmo') {
                    orderData.paymentDetails.venmoUsername = document.getElementById('venmoUsername').value;
                } else if (selectedPayment.value === 'zelle') {
                    orderData.paymentDetails.zelleIdentifier = document.getElementById('zelleIdentifier').value;
                } else if (selectedPayment.value === 'paypal') {
                    orderData.paymentDetails.paypalEmail = document.getElementById('paypalEmail').value;
                }

                try {
                    showQuoteMessage('Submitting your order...', 'info');
                    const response = await fetch(\`\${BACKEND_URL}/submit-order\`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(orderData),
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        throw new Error(result.error || 'Failed to submit order.');
                    }

                    showQuoteMessage('Your order has been submitted successfully! We will send a shipping label to your email shortly.', 'success');
                    
                    sendPhoneBtn.textContent = 'Order Submitted!';
                } catch (e) {
                    console.error("Error submitting order: ", e);
                    showQuoteMessage('There was an error submitting your order. Please try again.', 'error');
                    
                    sendPhoneBtn.disabled = false;
                    sendPhoneBtn.textContent = 'Send Phone In Now';
                    sendPhoneBtn.classList.remove('btn-disabled');
                    sendPhoneBtn.classList.add('btn-primary-indigo');
                }
            });
        });
    </script>
    <script type="module" src="/assets/js/pages/admin-public-html-gen.js"></script>

<!-- <script src="/assets/js/ship48-banner.js" defer></script> -->  <script type="module" src="/assets/js/global-auth.js" defer></script>
</body>
</html>
                `;

                outputHtml.value = formattedHtml.trim();
                outputContainer.classList.remove('hidden');
            });

            copyBtn.addEventListener('click', () => {
                outputHtml.select();
                document.execCommand('copy');
                copyMessage.classList.remove('hidden');
                setTimeout(() => copyMessage.classList.add('hidden'), 2000);
            });
        });
    </script>

    <script type="module" src="/assets/js/pages/admin-public-html-gen.js"></script>
</body>
</html>
