<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard</title>
    <link rel="stylesheet" href="/assets/css/admin-tailwind.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-W3BM2JC8');</script>
<!-- End Google Tag Manager -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17534255111"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'AW-17534255111');
            gtag('config', 'G-8JYPJDKSP8');
        </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@600;700&family=Inter:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Space Grotesk', sans-serif;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            background: radial-gradient(circle at 12% -10%, rgba(56, 189, 248, 0.22) 0%, rgba(8, 47, 73, 0.8) 32%, rgba(2, 6, 23, 1) 85%);
            color: #0f172a;
            padding: 0 16px 56px;
        }

        .main-content {
            margin: 48px auto;
            padding: 32px;
            color: #0f172a;
            width: 100%;
            max-width: 1320px;
            position: relative;
        }

        .main-content::before {
            content: '';
            position: absolute;
            inset: 0;
            z-index: -1;
            border-radius: 28px;
            background: linear-gradient(135deg, rgba(241, 245, 249, 0.9), rgba(226, 232, 240, 0.55));
            border: 1px solid rgba(148, 163, 184, 0.25);
            box-shadow: 0 45px 120px -60px rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(22px);
        }

        .search-container {
            position: relative;
            width: 300px;
        }

        .search-container input {
            width: 100%;
            padding: 10px 12px 10px 40px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            color: #0f172a;
            transition: all 0.2s ease;
        }

        .search-container i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            pointer-events: none;
        }

        .top-nav {
            position: sticky;
            top: -16px;
            z-index: 40;
            margin: -48px -32px 36px -32px;
            padding: 28px 36px;
            border-radius: 26px 26px 22px 22px;
            background: linear-gradient(120deg, rgba(15, 23, 42, 0.92), rgba(30, 64, 175, 0.82), rgba(2, 132, 199, 0.75));
            border: 1px solid rgba(148, 163, 184, 0.28);
            backdrop-filter: blur(22px);
            box-shadow: 0 35px 80px -55px rgba(15, 23, 42, 0.9);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 24px;
        }

        .top-nav > div:first-child {
            flex-grow: 1;
            padding-right: 20px;
        }

        .top-nav h1 {
            font-size: 28px;
            font-weight: 700;
            color: #f8fafc;
            letter-spacing: -0.02em;
        }

        .top-nav p {
            color: rgba(226, 232, 240, 0.75);
            font-size: 14px;
            margin-top: 2px;
            line-height: 1.5;
            max-width: 520px;
        }

        .top-nav-actions {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .top-nav-actions .quick-stat {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
            min-width: 120px;
            color: rgba(226, 232, 240, 0.9);
        }

        .top-nav-actions .quick-stat strong {
            font-size: 18px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.12);
            color: #f8fafc;
            border: none;
            border-radius: 10px;
            padding: 10px 16px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.22);
        }

        .admin-subnav {
            margin-top: 14px;
            display: inline-flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .admin-subnav__link {
            padding: 6px 12px;
            border-radius: 9999px;
            background: rgba(255, 255, 255, 0.08);
            color: rgba(226, 232, 240, 0.85);
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .admin-subnav__link:hover {
            background: rgba(255, 255, 255, 0.16);
            color: #ffffff;
        }

        .admin-subnav__link--active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.45), rgba(14, 165, 233, 0.45));
            color: #ffffff;
        }

        .insight-strip {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .insight-pill {
            background: rgba(15, 23, 42, 0.85);
            border: 1px solid rgba(148, 163, 184, 0.25);
            border-radius: 16px;
            padding: 18px;
            color: rgba(226, 232, 240, 0.9);
        }

        .insight-pill .label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: rgba(148, 163, 184, 0.9);
        }

        .insight-pill .value {
            font-size: 24px;
            font-weight: 700;
            margin-top: 8px;
        }

        .site-analytics-section {
            background: rgba(15, 23, 42, 0.82);
            border: 1px solid rgba(148, 163, 184, 0.25);
            border-radius: 22px;
            padding: 28px;
            box-shadow: 0 28px 70px -55px rgba(15, 23, 42, 0.9);
            color: rgba(226, 232, 240, 0.92);
        }

        .site-analytics-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 24px;
        }

        .site-analytics-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: #e0f2fe;
        }

        .site-analytics-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .site-analytics-controls select,
        .site-analytics-controls input {
            background: rgba(15, 23, 42, 0.92);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: rgba(226, 232, 240, 0.95);
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 13px;
        }

        .analytics-autorefresh-toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: rgba(226, 232, 240, 0.82);
        }

        .analytics-refresh-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(59, 130, 246, 0.2);
            color: #bfdbfe;
            border: 1px solid rgba(59, 130, 246, 0.35);
            border-radius: 12px;
            padding: 10px 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .analytics-kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 18px;
            margin-bottom: 28px;
        }

        .analytics-kpi-card {
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.28);
            border-radius: 16px;
            padding: 18px;
        }

        .analytics-main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .analytics-card {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 18px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            padding: 20px;
        }

        .analytics-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .analytics-card h3 {
            font-size: 18px;
            color: #e0f2fe;
            margin-bottom: 4px;
        }

        .analytics-top-table-wrapper {
            overflow: auto;
        }

        .analytics-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            color: rgba(226, 232, 240, 0.92);
        }

        .analytics-table th,
        .analytics-table td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.14);
            text-align: left;
        }

        .analytics-empty-state {
            color: rgba(148, 163, 184, 0.8);
            font-style: italic;
            padding: 18px 0;
        }

        .floating-chat-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2563eb, #38bdf8);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 18px 45px rgba(37, 99, 235, 0.4);
            border: none;
            cursor: pointer;
            z-index: 100;
        }

        .floating-chat-btn .unread-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: #fff;
            border-radius: 9999px;
            padding: 2px 8px;
            font-size: 10px;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .top-nav {
                flex-direction: column;
                align-items: flex-start;
                padding: 24px;
            }

            .top-nav-actions {
                width: 100%;
                flex-wrap: wrap;
                justify-content: space-between;
            }

            .search-container {
                width: 100%;
            }
        }
    </style>
</head>
<body data-admin-page="analytics">
    <div id="auth-loading-screen" style="position: fixed; inset: 0; z-index: 999; background: rgba(15, 23, 42, 0.95); display: flex; align-items: center; justify-content: center;">
        <div style="text-align: center;">
            <div class="loading-spinner" style="margin: 0 auto;"></div>
            <p style="margin-top: 20px; color: #64748b; font-weight: 600;">Checking authentication...</p>
        </div>
    </div>

    <main class="main-content">
        <div class="top-nav">
            <div>
                <h1>Traffic & Conversion Analytics</h1>
                <p>Understand how visitors navigate the funnel, which pages convert, and where attention is needed.</p>
                <nav class="admin-subnav">
                    <a class="admin-subnav__link" href="/admin/index.html">Orders</a>
                    <a class="admin-subnav__link admin-subnav__link--active" href="/admin/analytics/index.html">Analytics</a>
                    <a class="admin-subnav__link" href="/admin/aging/index.html">Aging</a>
                    <a class="admin-subnav__link" href="/admin/bulk-print/index.html">Bulk Print</a>
                </nav>
            </div>
            <div class="top-nav-actions">
                <div class="search-container">
                    <input type="text" id="search-orders" placeholder="Search orders, customers, tracking...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="time-display" id="current-time-date"></div>
                <div class="quick-stat" title="Orders that are not yet completed">
                    <span>Live Orders</span>
                    <strong id="live-orders-count">0</strong>
                </div>
                <div class="quick-stat" title="Average payout on completed orders">
                    <span>Avg. Payout</span>
                    <strong id="average-payout-amount">$0.00</strong>
                </div>
                <button class="logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </div>

        <div class="insight-strip">
            <div class="insight-pill">
                <span class="label">Orders Today</span>
                <span class="value" id="orders-today-count">0</span>
                <span class="subtext">New submissions</span>
            </div>
            <div class="insight-pill">
                <span class="label">Total Completed Payout</span>
                <span class="value" id="total-payout-amount">$0.00</span>
                <span class="subtext">Across closed orders</span>
            </div>
            <div class="insight-pill">
                <span class="label">Completion Rate</span>
                <span class="value" id="conversion-rate">0.0%</span>
                <span class="subtext">Quotes to payouts</span>
            </div>
            <div class="insight-pill">
                <span class="label">Devices Received</span>
                <span class="value" id="received-devices-count">0</span>
                <span class="subtext">Awaiting inspection</span>
            </div>
        </div>

        <section class="site-analytics-section" id="site-analytics">
            <div class="site-analytics-header">
                <div>
                    <h2>Site Analytics</h2>
                    <p>Monitor live traffic from the privacy-first tagger script.</p>
                </div>
                <div class="site-analytics-controls">
                    <select id="analytics-window-select">
                        <option value="15m">Past 15m</option>
                        <option value="30m">Past 30m</option>
                        <option value="1h">Past 1h</option>
                        <option value="6h">Past 6h</option>
                        <option value="24h" selected>Past 24h</option>
                        <option value="7d">Past 7d</option>
                    </select>
                    <select id="analytics-granularity-select">
                        <option value="auto" selected>Auto granularity</option>
                        <option value="minute">Minute</option>
                        <option value="hour">Hour</option>
                        <option value="day">Day</option>
                    </select>
                    <input type="text" id="analytics-path-input" placeholder="Filter by path (optional)" />
                    <label class="analytics-autorefresh-toggle">
                        <input type="checkbox" id="analytics-autorefresh-toggle" />
                        <span>Auto-refresh</span>
                    </label>
                    <button type="button" id="analytics-refresh-button" class="analytics-refresh-button">
                        <i class="fas fa-rotate-right"></i>
                        Refresh
                    </button>
                    <span class="analytics-status analytics-status--loading" id="analytics-status">Loading…</span>
                </div>
            </div>
            <div class="analytics-kpi-grid">
                <div class="analytics-kpi-card">
                    <span class="label">Pageviews</span>
                    <span class="value" id="analytics-kpi-pageviews">0</span>
                    <span class="subtext">Total views in window</span>
                </div>
                <div class="analytics-kpi-card">
                    <span class="label">Unique users</span>
                    <span class="value" id="analytics-kpi-uniques">0</span>
                    <span class="subtext">Distinct visitors</span>
                </div>
                <div class="analytics-kpi-card">
                    <span class="label">Active now</span>
                    <span class="value" id="analytics-kpi-active">0</span>
                    <span class="subtext">Sessions in last 5 min</span>
                </div>
                <div class="analytics-kpi-card">
                    <span class="label">Avg views / user</span>
                    <span class="value" id="analytics-kpi-avgviews">0.00</span>
                    <span class="subtext">Engagement efficiency</span>
                </div>
            </div>
            <div class="analytics-main-grid">
                <div class="analytics-card">
                    <div class="analytics-card-header">
                        <div>
                            <h3>Traffic trend</h3>
                            <p id="analytics-timeseries-subtitle">Rolling activity</p>
                        </div>
                    </div>
                    <div class="chart-wrapper chart-wrapper--trend">
                        <canvas id="analytics-timeseries-chart" height="140"></canvas>
                    </div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-card-header">
                        <div>
                            <h3>Top pages</h3>
                            <p>Most viewed content for the selected window</p>
                        </div>
                    </div>
                    <div class="analytics-top-table-wrapper">
                        <table class="analytics-table">
                            <thead>
                                <tr>
                                    <th>Path</th>
                                    <th>Views</th>
                                    <th>Uniques</th>
                                    <th>Share</th>
                                </tr>
                            </thead>
                            <tbody id="analytics-top-table">
                                <tr class="analytics-empty-row">
                                    <td colspan="4" class="analytics-empty-state" id="analytics-top-empty">Waiting for data…</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-card-header">
                        <div>
                            <h3>Top referrers</h3>
                            <p>Sources sending visitors during the selected window</p>
                        </div>
                    </div>
                    <div class="analytics-top-table-wrapper">
                        <table class="analytics-table">
                            <thead>
                                <tr>
                                    <th>Source</th>
                                    <th>Views</th>
                                    <th>Uniques</th>
                                    <th>Sample referrer</th>
                                </tr>
                            </thead>
                            <tbody id="analytics-referrer-table">
                                <tr class="analytics-empty-row">
                                    <td colspan="4" class="analytics-empty-state" id="analytics-referrer-empty">Waiting for data…</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-card-header">
                        <div>
                            <h3>Conversions by source</h3>
                            <p>Order confirmations tracked locally</p>
                        </div>
                        <div class="analytics-card-metric">
                            <span class="metric-value" id="analytics-conversion-total">0</span>
                            <span class="metric-label">Total conversions</span>
                        </div>
                    </div>
                    <div class="analytics-top-table-wrapper">
                        <table class="analytics-table">
                            <thead>
                                <tr>
                                    <th>Source</th>
                                    <th>Conversions</th>
                                    <th>Unique IPs</th>
                                </tr>
                            </thead>
                            <tbody id="analytics-conversion-table">
                                <tr class="analytics-empty-row">
                                    <td colspan="3" class="analytics-empty-state" id="analytics-conversion-empty">Waiting for conversions…</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="analytics-conversion-recent" id="analytics-conversion-recent">
                        <div class="analytics-empty-state">No conversions recorded yet.</div>
                    </div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-card-header">
                        <div>
                            <h3>Live minute buckets</h3>
                            <p>Latest activity grouped by minute</p>
                        </div>
                    </div>
                    <div class="analytics-live-list" id="analytics-live-list">
                        <div class="analytics-empty-state">Waiting for data…</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <button class="floating-chat-btn" onclick="window.location.href='../chat/index.html'" title="Open Chat Dashboard">
        <i class="fas fa-comments"></i>
        <span class="unread-badge" id="floating-chat-badge" style="display: none;">0</span>
    </button>

    <script type="module" src="/assets/js/pages/admin-index.js"></script>
</body>
</html>
