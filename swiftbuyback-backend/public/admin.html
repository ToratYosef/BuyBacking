<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SwiftBuyBack Admin</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* Loader animation */
.loader {
  border: 4px solid #6366F1;
  border-top: 4px solid transparent;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  animation: spin 1s linear infinite;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- Loading Screen -->
<div id="loadingScreen" class="hidden fixed inset-0 bg-white flex items-center justify-center z-50">
  <div class="text-center">
    <div class="loader mx-auto mb-4"></div>
    <p class="text-gray-700 font-medium">Loading...</p>
  </div>
</div>

<!-- Login Screen -->
<div id="loginScreen" class="flex-1 flex flex-col items-center justify-center">
  <h1 class="text-3xl font-bold text-gray-800 mb-6">SwiftBuyBack Admin</h1>
  <button id="signInBtn" class="flex items-center bg-white border border-gray-300 rounded px-4 py-2 hover:bg-gray-50 transition">
    <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" class="w-5 h-5 mr-2" alt="Google Logo">
    Sign in with Google
  </button>
</div>

<!-- Dashboard -->
<div id="dashboard" class="hidden flex-1 flex flex-col md:flex-row">
  <!-- Sidebar Menu -->
  <nav class="bg-white shadow-md w-full md:w-64 p-4 flex-shrink-0">
    <h2 class="text-xl font-semibold mb-6">Menu</h2>
    <ul class="space-y-3">
      <li><button id="ordersTab" class="w-full text-left px-2 py-1 rounded hover:bg-indigo-100 transition">Orders</button></li>
      <li><button id="shippingTab" class="w-full text-left px-2 py-1 rounded hover:bg-indigo-100 transition">Shipping</button></li>
      <li><button id="settingsTab" class="w-full text-left px-2 py-1 rounded hover:bg-indigo-100 transition">Settings</button></li>
      <li><button id="signOutBtn" class="w-full text-left px-2 py-1 rounded hover:bg-red-100 text-red-600 transition">Sign Out</button></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main class="flex-1 p-6 overflow-auto">
    <h2 class="text-2xl font-bold mb-4">Orders</h2>
    <div id="ordersList" class="space-y-4"></div>
    <p id="loadingMessage" class="text-gray-600 hidden">Loading orders...</p>
    <p id="errorMessage" class="text-red-600 hidden"></p>
  </main>
</div>

<!-- Order Modal -->
<div id="orderDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-lg w-full max-w-2xl p-6 relative overflow-auto max-h-[90vh]">
    <button id="closeModalBtn" class="absolute top-2 right-2 text-gray-600 hover:text-gray-900">&times;</button>
    <h3 class="text-xl font-bold mb-4">Order Details</h3>
    <div id="modalContent" class="space-y-2 text-gray-700"></div>
    <div id="modalMessage" class="hidden p-2 rounded mt-4"></div>
    <div class="mt-4 flex space-x-2">
      <button id="generateLabelBtn" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded hidden">Generate Label</button>
      <button id="markReceivedBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded hidden">Mark Received</button>
      <button id="markCompletedBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded hidden">Mark Completed</button>
    </div>
  </div>
</div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAmUGWbpbJIWLrBMJpZb8iMpFt-uc24J0k",
  authDomain: "buyback-a0f05.firebaseapp.com",
  projectId: "buyback-a0f05",
  storageBucket: "buyback-a0f05.firebasestorage.app",
  messagingSenderId: "876430429098",
  appId: "1:876430429098:web:f6dd64b1960d90461979d3",
  measurementId: "G-6WWQN44JHT"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const provider = new firebase.auth.GoogleAuthProvider();

// DOM Elements
const loginScreen = document.getElementById('loginScreen');
const dashboard = document.getElementById('dashboard');
const loadingScreen = document.getElementById('loadingScreen');
const signInBtn = document.getElementById('signInBtn');
const signOutBtn = document.getElementById('signOutBtn');
const ordersList = document.getElementById('ordersList');
const loadingMessage = document.getElementById('loadingMessage');
const errorMessage = document.getElementById('errorMessage');

// Simple backend URL
const BACKEND_URL = '';

// Auth state observer
auth.onAuthStateChanged(user => {
  if (user) {
    loginScreen.classList.add('hidden');
    dashboard.classList.remove('hidden');
    fetchOrders();
  } else {
    loginScreen.classList.remove('hidden');
    dashboard.classList.add('hidden');
  }
});

// Google Sign-In
signInBtn.addEventListener('click', async () => {
  try {
    loadingScreen.classList.remove('hidden');
    await auth.signInWithPopup(provider);
    loadingScreen.classList.add('hidden');
  } catch(err) {
    console.error(err);
    loadingScreen.classList.add('hidden');
  }
});

// Sign-Out
signOutBtn.addEventListener('click', () => {
  auth.signOut();
});

// Fetch orders from backend
async function fetchOrders() {
  ordersList.innerHTML = '';
  loadingMessage.classList.remove('hidden');
  errorMessage.classList.add('hidden');
  try {
    const res = await fetch(`${BACKEND_URL}/api/orders`);
    if (!res.ok) throw new Error(res.statusText);
    const orders = await res.json();
    loadingMessage.classList.add('hidden');
    if (orders.length === 0) ordersList.innerHTML = '<p class="text-gray-600">No orders found.</p>';
    else {
      orders.forEach(order => {
        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded shadow flex justify-between items-center hover:bg-gray-50 transition';
        div.innerHTML = `
          <div>
            <p class="font-bold">${order.device} (${order.storage})</p>
            <p class="text-sm text-gray-500">Status: ${order.status}</p>
          </div>
          <button class="view-btn bg-indigo-500 hover:bg-indigo-600 text-white px-3 py-1 rounded" data-id="${order.id}">View</button>
        `;
        ordersList.appendChild(div);
      });
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          alert(`Order ID: ${btn.dataset.id}`); // Replace with modal code
        });
      });
    }
  } catch(err) {
    console.error(err);
    loadingMessage.classList.add('hidden');
    errorMessage.textContent = `Failed to fetch orders: ${err.message}`;
    errorMessage.classList.remove('hidden');
  }
}
</script>
</body>
</html>
