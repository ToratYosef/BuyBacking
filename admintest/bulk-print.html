<!DOCTYPE html>
<html lang="en">
<head>
    <script>
      window.SHC_API_BASE_URL = "https://api.secondhandcell.com/";
    </script>
<link rel="stylesheet" href="/assets/css/tailwind.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guided Bulk Printing • BuyBackKing Ops Lab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      color-scheme: dark;
      --bg: #030712;
      --panel: rgba(10, 15, 32, 0.9);
      --card: rgba(14, 23, 47, 0.75);
      --border: rgba(255, 255, 255, 0.08);
      --border-strong: rgba(255, 255, 255, 0.22);
      --accent: #0ef1c5;
      --accent-2: #4f46e5;
      --text: #f8fbff;
      --muted: rgba(248, 251, 255, 0.6);
      --danger: #f87171;
      --success: #34d399;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Manrope', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      margin: 0;
      background: radial-gradient(circle at 0% 0%, rgba(79, 70, 229, 0.25), transparent 45%),
                  radial-gradient(circle at 80% -20%, rgba(14, 241, 197, 0.2), transparent 40%),
                  var(--bg);
      color: var(--text);
      padding: 24px;
    }

    .page-shell {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .glass-panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 28px;
      padding: 28px;
      box-shadow: 0 35px 90px rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(18px);
    }

    header h1 {
      font-size: 32px;
      margin-bottom: 8px;
    }

    header p {
      color: var(--muted);
      line-height: 1.5;
    }

    .inline-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 18px;
    }

    button, .btn {
      border: 0;
      border-radius: 18px;
      padding: 12px 20px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease;
      color: var(--text);
      font-size: 15px;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-primary {
      background: linear-gradient(120deg, var(--accent), #36b5ff);
      box-shadow: 0 18px 35px rgba(14, 241, 197, 0.25);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 24px 42px rgba(14, 241, 197, 0.35);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid var(--border);
    }

    .status-indicator {
      padding: 8px 14px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.08);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .status-indicator[data-state="running"] {
      color: var(--accent);
    }

    .status-indicator[data-state="idle"] {
      color: var(--muted);
    }

    .status-indicator[data-state="loading"] {
      color: var(--accent-2);
    }

    .status-indicator[data-state="error"] {
      color: var(--danger);
    }

    .grid {
      display: grid;
      gap: 18px;
    }

    .grid-two {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .stat-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .stat-card span {
      color: var(--muted);
      font-size: 13px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .stat-card strong {
      font-size: 28px;
    }

    .table-shell {
      overflow: hidden;
      border-radius: 28px;
      border: 1px solid var(--border);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: rgba(255, 255, 255, 0.02);
    }

    th, td {
      text-align: left;
      padding: 14px 18px;
      font-size: 14px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    tbody tr {
      transition: background 0.18s ease;
    }

    tbody tr:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    tbody tr.selected {
      background: rgba(14, 241, 197, 0.07);
    }

    tbody tr.empty-state td {
      text-align: center;
      padding: 48px 18px;
      color: var(--muted);
    }

    .queue-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .queue-controls .summary-chip {
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.07);
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 13px;
      color: var(--muted);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .filters input,
    .filters select {
      border-radius: 18px;
      border: 1px solid var(--border-strong);
      background: rgba(255, 255, 255, 0.03);
      color: var(--text);
      padding: 12px 16px;
      font-size: 14px;
      min-width: 220px;
    }

    .filters input::placeholder {
      color: rgba(248, 251, 255, 0.4);
    }

    .instruction-card {
      display: flex;
      flex-direction: column;
      gap: 12px;
      font-size: 15px;
      line-height: 1.5;
      color: var(--muted);
    }

    .instruction-card li {
      margin-bottom: 6px;
    }

    .activity-log {
      background: rgba(0, 0, 0, 0.25);
      border-radius: 18px;
      padding: 16px;
      font-size: 13px;
      line-height: 1.6;
      max-height: 240px;
      overflow-y: auto;
    }

    .activity-log p {
      margin: 0 0 8px;
      color: var(--muted);
    }

    .activity-log strong {
      color: var(--text);
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .pill[data-kind="label"] {
      background: rgba(14, 241, 197, 0.16);
      color: var(--accent);
    }

    .pill[data-kind="status"] {
      background: rgba(79, 70, 229, 0.16);
      color: #8da2ff;
    }

    @media (max-width: 720px) {
      .filters input,
      .filters select {
        width: 100%;
      }

      th:nth-child(4),
      td:nth-child(4),
      th:nth-child(6),
      td:nth-child(6) {
        display: none;
      }
    }
  </style>
    
    <link rel="stylesheet" href="/assets/css/site-chrome.css">
</head>
<body>
  <div class="page-shell">
    <!-- Site Header -->
<header class="site-header" data-site-header>
    <div class="site-header__inner site-header__inner--centered">
        <div class="logo-container-left">
            <a href="/" class="logo-link" aria-label="SecondHandCell home">
                <img src="https://secondhandcell.com/assets/logo.webp" alt="SecondHandCell Logo" class="logo-image" onerror="this.onerror=null;this.src='https://placehold.co/200x64/ffffff/1e293b?text=SecondHandCell';">
            </a>
        </div>
        <div class="logo-text-container-center">
            <div class="logo-wordmark">
                <span class="logo-wordmark__primary">Second</span><span class="logo-wordmark__accent">HandCell</span>
            </div>
            <p class="logo-tagline">Turn Your Old <span>Phone Into Cash!</span></p>
        </div>
        <nav class="header-auth-nav" aria-label="Account navigation">
            <div id="authStatusContainer" class="site-header__auth-wrapper">
                <a href="#" id="loginNavBtn" class="site-header__login">Login/Sign Up</a>
                <div id="userMonogram" class="user-monogram hidden"></div>
                <div id="authDropdown" class="auth-dropdown hidden">
                    <a href="/my-account.html" class="auth-dropdown__link">My Account</a>
                    <button id="logoutBtn" type="button" class="auth-dropdown__button btn-red-logout">Logout</button>
                </div>
            </div>
        </nav>
    </div>
</header>
<section class="ship48-banner" data-ship48-banner hidden>
    <div class="ship48-banner__inner">
        <p class="ship48-banner__message" title="Email label orders sent within 48 hours get +$10 with SHIP48 when you send within 48h.">
            <strong>SHIP48</strong> Email label orders sent within 48h earn +$10 with code <span class="ship48-banner__code">SHIP48</span>. Email label only. <span class="ship48-banner__counter" data-ship48-counter></span>
            <span class="ship48-banner__status" data-ship48-status></span>
        </p>
        <div class="ship48-banner__actions">
            <button type="button" class="ship48-banner__apply" data-ship48-apply>Apply SHIP48</button>
            <button type="button" class="ship48-banner__start" data-ship48-start>Start my quote now</button>
        </div>
    </div>
    <button type="button" class="ship48-banner__dismiss" aria-label="Dismiss Ship48 promo" data-ship48-dismiss>&times;</button>
</section>


    <section class="grid grid-two">
      <article class="stat-card">
        <span>Orders loaded</span>
        <strong id="totalOrders">0</strong>
        <p class="pill" data-kind="status" id="lastSync">—</p>
      </article>
      <article class="stat-card">
        <span>Selected for bulk print</span>
        <strong id="selectedCount">0</strong>
        <p class="pill" data-kind="label" id="activeOrder">No active job</p>
      </article>
    </section>

    <section class="glass-panel">
      <div class="filters">
        <label style="flex:1">
          <span class="sr-only">Search</span>
          <input type="search" id="searchInput" placeholder="Search by order ID, customer, brand or device" />
        </label>
        <label>
          <span class="sr-only">Shipping Preference</span>
          <select id="shippingFilter">
            <option value="all">Any shipping path</option>
            <option value="kit">Shipping kit requested</option>
            <option value="emailed">Label emailed</option>
          </select>
        </label>
        <label>
          <span class="sr-only">Status</span>
          <select id="statusFilter">
            <option value="all">Any status</option>
            <option value="label_generated">Label generated</option>
            <option value="kit_delivered">Kit delivered</option>
            <option value="kit_sent">Kit sent</option>
          </select>
        </label>
      </div>
    </section>

    <section class="glass-panel table-shell">
      <div class="queue-controls" style="padding: 18px 18px 0;">
        <div class="summary-chip" id="visibleCount">0 visible</div>
        <button class="btn btn-secondary" id="selectVisible">
          <i class="fa-solid fa-check-double"></i>
          Select visible
        </button>
        <button class="btn btn-secondary" id="clearSelection">
          <i class="fa-solid fa-broom"></i>
          Clear selection
        </button>
      </div>
      <div style="overflow-x: auto;">
        <table aria-live="polite">
          <thead>
            <tr>
              <th><input type="checkbox" id="selectAll"></th>
              <th>Order</th>
              <th>Customer</th>
              <th>Device</th>
              <th>Quote</th>
              <th>Shipping</th>
              <th>Queued</th>
            </tr>
          </thead>
          <tbody id="queueTable"></tbody>
        </table>
      </div>
    </section>

    <section class="grid grid-two">
      <article class="glass-panel instruction-card">
        <h2 style="margin:0;font-size:20px;">How the guided print flow works</h2>
        <ol>
          <li>Select every ready order above. Use the filters + <strong>Select visible</strong> to grab batches instantly.</li>
          <li>Press <strong>Start guided print</strong>. A new tab opens for each order, automatically focusing the print dialog.</li>
          <li>Hit <kbd>Enter</kbd> to confirm printing. The tab closes and the next shipment begins without touching your mouse.</li>
          <li>Need to pause? Press <strong>Stop sequence</strong> — the current tab closes and the queue idles.</li>
        </ol>
      </article>
      <article class="glass-panel">
        <h2 style="margin:0 0 12px;font-size:20px;">Activity feed</h2>
        <div class="activity-log" id="activityLog" aria-live="polite"></div>
      </article>
    </section>
  </div>

  <script type="module">
    import { apiGet } from "/public/js/apiClient.js";
    const state = {
      orders: [],
      filtered: [],
      selection: new Set(),
      queueState: 'idle',
      activeOrder: null,
      currentQueue: [],
      currentWindow: null,
    };

    const tableBody = document.getElementById('queueTable');
    const queueStateChip = document.getElementById('queueState');
    const totalOrdersEl = document.getElementById('totalOrders');
    const selectedCountEl = document.getElementById('selectedCount');
    const visibleCountEl = document.getElementById('visibleCount');
    const activeOrderEl = document.getElementById('activeOrder');
    const lastSyncEl = document.getElementById('lastSync');
    const activityLog = document.getElementById('activityLog');

    const searchInput = document.getElementById('searchInput');
    const shippingFilter = document.getElementById('shippingFilter');
    const statusFilter = document.getElementById('statusFilter');
    const selectAll = document.getElementById('selectAll');
    const selectVisibleBtn = document.getElementById('selectVisible');
    const clearSelectionBtn = document.getElementById('clearSelection');
    const startBulkPrintBtn = document.getElementById('startBulkPrint');
    const stopBulkPrintBtn = document.getElementById('stopBulkPrint');
    const refreshQueueBtn = document.getElementById('refreshQueue');

    const DEMO_ORDERS = [
      {
        id: 'BBK-5012',
        shippingInfo: { fullName: 'Maya Jensen', email: 'maya@email.com', city: 'Austin', state: 'TX' },
        device: 'iPhone 15 Pro Max',
        brand: 'Apple',
        storage: '256GB',
        estimatedQuote: 720,
        status: 'label_generated',
        shippingPreference: 'kit',
        createdAtMillis: Date.now() - 1000 * 60 * 60 * 2,
        labelUrls: ['https://example.com/demo.pdf'],
      },
      {
        id: 'BBK-5013',
        shippingInfo: { fullName: 'Tyler Webb', email: 'tyler@email.com', city: 'Chicago', state: 'IL' },
        device: 'Samsung Galaxy S24+',
        brand: 'Samsung',
        storage: '512GB',
        estimatedQuote: 460,
        status: 'kit_sent',
        shippingPreference: 'emailed',
        createdAtMillis: Date.now() - 1000 * 60 * 60 * 5,
        labelUrls: ['https://example.com/demo.pdf'],
      },
      {
        id: 'BBK-5014',
        shippingInfo: { fullName: 'Riya Patel', email: 'riya@email.com', city: 'Seattle', state: 'WA' },
        device: 'MacBook Air M2',
        brand: 'Apple',
        storage: '512GB',
        estimatedQuote: 810,
        status: 'kit_delivered',
        shippingPreference: 'kit',
        createdAtMillis: Date.now() - 1000 * 60 * 60 * 8,
        labelUrls: ['https://example.com/demo.pdf'],
      },
    ];

    function logActivity(message) {
      const timestamp = new Date().toLocaleTimeString();
      const entry = document.createElement('p');
      entry.innerHTML = `<strong>${timestamp}</strong> — ${message}`;
      activityLog.prepend(entry);
      const entries = activityLog.querySelectorAll('p');
      if (entries.length > 30) {
        entries[entries.length - 1].remove();
      }
    }

    function setQueueState(nextState, label) {
      state.queueState = nextState;
      queueStateChip.dataset.state = nextState;
      queueStateChip.querySelector('span').textContent = label || `Queue ${nextState}`;
      stopBulkPrintBtn.disabled = nextState !== 'running';
    }

    function formatQuote(order) {
      if (typeof order.estimatedQuote === 'number') {
        return `$${order.estimatedQuote.toFixed(2)}`;
      }
      return '—';
    }

    function formatShip(order) {
      if (!order.shippingPreference) return '—';
      return order.shippingPreference === 'kit' ? 'Shipping kit' : 'Label emailed';
    }

    function formatDate(millis) {
      if (!millis) return '—';
      try {
        return new Intl.DateTimeFormat(undefined, { month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' }).format(new Date(millis));
      } catch (error) {
        return new Date(millis).toLocaleString();
      }
    }

    function updateSelectionSummary() {
      selectedCountEl.textContent = state.selection.size;
      startBulkPrintBtn.disabled = state.selection.size === 0 || state.queueState === 'running';
      selectAll.checked = state.filtered.length > 0 && state.filtered.every((order) => state.selection.has(order.id));
    }

    function renderOrders() {
      tableBody.innerHTML = '';
      if (!state.filtered.length) {
        const row = document.createElement('tr');
        row.className = 'empty-state';
        row.innerHTML = '<td colspan="7">No orders match your filters. Try refreshing the queue.</td>';
        tableBody.appendChild(row);
        visibleCountEl.textContent = '0 visible';
        selectAll.checked = false;
        return;
      }

      const fragment = document.createDocumentFragment();
      state.filtered.forEach((order) => {
        const row = document.createElement('tr');
        if (state.selection.has(order.id)) {
          row.classList.add('selected');
        }
        row.dataset.orderId = order.id;
        row.innerHTML = `
          <td><input type="checkbox" class="row-checkbox" data-order-id="${order.id}" ${state.selection.has(order.id) ? 'checked' : ''}></td>
          <td><div style="font-weight:600;">${order.id}</div><div class="pill" data-kind="status">${order.status || '—'}</div></td>
          <td>${order.shippingInfo?.fullName || '—'}<br><span style="color:var(--muted);font-size:12px;">${order.shippingInfo?.city || ''} ${order.shippingInfo?.state || ''}</span></td>
          <td>${order.device || '—'}<br><span style="color:var(--muted);font-size:12px;">${order.storage || ''}</span></td>
          <td>${formatQuote(order)}</td>
          <td>${formatShip(order)}</td>
          <td>${formatDate(order.createdAtMillis)}</td>
        `;
        fragment.appendChild(row);
      });
      tableBody.appendChild(fragment);
      visibleCountEl.textContent = `${state.filtered.length} visible`;
      selectAll.checked = state.filtered.every((order) => state.selection.has(order.id));
    }

    function applyFilters() {
      const query = searchInput.value.trim().toLowerCase();
      const ship = shippingFilter.value;
      const status = statusFilter.value;
      state.filtered = state.orders.filter((order) => {
        if (ship !== 'all') {
          if (ship === 'kit' && order.shippingPreference !== 'kit') return false;
          if (ship === 'emailed' && order.shippingPreference === 'kit') return false;
        }
        if (status !== 'all' && order.status !== status) {
          return false;
        }
        if (!query) return true;
        const haystack = [order.id, order.device, order.brand, order.shippingInfo?.fullName].join(' ').toLowerCase();
        return haystack.includes(query);
      });
      renderOrders();
      updateSelectionSummary();
    }

    function selectAllVisible() {
      state.filtered.forEach((order) => state.selection.add(order.id));
      renderOrders();
      updateSelectionSummary();
      logActivity(`Selected ${state.filtered.length} orders.`);
    }

    function clearSelection() {
      state.selection.clear();
      renderOrders();
      updateSelectionSummary();
      logActivity('Cleared selection.');
    }

    async function fetchOrders() {
      queueStateChip.dataset.state = 'loading';
      queueStateChip.querySelector('span').textContent = 'Refreshing…';
      try {
        const payload = await apiGet('/orders/needs-printing', { authRequired: true });
        const orders = Array.isArray(payload.orders) ? payload.orders : [];
        hydrateOrders(orders);
        logActivity(`Loaded ${orders.length} orders from Firestore.`);
      } catch (error) {
        console.error('Failed to refresh queue', error);
        hydrateOrders(DEMO_ORDERS);
        queueStateChip.dataset.state = 'error';
        queueStateChip.querySelector('span').textContent = 'Offline demo data';
        logActivity('Live queue unavailable. Showing demo data.');
      }
    }

    function hydrateOrders(orders = []) {
      state.orders = orders;
      state.selection.clear();
      totalOrdersEl.textContent = orders.length;
      lastSyncEl.textContent = new Date().toLocaleTimeString();
      queueStateChip.dataset.state = 'idle';
      queueStateChip.querySelector('span').textContent = 'Queue idle';
      applyFilters();
    }

    function nextOrderInQueue() {
      if (!state.currentQueue.length) {
        finishQueue();
        return;
      }
      const order = state.currentQueue.shift();
      state.activeOrder = order;
      activeOrderEl.textContent = `${order.id} • ${order.shippingInfo?.fullName || ''}`;
      logActivity(`Opening print tab for ${order.id}.`);
      openPrintTab(order, () => {
        logActivity(`Finished ${order.id}. ${state.currentQueue.length} remaining.`);
        nextOrderInQueue();
      });
    }

    function finishQueue() {
      setQueueState('idle', 'Queue complete');
      state.activeOrder = null;
      activeOrderEl.textContent = 'No active job';
      state.currentQueue = [];
      startBulkPrintBtn.disabled = state.selection.size === 0;
      logActivity('Bulk print sequence finished.');
    }

    function startQueue() {
      if (!state.selection.size) return;
      const queue = Array.from(state.selection)
        .map((id) => state.orders.find((order) => order.id === id))
        .filter((order) => order && Array.isArray(order.labelUrls) && order.labelUrls.length);
      if (!queue.length) {
        alert('Selected orders do not have printable documents yet.');
        return;
      }
      state.currentQueue = queue;
      setQueueState('running', 'Guided printing');
      startBulkPrintBtn.disabled = true;
      stopBulkPrintBtn.disabled = false;
      nextOrderInQueue();
    }

    function stopQueue(manual = false) {
      if (state.currentWindow && !state.currentWindow.closed) {
        try {
          state.currentWindow.close();
        } catch (error) {
          console.warn('Unable to close active print tab', error);
        }
      }
      state.currentQueue = [];
      state.activeOrder = null;
      activeOrderEl.textContent = 'No active job';
      setQueueState('idle', manual ? 'Queue paused' : 'Queue idle');
      startBulkPrintBtn.disabled = state.selection.size === 0;
      if (manual) {
        logActivity('Queue paused by operator.');
      }
    }

    function openPrintTab(order, onComplete) {
      const url = `/admintest/print-label.html?orderId=${encodeURIComponent(order.id)}`;
      const win = window.open(url, '_blank');
      if (!win) {
        alert('Your browser blocked the pop-up. Please allow pop-ups for this tool.');
        stopQueue(true);
        return;
      }
      state.currentWindow = win;

      const cleanup = () => {
        try {
          win.removeEventListener('afterprint', handleAfterPrint);
          win.removeEventListener('load', handleLoad);
        } catch (error) {
          // noop
        }
        clearInterval(closeWatcher);
        state.currentWindow = null;
      };

      const handleAfterPrint = () => {
        cleanup();
        try {
          win.close();
        } catch (error) {
          console.warn('Unable to close print window', error);
        }
        onComplete();
      };

      const handleLoad = () => {
        try {
          win.focus();
          setTimeout(() => {
            win.print();
          }, 200);
        } catch (error) {
          console.warn('Unable to trigger print dialog automatically', error);
        }
      };

      const closeWatcher = setInterval(() => {
        if (win.closed) {
          cleanup();
          if (state.queueState === 'running') {
            onComplete();
          }
        }
      }, 600);

      win.addEventListener('load', handleLoad, { once: true });
      win.addEventListener('afterprint', handleAfterPrint);

      // Fallback in case load never fires
      setTimeout(() => {
        try {
          if (!win.closed) {
            win.focus();
            win.print();
          }
        } catch (error) {
          console.warn('Fallback print trigger failed', error);
        }
      }, 2000);
    }

    tableBody.addEventListener('change', (event) => {
      if (!event.target.classList.contains('row-checkbox')) return;
      const orderId = event.target.dataset.orderId;
      if (event.target.checked) {
        state.selection.add(orderId);
      } else {
        state.selection.delete(orderId);
      }
      const row = event.target.closest('tr');
      row?.classList.toggle('selected', event.target.checked);
      updateSelectionSummary();
    });

    selectAll.addEventListener('change', () => {
      if (selectAll.checked) {
        selectAllVisible();
      } else {
        clearSelection();
      }
    });

    selectVisibleBtn.addEventListener('click', selectAllVisible);
    clearSelectionBtn.addEventListener('click', clearSelection);

    [searchInput, shippingFilter, statusFilter].forEach((control) => {
      control.addEventListener('input', applyFilters);
      control.addEventListener('change', applyFilters);
    });

    startBulkPrintBtn.addEventListener('click', startQueue);
    stopBulkPrintBtn.addEventListener('click', () => stopQueue(true));
    refreshQueueBtn.addEventListener('click', fetchOrders);
    window.addEventListener('beforeunload', () => stopQueue());

    fetchOrders();
  </script>
<!-- <script src="/assets/js/ship48-banner.js" defer></script> -->  <script type="module" src="/assets/js/global-auth.js" defer></script>
</body>
</html>
