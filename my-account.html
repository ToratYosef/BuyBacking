<!DOCTYPE html>
<html lang="en">
<head>
    <script>
      window.SHC_API_BASE_URL = "https://api.secondhandcell.com/api";
    </script>
<link rel="stylesheet" href="/assets/css/tailwind.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecondHandCell - My Account</title>
    <link rel="icon" href="/favicon/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W3BM2JC8');</script>

    <script defer src="https://www.googletagmanager.com/gtag/js?id=AW-17534255111"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'AW-17534255111');
        gtag('config', 'G-8JYPJDKSP8');
    </script>

    <style>
        body { font-family: ui-sans-serif, system-ui, -apple-system, sans-serif; -webkit-font-smoothing: antialiased; }
        .account-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; padding: 24px; box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08); }
        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }
        .status-pill.pending { background: #dbeafe; color: #1e40af; }
        .status-pill.shipped { background: #e0e7ff; color: #3730a3; }
        .status-pill.received { background: #e5e7eb; color: #374151; }
        .status-pill.complete { background: #dcfce7; color: #166534; }
        .status-pill.other { background: #fef9c3; color: #854d0e; }
    </style>
    <link rel="stylesheet" href="/assets/css/site-chrome.css">
</head>
<body class="bg-slate-50 text-slate-900">
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W3BM2JC8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <header class="site-header site-header--mobile-compact">
        <div class="site-header__inner site-header__inner--centered">
            <div class="logo-container-left">
                <a href="/" class="logo-link">
                    <img src="/assets/logo.webp" alt="SecondHandCell Logo" class="logo-image" width="320">
                </a>
            </div>
            <div class="logo-text-container-center">
                <div class="logo-wordmark">
                    <span class="logo-wordmark__primary">Second</span><span class="logo-wordmark__accent">HandCell</span>
                </div>
                <p class="logo-tagline">Turn Your Old <span>Phone Into Cash!</span></p>
            </div>
            <nav class="header-auth-nav">
                <div id="authStatusContainer" class="site-header__auth-wrapper relative">
                    <a href="#" id="loginNavBtn" class="site-header__login">Login/Sign Up</a>
                    <div id="userMonogram" class="user-monogram hidden"></div>
                    <div id="authDropdown" class="auth-dropdown hidden">
                        <a href="/my-account.html" class="auth-dropdown__link">My Account</a>
                        <button id="logoutBtn" type="button" class="auth-dropdown__button">Logout</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-12">
        <div class="account-card">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
                <div>
                    <h1 class="text-3xl font-black">My Account</h1>
                    <p class="text-slate-600 mt-2">Manage your trade-ins, shipping details, and payout preferences in one place.</p>
                </div>
                <a href="/sell/index.html" class="inline-flex items-center justify-center px-5 py-3 rounded-xl bg-green-600 text-white font-bold hover:bg-green-700 transition">
                    Start a new trade-in
                </a>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-10">
                <div class="border border-slate-200 rounded-2xl p-5 bg-slate-50">
                    <div class="text-sm font-bold text-slate-500 uppercase">Orders</div>
                    <p class="text-slate-700 mt-3">Track current shipments and view recent payouts.</p>
                    <a href="/track-order.html" class="inline-flex items-center gap-2 text-green-700 font-semibold mt-4 hover:underline">
                        Track an order <i class="fa-solid fa-arrow-right-long"></i>
                    </a>
                </div>
                <div class="border border-slate-200 rounded-2xl p-5 bg-slate-50">
                    <div class="text-sm font-bold text-slate-500 uppercase">Shipping</div>
                    <p class="text-slate-700 mt-3">Update your shipping details or confirm where to send a kit.</p>
                    <a href="/support.html" class="inline-flex items-center gap-2 text-green-700 font-semibold mt-4 hover:underline">
                        Contact support <i class="fa-solid fa-arrow-right-long"></i>
                    </a>
                </div>
                <div class="border border-slate-200 rounded-2xl p-5 bg-slate-50">
                    <div class="text-sm font-bold text-slate-500 uppercase">Payout</div>
                    <p class="text-slate-700 mt-3">Need to change your payment method? We can help.</p>
                    <a href="mailto:support@secondhandcell.com" class="inline-flex items-center gap-2 text-green-700 font-semibold mt-4 hover:underline">
                        Email support <i class="fa-solid fa-arrow-right-long"></i>
                    </a>
                </div>
            </div>

            <div class="mt-10 border-t border-slate-200 pt-6">
                <div class="flex items-center justify-between flex-wrap gap-3">
                    <h2 class="text-xl font-black text-slate-900">My Orders</h2>
                    <a href="/sell/index.html" class="text-sm font-semibold text-green-700 hover:underline">Start another trade-in</a>
                </div>
                <div id="account-orders" class="mt-6 space-y-4 text-sm text-slate-600">
                    <div class="rounded-2xl border border-slate-200 bg-slate-50 p-5 text-slate-500">Sign in to view your orders.</div>
                </div>
            </div>

            <div class="mt-10 border-t border-slate-200 pt-6 text-sm text-slate-500">
                Need immediate help? Call <span class="font-semibold text-slate-700">(347) 559-1707</span> or email <a href="mailto:support@secondhandcell.com" class="text-green-700 font-semibold hover:underline">support@secondhandcell.com</a>.
            </div>
        </div>
    </main>

    <footer class="bg-slate-800 text-white mt-20">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-8">
                    <div><h3 class="text-xl font-bold mb-4">SecondHandCell</h3><p class="text-slate-400">Your trusted partner for selling used tech. Quick quotes, fair prices, and hassle-free service.</p></div>
                    <div><h3 class="text-xl font-bold mb-4">Quick Links </h3><ul class="space-y-2"><li><a href="/" class="text-slate-400 hover:text-white transition duration-300">Home</a></li><li><a href="/about-us" class="text-slate-400 hover:text-white transition duration-300">About Us</a></li><li><a href="/privacy.html" class="text-slate-400 hover:text-white transition duration-300">Privacy Policy</a></li><li><a href="/terms.html" class="text-slate-400 hover:text-white transition duration-300">Terms & Conditions</a></li></ul></div>
                    <div><h3 class="text-xl font-bold mb-4">Contact Us</h3><p class="text-slate-400">Email: support@secondhandcell.com</p></div>
                </div>
                <div class="bg-slate-700 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-2 text-white">Stay Updated </h3>
                    <p class="text-slate-300 mb-4 text-sm">Sign up for promos and price increases!</p>
                    <form id="footerEmailSignupForm" class="flex flex-col sm:flex-row gap-2">
                        <input type="email" id="footerPromoEmail" placeholder="Enter your email" class="w-full flex-grow border border-slate-400 bg-slate-800 text-white p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">Sign Up</button>
                    </form>
                </div>
            </div>
            <div class="bg-slate-800 text-white p-6 rounded-xl shadow-lg mt-8 text-center border-2 border-red-600">
                <p class="text-lg font-bold uppercase">IMPORTANT NOTICE</p>
                <p class="mt-2 text-sm md:text-base">We do not purchase blacklisted or lost/stolen devices. All devices are verified through a legal compliance check.</p>
            </div>
            <div class="mt-8 flex flex-wrap justify-center items-center gap-8">
                <a href="https://www.sellcell.com/" target="_blank" rel="noopener">
                    <img src="https://c9ac71a8282e1fecd95e-f07dbcddcacf0d4c572ea7178ee6902d.ssl.cf2.rackcdn.com/assets/images/share/sellcell-accredited-buyer.png" class="h-16 grayscale hover:grayscale-0 transition" alt="SellCell Accredited Buyer">
                </a>
                <img src="/assets/stars-5.svg" class="h-10" alt="Trustpilot 5 Star">
            </div>
            <div class="border-t border-slate-700 mt-8 pt-6 text-center text-slate-400 text-sm"><p>&copy; 2025 SecondHandCell. All rights reserved.</p></div>
        </div>
    </footer>

    <script type="module">
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmUGWbpbJIWLrBMJpZb8iMpFt-uc24J0k",
            authDomain: "auth.secondhandcell.com",
            projectId: "buyback-a0f05",
            storageBucket: "buyback-a0f05.appspot.com",
            messagingSenderId: "876430429098",
            appId: "1:876430429098:web:f6dd64b1970d90461979d3",
            measurementId: "G-6WWQN44JHT"
        };

        const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const statusMap = {
            order_pending: { label: 'Order Pending', className: 'status-pill pending' },
            shipping_kit_requested: { label: 'Shipping Kit', className: 'status-pill shipped' },
            label_generated: { label: 'Label Generated', className: 'status-pill other' },
            received: { label: 'Received', className: 'status-pill received' },
            completed: { label: 'Completed', className: 'status-pill complete' }
        };

        const formatStatus = (status) => {
            const normalized = (status || '').toString().toLowerCase();
            return statusMap[normalized] || { label: status || 'In Progress', className: 'status-pill other' };
        };

        const formatDate = (value) => {
            if (!value) return '';
            const date = value.seconds ? new Date(value.seconds * 1000) : new Date(value);
            return Number.isNaN(date.getTime()) ? '' : date.toLocaleDateString();
        };

        const renderOrders = (orders = []) => {
            const container = document.getElementById('account-orders');
            if (!container) return;
            if (!orders.length) {
                container.innerHTML = '<div class="rounded-2xl border border-slate-200 bg-slate-50 p-5 text-slate-500">No orders yet. Start a trade-in to see your orders here.</div>';
                return;
            }
            container.innerHTML = orders.map((order) => {
                const status = formatStatus(order.status);
                const payout = Number(order.totalPayout || order.estimatedQuote || 0).toFixed(2);
                const device = order.device || order.modelName || 'Device';
                const createdAt = formatDate(order.createdAt);
                const qty = order.qty ? `Qty ${order.qty}` : '';
                return `
                    <div class="rounded-2xl border border-slate-200 bg-white p-5">
                        <div class="flex items-start justify-between gap-4">
                            <div>
                                <div class="text-xs font-bold uppercase text-slate-400">Order ${order.id || ''}</div>
                                <div class="text-lg font-black text-slate-900 mt-1">${device}</div>
                                <div class="text-sm text-slate-500 mt-1">${[order.storage, order.carrier].filter(Boolean).join(' • ')}</div>
                                <div class="text-sm text-slate-500 mt-1">${[createdAt, qty].filter(Boolean).join(' • ')}</div>
                            </div>
                            <div class="text-right">
                                <div class="${status.className}">${status.label}</div>
                                <div class="mt-3 text-lg font-black text-green-700">$${payout}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        };

        const loadOrders = async (user) => {
            const container = document.getElementById('account-orders');
            if (!container) return;
            container.innerHTML = '<div class="rounded-2xl border border-slate-200 bg-slate-50 p-5 text-slate-500">Loading your orders...</div>';
            try {
                const ordersRef = collection(db, 'orders');
                const ordersQuery = query(ordersRef, where('userId', '==', user.uid), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(ordersQuery);
                const orders = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));
                renderOrders(orders);
            } catch (error) {
                console.error('Failed to load orders:', error);
                container.innerHTML = '<div class="rounded-2xl border border-rose-200 bg-rose-50 p-5 text-rose-700">Unable to load orders right now.</div>';
            }
        };

        onAuthStateChanged(auth, (user) => {
            const loginBtn = document.getElementById('loginNavBtn');
            const monogram = document.getElementById('userMonogram');
            if (user) {
                loginBtn.classList.add('hidden');
                monogram.classList.remove('hidden');
                let initials = 'U';
                if (user.displayName) {
                    const parts = user.displayName.trim().split(/\s+/);
                    initials = parts.length > 1
                        ? (parts[0][0] + parts[parts.length - 1][0]).toUpperCase()
                        : parts[0].slice(0, 2).toUpperCase();
                } else if (user.email) {
                    initials = user.email.slice(0, 2).toUpperCase();
                }
                monogram.textContent = initials;
                loadOrders(user);
            } else {
                loginBtn.classList.remove('hidden');
                monogram.classList.add('hidden');
                renderOrders([]);
            }
        });

        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    window.location.href = '/';
                } catch (error) {
                    console.error('Logout failed:', error);
                }
            });
        }
    </script>
    <script type="module" src="/assets/js/global-auth.js" defer></script>
</body>
</html>
