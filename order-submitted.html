<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Submitted - secondhandcell</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/brands.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W3BM2JC8');</script>
    
    <!-- End Google Tag Manager -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17534255111"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
        
            gtag('config', 'AW-17534255111');
            gtag('config', 'G-8JYPJDKSP8');
        
            gtag('event', 'conversion', {'send_to': 'AW-17534255111/09vcCOjI85QbEIeA_qhB'});
        </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen flex flex-col items-center justify-center">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W3BM2JC8"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    <main class="flex-grow container mx-auto px-4 py-12 flex items-center justify-center">
        <div class="bg-white p-8 md:p-12 rounded-3xl shadow-xl max-w-2xl text-center w-full">
            <div class="mb-6">
                <i class="fa-solid fa-circle-check text-7xl text-green-500"></i>
            </div>
            
            <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 mb-4">Thank You for Your Order! ðŸŽ‰</h1>
            
            <p class="text-lg text-slate-600 mb-8 max-w-xl mx-auto" id="confirmationSummary">
                Your order <span id="confirmationOrderId" class="font-semibold text-slate-900">has</span> been successfully submitted.
                A confirmation email has been sent to <span id="confirmationEmail" class="font-semibold text-slate-900">your inbox</span>.
            </p>

            <div id="orderSummaryWrapper" class="grid gap-6 mb-8 text-left md:grid-cols-2">
                <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <h2 class="text-xl font-bold text-slate-800 mb-4">Order Overview</h2>
                    <dl class="space-y-3 text-sm text-slate-700">
                        <div class="flex justify-between gap-4">
                            <dt class="font-semibold text-slate-900">Order ID</dt>
                            <dd id="summaryOrderId" class="text-right text-slate-600">Pending</dd>
                        </div>
                        <div class="flex justify-between gap-4">
                            <dt class="font-semibold text-slate-900">Device</dt>
                            <dd class="text-right text-slate-600">
                                <span id="summaryDeviceName">â€”</span>
                                <span class="block text-xs text-slate-500" id="summaryDeviceStorage">&nbsp;</span>
                            </dd>
                        </div>
                        <div class="flex justify-between gap-4">
                            <dt class="font-semibold text-slate-900">Carrier</dt>
                            <dd id="summaryDeviceCarrier" class="text-right text-slate-600">â€”</dd>
                        </div>
                        <div class="flex justify-between gap-4">
                            <dt class="font-semibold text-slate-900">Guaranteed Quote</dt>
                            <dd id="summaryQuote" class="text-right text-emerald-600 font-semibold">â€”</dd>
                        </div>
                        <div class="pt-3 border-t border-slate-200">
                            <h3 class="text-sm font-semibold text-slate-900 mb-2">Condition Highlights</h3>
                            <ul class="space-y-1 text-xs text-slate-600">
                                <li id="summaryConditionPower">â€¢ Power status: â€”</li>
                                <li id="summaryConditionFunctional">â€¢ Functionality: â€”</li>
                                <li id="summaryConditionCracks">â€¢ Screen & body: â€”</li>
                                <li id="summaryConditionCosmetic">â€¢ Cosmetic detail: â€”</li>
                            </ul>
                        </div>
                    </dl>
                </div>
                <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200 shadow-sm flex flex-col gap-6">
                    <div>
                        <h2 class="text-xl font-bold text-slate-800 mb-4">Contact & Shipping</h2>
                        <dl class="space-y-3 text-sm text-slate-700">
                            <div class="flex justify-between gap-4">
                                <dt class="font-semibold text-slate-900">Customer</dt>
                                <dd id="summaryCustomerName" class="text-right text-slate-600">â€”</dd>
                            </div>
                            <div class="flex justify-between gap-4">
                                <dt class="font-semibold text-slate-900">Email</dt>
                                <dd id="summaryCustomerEmail" class="text-right text-slate-600">â€”</dd>
                            </div>
                            <div class="flex justify-between gap-4">
                                <dt class="font-semibold text-slate-900">Phone</dt>
                                <dd id="summaryCustomerPhone" class="text-right text-slate-600">â€”</dd>
                            </div>
                            <div>
                                <dt class="font-semibold text-slate-900">Mailing Address</dt>
                                <dd id="summaryShippingAddress" class="mt-1 text-sm leading-relaxed text-slate-600">â€”</dd>
                            </div>
                            <div class="flex justify-between gap-4">
                                <dt class="font-semibold text-slate-900">Shipping Preference</dt>
                                <dd id="summaryShippingPreference" class="text-right text-slate-600">â€”</dd>
                            </div>
                        </dl>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-slate-800 mb-4">Payment Method</h2>
                        <p id="summaryPaymentMethod" class="text-sm text-slate-700">â€”</p>
                        <p id="summaryPaymentDetails" class="text-xs text-slate-500 mt-2">Payment instructions will also be included in your confirmation email.</p>
                    </div>
                </div>
            </div>

            <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200 text-left mb-8 shadow-sm">
                <h2 class="text-xl font-bold text-slate-800 mb-4">What Happens Next?</h2>
                <ol class="list-decimal list-inside space-y-4 text-slate-700">
                    <li>
                        <strong>Check Your Email:</strong> We've just sent you a confirmation email containing your order summary and the next steps. Please check your spam folder if you don't see it within a few minutes.
                    </li>
                    <li id="shippingInstruction">
                        <strong>Shipping Instructions:</strong>
                        <span class="block mt-2">
                            A prepaid shipping label will arrive in your inbox shortly. Please use your own packaging, carefully wrap your device, and drop it off at any USPS location.
                        </span>
                    </li>
                    <li>
                        <strong>Device Inspection:</strong> Once we receive your device, our certified technicians will inspect it to confirm the condition.
                    </li>
                    <li>
                        <strong>Get Paid:</strong> After the inspection, we'll send your payment via the method you selected. You'll receive a final payment confirmation email when the funds are on their way.
                    </li>
                </ol>
            </div>

            <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                <a href="https://secondhandcell.com/index.html" class="inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-full text-indigo-700 bg-indigo-100 hover:bg-indigo-200 transition duration-300">
                    <i class="fa-solid fa-house mr-2"></i> Return to Homepage
                </a>
                <a href="https://secondhandcell.com/my-account.html" class="inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-full text-white bg-indigo-600 hover:bg-indigo-700 transition duration-300">
                    <i class="fa-solid fa-user-circle mr-2"></i> View My Account
                </a>
            </div>
        </div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const summaryKey = 'secondhandcell:lastOrderSummary';
            const shippingInstruction = document.getElementById('shippingInstruction');
            const summaryWrapper = document.getElementById('orderSummaryWrapper');
            const confirmationOrderId = document.getElementById('confirmationOrderId');
            const confirmationEmail = document.getElementById('confirmationEmail');

            const summaryElements = {
                orderId: document.getElementById('summaryOrderId'),
                deviceName: document.getElementById('summaryDeviceName'),
                deviceStorage: document.getElementById('summaryDeviceStorage'),
                deviceCarrier: document.getElementById('summaryDeviceCarrier'),
                quote: document.getElementById('summaryQuote'),
                conditionPower: document.getElementById('summaryConditionPower'),
                conditionFunctional: document.getElementById('summaryConditionFunctional'),
                conditionCracks: document.getElementById('summaryConditionCracks'),
                conditionCosmetic: document.getElementById('summaryConditionCosmetic'),
                customerName: document.getElementById('summaryCustomerName'),
                customerEmail: document.getElementById('summaryCustomerEmail'),
                customerPhone: document.getElementById('summaryCustomerPhone'),
                shippingAddress: document.getElementById('summaryShippingAddress'),
                shippingPreference: document.getElementById('summaryShippingPreference'),
                paymentMethod: document.getElementById('summaryPaymentMethod'),
                paymentDetails: document.getElementById('summaryPaymentDetails')
            };

            const urlParams = new URLSearchParams(window.location.search);
            const shippingPreferenceParam = urlParams.get('shipping') || '';
            const transactionId = urlParams.get('orderId') || 'unknown';
            const basketTotal = urlParams.get('price') || urlParams.get('total') || '0';

            const storedSummary = localStorage.getItem(summaryKey);
            let summaryData = null;
            if (storedSummary) {
                try {
                    summaryData = JSON.parse(storedSummary);
                } catch (error) {
                    console.warn('Unable to parse stored order summary payload:', error);
                }
            }

            const formatCurrency = (value) => {
                const numericValue = Number(value);
                if (Number.isFinite(numericValue) && numericValue > 0) {
                    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(numericValue);
                }
                return 'â€”';
            };

            const formatPhone = (value) => {
                if (!value) return 'â€”';
                const digits = value.toString().replace(/\D/g, '');
                if (digits.length === 10) {
                    return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
                }
                return value;
            };

            const formatShippingPreference = (value) => {
                if (!value) return 'Email Label';
                const normalized = value.toLowerCase();
                if (normalized.includes('kit')) return 'Prepaid Shipping Kit';
                return 'Email Shipping Label';
            };

            const describeCondition = (label, value) => {
                if (!value || value === 'N/A') {
                    return `${label}: Not provided`;
                }
                const normalized = value.toLowerCase();
                if (normalized === 'yes') {
                    return `${label}: Yes`;
                }
                if (normalized === 'no') {
                    return `${label}: No`;
                }
                return `${label}: ${value}`;
            };

            let resolvedShippingPreference = shippingPreferenceParam || 'email_label';
            let displayQuote = basketTotal;

            if (summaryData) {
                const {
                    orderId,
                    quote,
                    device,
                    shippingPreference,
                    shippingInfo,
                    paymentMethod,
                    paymentDetails
                } = summaryData;

                if (confirmationOrderId) {
                    confirmationOrderId.textContent = orderId ? `#${orderId}` : 'your order';
                }

                const emailAddress = shippingInfo?.email || urlParams.get('email');
                if (confirmationEmail) {
                    confirmationEmail.textContent = emailAddress || 'your inbox';
                }

                if (summaryElements.orderId) {
                    const displayId = orderId || (transactionId !== 'unknown' ? transactionId : 'Pending');
                    summaryElements.orderId.textContent = displayId && displayId !== 'Pending' ? `#${displayId}` : 'Pending';
                }

                if (device) {
                    if (summaryElements.deviceName) {
                        summaryElements.deviceName.textContent = [device.brand, device.name].filter(Boolean).join(' ') || 'â€”';
                    }
                    if (summaryElements.deviceStorage) {
                        summaryElements.deviceStorage.textContent = device.storage ? `${device.storage} storage` : '';
                    }
                    if (summaryElements.deviceCarrier) {
                        summaryElements.deviceCarrier.textContent = device.carrier ? device.carrier.replace(/_/g, ' ').replace(/\b\w/g, (char) => char.toUpperCase()) : 'â€”';
                    }
                    if (summaryElements.conditionPower) {
                        summaryElements.conditionPower.textContent = `â€¢ ${describeCondition('Power status', device.condition?.powerOn)}`;
                    }
                    if (summaryElements.conditionFunctional) {
                        summaryElements.conditionFunctional.textContent = `â€¢ ${describeCondition('Functionality', device.condition?.functional)}`;
                    }
                    if (summaryElements.conditionCracks) {
                        summaryElements.conditionCracks.textContent = `â€¢ ${describeCondition('Screen & body', device.condition?.cracks)}`;
                    }
                    if (summaryElements.conditionCosmetic) {
                        summaryElements.conditionCosmetic.textContent = `â€¢ ${describeCondition('Cosmetic detail', device.condition?.cosmetic)}`;
                    }
                }

                if (summaryElements.customerName) {
                    summaryElements.customerName.textContent = shippingInfo?.fullName || 'â€”';
                }
                if (summaryElements.customerEmail) {
                    summaryElements.customerEmail.textContent = emailAddress || 'â€”';
                }
                if (summaryElements.customerPhone) {
                    summaryElements.customerPhone.textContent = formatPhone(shippingInfo?.phone);
                }
                if (summaryElements.shippingAddress) {
                    const addressParts = [shippingInfo?.streetAddress, shippingInfo?.city, shippingInfo?.state, shippingInfo?.zipCode].filter(Boolean);
                    summaryElements.shippingAddress.textContent = addressParts.length ? addressParts.join(', ') : 'â€”';
                }

                resolvedShippingPreference = shippingPreference || shippingPreferenceParam;
                if (summaryElements.shippingPreference) {
                    summaryElements.shippingPreference.textContent = formatShippingPreference(resolvedShippingPreference);
                }

                if (summaryElements.paymentMethod) {
                    const friendlyPayment = paymentMethod ? paymentMethod.replace(/_/g, ' ') : 'â€”';
                    summaryElements.paymentMethod.textContent = friendlyPayment.charAt(0).toUpperCase() + friendlyPayment.slice(1);
                }

                if (summaryElements.paymentDetails) {
                    let detailMessage = 'Payment instructions will also be included in your confirmation email.';
                    if (paymentMethod === 'venmo' && paymentDetails?.venmoUsername) {
                        const venmoHandle = paymentDetails.venmoUsername.replace(/^@/, '');
                        detailMessage = `Venmo Username: @${venmoHandle}`;
                    } else if (paymentMethod === 'zelle' && paymentDetails?.zelleIdentifier) {
                        detailMessage = `Zelle: ${paymentDetails.zelleIdentifier}`;
                    } else if (paymentMethod === 'paypal' && paymentDetails?.paypalEmail) {
                        detailMessage = `PayPal Email: ${paymentDetails.paypalEmail}`;
                    }
                    summaryElements.paymentDetails.textContent = detailMessage;
                }

                displayQuote = quote || basketTotal;

                if (summaryElements.quote) {
                    summaryElements.quote.textContent = formatCurrency(displayQuote);
                }

                localStorage.removeItem(summaryKey);
            } else {
                if (summaryWrapper) {
                    summaryWrapper.classList.add('hidden');
                }
                if (confirmationOrderId) {
                    confirmationOrderId.textContent = transactionId !== 'unknown' ? `#${transactionId}` : 'your order';
                }
                if (confirmationEmail) {
                    confirmationEmail.textContent = 'your inbox';
                }
            }

            if (!summaryData && summaryElements.quote) {
                summaryElements.quote.textContent = formatCurrency(displayQuote);
            }

            if (summaryElements.shippingPreference) {
                const currentPreference = summaryElements.shippingPreference.textContent.trim();
                if (!currentPreference || currentPreference === 'â€”') {
                    summaryElements.shippingPreference.textContent = formatShippingPreference(resolvedShippingPreference);
                }
            }

            const normalizedShipping = (resolvedShippingPreference || '').toLowerCase();
            if (normalizedShipping.includes('ship_kit') || normalizedShipping.includes('kit')) {
                shippingInstruction.innerHTML = `
                    <strong>Shipping Kit Instructions:</strong>
                    <span class="block mt-2">
                        We've shipped a prepaid shipping kit to your address. Please use the provided materials to carefully package your device and drop it off at any USPS location.
                    </span>
                `;
            }

            if (summaryElements.orderId && !summaryElements.orderId.textContent.trim()) {
                summaryElements.orderId.textContent = transactionId !== 'unknown' ? `#${transactionId}` : 'Pending';
            }

            // Add tracking pixel for customer selling
            // Format: <iframe src="https://scdcb.com/p.ashx?a=144&e=305&t=TRANSACTION_ID&p=BASKET_TOTAL" height="1" width="1" frameborder="0"></iframe>
            if (transactionId && transactionId !== 'unknown' && basketTotal && parseFloat(basketTotal) > 0) {
                const trackingPixel = document.createElement('iframe');
                trackingPixel.src = `https://scdcb.com/p.ashx?a=144&e=305&t=${encodeURIComponent(transactionId)}&p=${parseFloat(basketTotal).toFixed(2)}`;
                trackingPixel.height = '1';
                trackingPixel.width = '1';
                trackingPixel.frameBorder = '0';
                trackingPixel.style.display = 'none';
                document.body.appendChild(trackingPixel);
                console.log('Tracking pixel loaded:', trackingPixel.src);
            } else {
                console.warn('Tracking pixel not loaded: Missing transaction ID or basket total');
            }
        });
    </script>

</body>
</html>
