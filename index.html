<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecondHandCell - Turn Your Old Phone Into Cash!</title>
    <meta name="description" content="Turn your old phone into cash with SecondHandCell. Get a quick, easy, and transparent quote for your iPhone, Samsung, and more. Shipping kit available and fast payment." />
    
    <meta name="author" content="Saul Setton" />
    <meta name="keywords" content="sell used phone, trade in old phone, get cash for phone, sell iPhone, sell Samsung, secondhand cell, used device buyer, iPhone trade-in, Samsung trade-in" />
    <link rel="canonical" href="https://secondhandcell.com/" />
    <link rel="icon" href="/favicon/favicon.ico" type="image/x-icon" />

    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "https://secondhandcell.com/#organization",
      "name": "SecondHandCell",
      "url": "https://secondhandcell.com/",
      "logo": "https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/assets/logo.png",
      "sameAs": [
        "https://www.trustpilot.com/evaluate/secondhandcell.com",
        "https://www.yelp.com/writeareview/biz/KWMxMMypF1yAfwH1rdKgJw"
      ]
    },
    {
      "@type": "WebSite",
      "@id": "https://secondhandcell.com/#website",
      "url": "https://secondhandcell.com/",
      "name": "SecondHandCell - Turn Your Old Phone Into Cash!",
      "description": "Get an instant, transparent, and hassle-free quote for your used iPhone, Samsung, and more. Shipping kit available and fast payment.",
      "publisher": { "@id": "https://secondhandcell.com/#organization" },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://secondhandcell.com/search/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      },
      "hasPart": [
        {
          "@type": "WebPage",
          "url": "https://secondhandcell.com/sell-device/",
          "name": "Get Instant Quote"
        },
        {
          "@type": "WebPage",
          "url": "https://secondhandcell.com/iphone/",
          "name": "Sell Your iPhone"
        },
        {
          "@type": "WebPage",
          "url": "https://secondhandcell.com/samsung/",
          "name": "Sell Your Samsung"
        }
      ]
    }
  ]
}
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/favicon/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-W3BM2JC8');</script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17534255111"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'AW-17534255111');
        gtag('config', 'G-8JYPJDKSP8');
    </script>

    <script type="text/javascript" src="//widget.trustpilot.com/bootstrap/v5/tp.widget.bootstrap.min.js" async></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        /* NEW: Diagonal line background pattern for the body */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #0f172a; /* Dark blue background */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0l100 100' stroke-width='1' stroke='%23ffffff' opacity='0.05'/%3E%3Cpath d='M100 0L0 100' stroke-width='1' stroke='%23ffffff' opacity='0.05'/%3E%3C/svg%3E");
            background-size: 20px 20px;
            color: #1a202c; /* Ensure content is readable on light sections */
        }
        
        /* NEW: Fade-in animation for sections on scroll */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeInUp { animation: fadeInUp 0.8s ease-out forwards; }
        
        .homepage-card-link:hover .homepage-card-inner,
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .homepage-card-inner, .feature-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .user-monogram {
            display: flex; align-items: center; justify-content: center;
            width: 2.5rem; height: 2.5rem;
            border-radius: 9999px;
            background-color: #dbeafe; color: #1d4ed8;
            font-weight: 700; font-size: 1.125rem;
            cursor: pointer; user-select: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .auth-dropdown {
            position: absolute; right: 0; margin-top: 0.5rem;
            width: 12rem; background-color: white;
            border-radius: 0.375rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding-top: 0.25rem; padding-bottom: 0.25rem;
            z-index: 50;
        }

        .modal {
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            opacity: 0; visibility: hidden;
        }

        .modal.is-visible {
            opacity: 1; visibility: visible;
        }

        .modal-content {
            transform: translateY(-20px);
            transition: transform 0.3s ease-out;
        }

        .modal.is-visible .modal-content {
            transform: translateY(0);
        }

        .btn-google-style {
            display: flex; align-items: center; justify-content: center;
            width: 100%; background-color: white; color: #475569;
            padding: 0.75rem 1rem; border-radius: 0.5rem;
            border: 1px solid #cbd5e1; font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            cursor: pointer;
        }

        .btn-google-style:hover { background-color: #f8fafc; }

        .btn-dark-slate {
            width: 100%; background-color: #1e293b; color: white;
            padding: 0.75rem 1rem; border-radius: 0.5rem;
            font-weight: 600; transition: all 0.3s ease;
            border: none; cursor: pointer;
        }

        .btn-dark-slate:hover { background-color: #0f172a; }

        .btn-red-logout {
            display: block; width: 100%; text-align: left;
            padding: 0.5rem 1rem; font-size: 0.875rem; color: #dc2626;
            background-color: transparent; border: none;
            transition: background-color 0.2s ease; cursor: pointer;
        }

        .btn-red-logout:hover { background-color: #fef2f2; }

        #chat-widget-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        #chat-open-btn {
            background-color: #2563eb; color: white;
            width: 4rem; height: 4rem; border-radius: 9999px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.2);
            cursor: pointer; transition: transform 0.2s ease-in-out, opacity 0.3s ease-in-out;
        }

        #chat-open-btn:hover { transform: scale(1.1); }

        #unread-counter {
            position: absolute; top: -4px; right: -4px;
            background-color: #ef4444; color: white;
            border-radius: 9999px; font-size: 0.75rem; font-weight: bold;
            width: 1.5rem; height: 1.5rem;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid white;
            transform: scale(0); transition: transform 0.2s ease-out;
        }

        #unread-counter.visible { transform: scale(1); }

        #chat-window {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 24rem;
            height: 32rem;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        #chat-window.is-visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        #chat-window.is-visible + #chat-open-btn {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }

        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            background-color: #f8fafc;
            display: flex;
            flex-direction: column;
        }

        #globalTooltip {
            visibility: hidden;
            background-color: #334155;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 8px;
            position: fixed;
            z-index: 99999;
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
            font-size: 0.75rem;
            pointer-events: none;
        }

        .typing-indicator { display: flex; align-items: center; padding: 8px 12px; }
        .typing-indicator span {
            height: 8px; width: 8px; margin: 0 2px;
            background-color: #9ca3af; border-radius: 50%;
            display: inline-block; animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

        .star-rating i { color: #d1d5db; cursor: pointer; transition: color 0.2s; }
        .star-rating:hover i, .star-rating i.selected { color: #f59e0b; }
        .star-rating i:hover ~ i { color: #d1d5db; }
        
        .prose { max-width: 65ch; color: #334155; }
        .prose h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5em; margin-bottom: 0.5em; }
        .prose p, .prose ul { margin-bottom: 1em; }
        .prose ul { list-style-position: inside; padding-left: 1em; }
        .prose li { margin-bottom: 0.5em; }

        .floating-banner {
            position: sticky;
            top: 7rem;
            z-index: 30;
            animation: slideIn 0.8s ease-out;
            border-bottom-left-radius: 0.75rem;
            border-bottom-right-radius: 0.75rem;
            width: 100%;
            box-sizing: border-box;
        }

        .floating-banner-content {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 1rem 4rem 1rem 1rem;
        }

        .floating-banner-close {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.5rem;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .floating-banner-close:hover { color: #fca5a5; }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        #google_cat_img_container {
            width: 6rem;
            height: 6rem;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: auto;
            margin-bottom: 1rem;
        }
        #google_cat_img {
            transform: scale(1.2);
            object-fit: contain;
            width: 100%;
            height: 100%;
        }

        .fancy-header-text { font-family: 'Dancing Script', cursive; }

        .order-card {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background-color: #f1f5f9;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .order-card:hover { background-color: #e2e8f0; }

        .order-card-details { flex-grow: 1; font-size: 0.875rem; }
        .order-card-details strong { display: block; font-weight: 600; color: #1e293b; }
        .order-card-details span { color: #475569; }
        .order-card-details .reoffer { color: #ef4444; font-weight: 600; }

        /* HERO SECTION STYLES (Neutralized) */
        .hero-section {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.92)); /* Dark slate gradient */
            position: relative;
            padding-top: 3rem;
            padding-bottom: 2rem;
            overflow: hidden;
            animation: fadeIn 1s ease-in-out;
            border: none; /* Removed the orange border */
            box-shadow: 0 45px 80px -45px rgba(15, 23, 42, 0.8); /* Neutralized shadow color */
        }
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, rgba(59, 130, 246, 0.3), rgba(15, 23, 42, 0.4)); /* Neutral blue/dark gradient */
            opacity: 0.85;
            z-index: 1;
        }
        .hero-section::after {
            content: '';
            position: absolute;
            inset: 0;
            pointer-events: none;
            background-image:
                /* Replaced spooky gradients with subtle white noise pattern for texture */
                radial-gradient(circle at 12% 22%, rgba(255, 255, 255, 0.1) 0, transparent 55%),
                radial-gradient(circle at 88% 18%, rgba(255, 255, 255, 0.05) 0, transparent 45%);
            mix-blend-mode: normal;
            opacity: 0.7;
            z-index: 1;
        }
        .hero-content {
            position: relative;
            z-index: 2;
        }

        /* NEW Base class for ghosted phones on desktop */
        .hero-phone-ghost {
            position: absolute;
            top: 50%;
            height: auto;
            opacity: 0.35;
            filter: hue-rotate(-25deg) saturate(140%) brightness(120%);
            z-index: 1;
            transition: all 0.5s ease-in-out;
            /* Adjust size for responsiveness based on 500px width/250px height ratio of iPhone */
            max-width: 500px;
            mix-blend-mode: screen;
        }
        
        /* iPhone 15 Pro Max (200x250 ratio, using 500px width for max size) */
        #iphone-ghost {
            width: 500px;
            /* iPhone width is 200 units, height is 250 units. Ratio 200/250 = 0.8. If max-width=500, then max-height = 500/0.8 = 625px. We set width to 500px to maintain size. */
            right: 0; 
            transform: translateY(-50%) translateX(20%) rotate(-4deg);
        }

        /* Samsung S24 Ultra (216x216 ratio, adjusting relative to iPhone size)
            iPhone width (200) is 0.926 * Samsung width (216). 
            We want the Samsung image to scale relative to the 500px wide iPhone image. 
            New Samsung width should be roughly (500 / 0.8) * 0.926 * (216/216 ratio correction) ~ 578px at full height, but let's maintain a similar large, ghostly visual presence by using the same base width. 
            Since the ratio is 216/216=1, the effective relative size should be slightly larger than the iPhone.
            Let's use a 550px width for the Samsung to slightly increase its visual presence and maintain proportion. 
        */
        #samsung-ghost {
            width: 550px; /* Slightly wider than the iPhone image for presence */
            left: 0;
            transform: translateY(-50%) translateX(-20%) rotate(6deg);
            /* IMPORTANT: Removed scaleX(-1) to un-mirror the image. */
        }
        
        .action-button {
            transition: all 0.3s ease-in-out;
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        .action-button:hover {
            transform: translateY(-3px) scale(1.02);
        }
        .action-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: rgba(255, 255, 255, 0.15);
            transform: translate(-50%, -50%) rotate(45deg);
            transition: all 0.6s ease;
            z-index: -1;
        }
        .action-button:hover::before {
            background: rgba(255, 255, 255, 0.3);
            width: 0;
            height: 0;
        }
        
        .card-container {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        /* NEW: Style for the review link cards */
        .review-link-card:hover .card-container {
            transform: scale(1.02);
            box-shadow: 0 15px 25px -5px rgba(0,0,0,0.15);
        }

        /* Customer testimonial carousel styling */
        .testimonial-section {
            position: relative;
            background: #f7faff;
        }

        .testimonial-glow {
            position: absolute;
            width: 320px;
            height: 320px;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.75;
            z-index: 0;
        }

        .testimonial-glow--left {
            top: -120px;
            left: -80px;
            background: radial-gradient(circle at center, rgba(79, 70, 229, 0.4), rgba(59, 130, 246, 0.1));
        }

        .testimonial-glow--right {
            bottom: -160px;
            right: -60px;
            background: radial-gradient(circle at center, rgba(14, 165, 233, 0.45), rgba(191, 219, 254, 0.05));
        }

        .testimonial-card {
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 1.5rem;
            border: 1px solid rgba(191, 219, 254, 0.7);
            box-shadow: 0 35px 65px -40px rgba(37, 99, 235, 0.55);
            padding: 2.25rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            transition: transform 0.35s ease, box-shadow 0.35s ease, opacity 0.35s ease;
        }

        .testimonial-card::after {
            content: '';
            position: absolute;
            inset: 1px;
            border-radius: 1.45rem;
            background: linear-gradient(180deg, rgba(226, 232, 240, 0.04), rgba(15, 23, 42, 0.02));
            pointer-events: none;
            z-index: -1;
        }

        .testimonial-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 45px 70px -36px rgba(30, 64, 175, 0.65);
        }

        .testimonial-card-enter {
            animation: testimonialFadeIn 0.6s ease both;
        }

        @keyframes testimonialFadeIn {
            from {
                opacity: 0;
                transform: translateY(18px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .testimonial-stars {
            color: #facc15;
            display: flex;
            gap: 0.35rem;
            font-size: 1.1rem;
        }

        .testimonial-rating-label {
            font-size: 0.95rem;
            font-weight: 600;
            color: #0f172a;
        }

        .testimonial-profile {
            display: flex;
            align-items: center;
            gap: 0.9rem;
        }

        .testimonial-avatar {
            width: 3.25rem;
            height: 3.25rem;
            border-radius: 9999px;
            object-fit: cover;
            box-shadow: 0 12px 25px -18px rgba(15, 23, 42, 0.65);
        }

        .testimonial-name {
            font-weight: 700;
            color: #0f172a;
        }

        .testimonial-role {
            font-size: 0.9rem;
            color: #475569;
        }

        @media (max-width: 1023px) {
            .testimonial-glow {
                filter: blur(90px);
                width: 260px;
                height: 260px;
            }
        }

        @media (max-width: 767px) {
            .testimonial-card {
                padding: 1.75rem;
            }
            .testimonial-glow {
                display: none;
            }
        }
        
        @media (max-width: 767px) {
            /* Hiding the large ghosted phones on mobile */
            .hero-phone-ghost {
                display: none;
            }
            .hero-section {
                padding-top: 4rem;
                padding-bottom: 4rem;
            }
            .hero-section h1 {
                font-size: 2.25rem;
            }
            .hero-section p {
                font-size: 1rem;
            }
            .hero-section a {
                padding: 0.75rem 2rem;
            }
            #chat-window {
                width: 100vw;
                height: 100vh;
                top: 0;
                left: 0;
                border-radius: 0;
                box-shadow: none;
                transform: none;
            }
        }
    </style>
    <script src="/assets/js/layout.js" defer></script>
</head>
<body class="bg-slate-50">
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W3BM2JC8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
        <div class="container mx-auto px-4 py-3 flex items-center md:py-5 justify-between">
            <div class="flex-1 flex justify-start items-center logo-container-left">
                <a href="#" class="h-12 md:h-20 w-auto">
                    <img src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/assets/logo.png" alt="SecondHandCell Logo" class="h-full w-auto" onerror="this.onerror=null;this.src='https://placehold.co/200x64/ffffff/1e293b?text=SecondHandCell';">
                </a>
            </div>
            <div class="flex-none flex-col items-center hidden md:flex logo-text-container-center">
                <div class="text-xl md:text-2xl font-extrabold whitespace-nowrap">
                    <span class="text-black">Second</span><span class="text-green-500">HandCell</span>
                </div>
                <p class="text-[0.6rem] md:text-sm -mt-1 whitespace-nowrap text-green-500">Turn Your Old<span class="text-black"> Phone Into Cash!</span></p>
            </div>
            <nav class="flex-1 flex justify-end items-center space-x-4">
                <div id="authStatusContainer" class="relative inline-block">
                    <a href="#" id="loginNavBtn" class="bg-indigo-600 text-white px-2.5 py-1.5 md:px-4 md:py-2 rounded-full font-semibold hover:bg-indigo-700 transition-colors duration-300 shadow-sm text-xs md:text-base">Login/Sign Up</a>
                    <div id="userMonogram" class="user-monogram hidden"></div>
                    <div id="authDropdown" class="auth-dropdown hidden rounded-lg shadow-xl">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-t-lg">My Account</a>
                        <button id="logoutBtn" class="btn-red-logout rounded-b-lg">Logout</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>
    <main>
        <section class="hero-section text-center">
            <div id="iphone-ghost" class="hero-phone-ghost animate-pulse">
                <img src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/iphone/assets/i15pm.webp" alt="iPhone 15 Pro Max" class="w-full h-auto">
            </div>
            <div id="samsung-ghost" class="hero-phone-ghost animate-pulse">
                <img src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/samsung/assets/s24u.webp" alt="Samsung Galaxy S24 Ultra" class="w-full h-auto">
            </div>

            <div class="container mx-auto px-4 hero-content">
                <div class="block md:hidden mb-8">
                    <img src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/iphone/assets/i15pm.webp" alt="iPhone 15 Pro Max" class="mx-auto w-32 h-auto animate-pulse">
                </div>
                <div class="bg-indigo-600/20 text-indigo-200 border border-indigo-500/50 mx-auto mb-6 px-4 py-2 rounded-full text-sm md:text-base tracking-[0.25em] inline-flex items-center gap-2">
                    <i class="fa-solid fa-bolt text-lg md:text-xl"></i>
                    <span>Best Price Guarantee</span>
                </div>

                <h1 class="text-5xl md:text-7xl font-extrabold text-white mb-4 leading-tight">
                    <span class="block">Turn Yesterday‚Äôs Phone Into</span>
                    <span class="text-green-400">Maximum Cash Fast!</span>
                </h1>
                <p class="max-w-3xl mx-auto text-lg md:text-xl text-orange-100/90 mb-8">
                    Get a lightning-fast quote for your iPhone, Samsung, and more. Enjoy easy shipping options, speedy inspections, and payouts that hit your account quickly.
                </p>
                <a href="sell-device.html" id="heroOfferBtn" class="bg-green-500 text-white px-10 py-5 rounded-full font-bold text-lg shadow-lg hover:bg-green-600 action-button inline-block">
                    Get My Instant Quote
                </a>
                <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-8 mt-12 text-center text-white">
                    <div>
                        <p class="text-4xl font-extrabold">100K+</p>
                        <p class="text-sm uppercase tracking-wide">Devices Bought</p>
                    </div>
                    <div>
                        <p class="text-4xl font-extrabold">98%</p>
                        <p class="text-sm uppercase tracking-wide">Customer Satisfaction</p>
                    </div>
                    <div>
                        <p class="text-4xl font-extrabold">$400+</p>
                        <p class="text-sm uppercase tracking-wide">Avg. Payout</p>
                    </div>
                    <div>
                        <p class="text-4xl font-extrabold">24H</p>
                        <p class="text-sm uppercase tracking-wide">Fast Payment</p>
                    </div>
                </div>
                <p class="mt-8 text-sm md:text-base uppercase tracking-[0.3em] text-orange-100/80">Shipping kit available with every trade-in.</p>
            </div>
        </section>

        <section id="features" class="bg-slate-50 container mx-auto px-4 py-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Why Sell With Us?</h2>
                <p class="mt-3 text-lg text-slate-600">Our process is simple, safe, and gets you the most for your device.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="animate-on-scroll feature-card card-container text-center"><div class="mx-auto mb-4 w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center text-3xl text-blue-600">üì¶</div><h3 class="text-xl font-semibold mb-2 text-slate-800" id="feature-shipping-btn">Shipping Kit Available</h3><p class="text-slate-600">We send you a prepaid box. Just pack your device and drop it in the mail.</p></div>
                <div class="animate-on-scroll feature-card card-container text-center"><div class="mx-auto mb-4 w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center text-3xl text-blue-600">üí∏</div><h3 class="text-xl font-semibold mb-2 text-slate-800" id="feature-payment-btn">Fast Payment</h3><p class="text-slate-600">Get paid quickly via Venmo, Zelle, or PayPal as soon as we inspect your device.</p></div>
                <div class="animate-on-scroll feature-card card-container text-center"><div class="mx-auto mb-4 w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center text-3xl text-blue-600">üõ°Ô∏è</div><h3 class="text-xl font-semibold mb-2 text-slate-800" id="feature-data-btn">Data Protection">Data Protection</h3><p class="text-slate-600">We professionally wipe all personal data from every device we receive.</p></div>
                <div class="animate-on-scroll feature-card card-container text-center"><div class="mx-auto mb-4 w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center text-3xl text-blue-600">üîí</div><h3 class="text-xl font-semibold mb-2 text-slate-800" id="feature-payout-btn">Highest Payouts</h3><p class="text-slate-600">Our price-lock guarantee ensures you get the quote you were offered.</p></div>
            </div>
        </section>

        <section id="customer-reviews" class="testimonial-section py-20 overflow-hidden">
            <div class="testimonial-glow testimonial-glow--left" aria-hidden="true"></div>
            <div class="testimonial-glow testimonial-glow--right" aria-hidden="true"></div>
            <div class="container mx-auto px-4 relative z-[1]">
                <div class="text-center max-w-3xl mx-auto">
                    <span class="text-xs md:text-sm font-semibold uppercase tracking-[0.25em] text-sky-500">500+ 3‚Äì5 Star Reviews</span>
                    <h2 class="mt-4 text-3xl md:text-4xl font-bold text-slate-900">What Our Customers Say</h2>
                    <div class="mt-5 flex flex-col items-center gap-3">
                        <div class="testimonial-stars text-2xl" aria-hidden="true">
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star-half-stroke"></i>
                        </div>
                        <p class="testimonial-rating-label text-slate-600">4.8 out of 5 based on 2,341 reviews</p>
                    </div>
                    <p class="mt-4 text-base md:text-lg text-slate-600">Join thousands of sellers who rave about our quick payouts, responsive support, and simple shipping options.</p>
                </div>
                <div class="mt-12 relative" role="region" aria-live="polite" aria-label="Customer testimonials carousel">
                    <div id="customerReviewsTrack" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                        <article class="testimonial-card testimonial-card-enter">
                            <div>
                                <div class="testimonial-stars" aria-hidden="true">
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                </div>
                                <p class="mt-3 text-slate-600 leading-relaxed">‚ÄúSecondHandCell handled my iPhone trade-in in days. The shipping kit arrived quickly, inspection was honest, and the payout hit my account the same afternoon.‚Äù</p>
                            </div>
                            <div class="testimonial-profile">
                                <img src="https://thispersondoesnotexist.com/?id=shc1" alt="Portrait of Jennifer Martinez" class="testimonial-avatar">
                                <div>
                                    <p class="testimonial-name">Jennifer Martinez</p>
                                    <p class="testimonial-role">iPhone 15 Pro Max Seller</p>
                                </div>
                            </div>
                        </article>
                        <article class="testimonial-card testimonial-card-enter">
                            <div>
                                <div class="testimonial-stars" aria-hidden="true">
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star-half-stroke"></i>
                                </div>
                                <p class="mt-3 text-slate-600 leading-relaxed">‚ÄúThe $10 shipping kit deduction was worth it‚Äîeverything I needed was in the box. Their portal kept me updated until the payout cleared the next morning.‚Äù</p>
                            </div>
                            <div class="testimonial-profile">
                                <img src="https://thispersondoesnotexist.com/?id=shc2" alt="Portrait of Robert Johnson" class="testimonial-avatar">
                                <div>
                                    <p class="testimonial-name">Robert Johnson</p>
                                    <p class="testimonial-role">Galaxy S23 Ultra Seller</p>
                                </div>
                            </div>
                        </article>
                        <article class="testimonial-card testimonial-card-enter">
                            <div>
                                <div class="testimonial-stars" aria-hidden="true">
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                </div>
                                <p class="mt-3 text-slate-600 leading-relaxed">‚ÄúAs a teacher with zero free time, I loved how transparent the process was. I chose an email label, shipped the same day, and had my Zelle transfer within 24 hours.‚Äù</p>
                            </div>
                            <div class="testimonial-profile">
                                <img src="https://thispersondoesnotexist.com/?id=shc3" alt="Portrait of Lisa Thompson" class="testimonial-avatar">
                                <div>
                                    <p class="testimonial-name">Lisa Thompson</p>
                                    <p class="testimonial-role">Teacher ‚Ä¢ Chicago, IL</p>
                                </div>
                            </div>
                        </article>
                    </div>
                </div>
            </div>
        </section>

        <section id="popular" class="bg-white py-20">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Popular Devices We Buy</h2>
                    <p class="mt-3 text-lg text-slate-600">From the latest models to older favorites, we buy them all.</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                    <a href="sell/?device=iphone-15-pro-max" class="animate-on-scroll homepage-card-link group"><div class="homepage-card-inner card-container text-center flex flex-col h-full"><img id="i15pm_pop_img" src="" data-base-src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/iphone/assets/i15pm" alt="iPhone 15 Pro Max" class="mx-auto mb-4 h-40 object-contain"><h3 class="text-xl font-semibold mb-2 text-slate-800">iPhone 15 Pro Max</h3><p class="text-green-600 font-bold mb-4">Up to $700</p><span id="popularOfferBtn-i15pm" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium mt-auto w-full group-hover:bg-green-600 group-hover:text-white transition-colors duration-300 text-sm">Get Offer</span></div></a>
                    <a href="sell/?device=samsung-galaxy-s24-ultra" class="animate-on-scroll homepage-card-link group"><div class="homepage-card-inner card-container text-center flex flex-col h-full"><img id="s24u_pop_img" src="" data-base-src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/samsung/assets/s24u" alt="Samsung Galaxy S24 Ultra" class="mx-auto mb-4 h-40 object-contain"><h3 class="text-xl font-semibold mb-2 text-slate-800">Samsung Galaxy S24 Ultra</h3><p class="text-green-600 font-bold mb-4">Up to $600</p><span id="popularOfferBtn-s24u" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium mt-auto w-full group-hover:bg-green-600 group-hover:text-white transition-colors duration-300 text-sm">Get Offer</span></div></a>
                    <a href="sell/?device=iphone-16" class="animate-on-scroll homepage-card-link group"><div class="homepage-card-inner card-container text-center flex flex-col h-full"><img id="i13_pop_img" src="" data-base-src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/iphone/assets/i16" alt="iPhone 16" class="mx-auto mb-4 h-40 object-contain"><h3 class="text-xl font-semibold mb-2 text-slate-800">iPhone 16</h3><p class="text-green-600 font-bold mb-4">Up to $532</p><span id="popularOfferBtn-i13" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium mt-auto w-full group-hover:bg-green-600 group-hover:text-white transition-colors duration-300 text-sm">Get Offer</span></div></a>
                    <a href="sell/?device=samsung-galaxy-s22" class="animate-on-scroll homepage-card-link group"><div class="homepage-card-inner card-container text-center flex flex-col h-full"><img id="s22_pop_img" src="" data-base-src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/samsung/assets/s22" alt="Samsung Galaxy S22" class="mx-auto mb-4 h-40 object-contain"><h3 class="text-xl font-semibold mb-2 text-slate-800">Samsung Galaxy S22</h3><p class="text-green-600 font-bold mb-4">Up to $250</p><span id="popularOfferBtn-s22" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium mt-auto w-full group-hover:bg-green-600 group-hover:text-white transition-colors duration-300 text-sm">Get Offer</span></div></a>
                </div>
            </div>
        </section>

        <section id="external-reviews" class="bg-slate-100 py-20">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Trusted By Thousands</h2>
                    <p class="mt-3 text-lg text-slate-600">See our latest reviews and ratings on external, independent platforms.</p>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-12 max-w-4xl mx-auto">
                    
                    <a href="https://search.google.com/local/reviews?placeid=YOUR_GOOGLE_PLACE_ID" target="_blank" id="google-review-link" class="animate-on-scroll review-link-card group">
                        <div class="card-container text-center flex flex-col items-center justify-center p-6 h-full transition-all group-hover:shadow-xl border-t-4 border-blue-600">
                            <div class="w-16 h-16 mb-3 flex items-center justify-center">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg" alt="Google Logo" class="h-10 w-auto">
                            </div>
                            <h3 class="text-xl font-bold text-slate-800 mb-1">Google Reviews</h3>
                            <p class="text-sm text-slate-500">Read our public customer reviews.</p>
                            <span class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-semibold group-hover:bg-blue-700 transition">See Reviews</span>
                        </div>
                    </a>

                    <a href="https://www.trustpilot.com/evaluate/secondhandcell.com" target="_blank" id="trustpilot-review-link" class="animate-on-scroll review-link-card group">
                        <div class="card-container text-center flex flex-col items-center justify-center p-6 h-full transition-all group-hover:shadow-xl border-t-4 border-green-600">
                            <div class="w-16 h-16 mb-3 flex items-center justify-center">
                                <i class="fa-solid fa-star text-4xl text-green-500"></i>
                            </div>
                            <h3 class="text-xl font-bold text-slate-800 mb-1">Trustpilot</h3>
                            <p class="text-sm text-slate-500">Check our verified customer rating.</p>
                            <span class="mt-4 bg-green-600 text-white px-4 py-2 rounded-full text-sm font-semibold group-hover:bg-green-700 transition">View Rating</span>
                        </div>
                    </a>

                    <a href="https://www.yelp.com/writeareview/biz/KWMxMMypF1yAfwH1rdKgJw" target="_blank" id="yelp-review-link" class="animate-on-scroll review-link-card group">
                        <div class="card-container text-center flex flex-col items-center justify-center p-6 h-full transition-all group-hover:shadow-xl border-t-4 border-red-600">
                            <div class="w-16 h-16 mb-3 flex items-center justify-center">
                                <i class="fa-solid fa-bullhorn text-4xl text-red-500"></i>
                            </div>
                            <h3 class="text-xl font-bold text-slate-800 mb-1">Yelp Reviews</h3>
                            <p class="text-sm text-slate-500">See what local customers are saying.</p>
                            <span class="mt-4 bg-red-600 text-white px-4 py-2 rounded-full text-sm font-semibold group-hover:bg-red-700 transition">Read Reviews</span>
                        </div>
                    </a>
                </div>

                <div class="trustpilot-widget mx-auto" data-locale="en-US" data-template-id="5419b6a8b0d04a076446a9ad" data-businessunit-id="65287f3b89b88af37b51b34e" data-style-height="130px" data-style-width="100%" data-theme="light" data-min-review-count="10" data-font-family="system-ui,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,Oxygen,Ubuntu,Cantarell,&quot;Fira Sans&quot;,&quot;Droid Sans&quot;,&quot;Helvetica Neue&quot;,sans-serif">
                    <a href="https://www.trustpilot.com/review/secondhandcell.com" target="_blank" rel="noopener">Trustpilot</a>
                </div>
            </div>
        </section>

        <section id="cta" class="bg-indigo-600 py-16 text-center">
            <div class="container mx-auto px-4">
                <h2 class="text-4xl md:text-5xl font-extrabold text-white mb-4">Ready to Turn Your Device Into Cash?</h2>
                <p class="text-lg text-indigo-100 mb-8 max-w-2xl mx-auto">Get your instant quote now‚Äîit only takes 60 seconds. Our quotes are guaranteed for 30 days.</p>
                <a href="sell-device.html" id="finalOfferBtn" class="bg-white text-indigo-700 px-12 py-4 rounded-full font-bold text-xl shadow-2xl action-button hover:bg-indigo-50 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 inline-block">
                    Sell Device Now!
                    <i class="fa-solid fa-arrow-right-long ml-2"></i>
                </a>
            </div>
        </section>
    </main>
    <footer class="bg-slate-800 text-white">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-8">
                    <div><h3 class="text-xl font-bold mb-4">SecondHandCell</h3><p class="text-slate-400">Your trusted partner for selling used tech. Quick quotes, fair prices, and hassle-free service.</p></div>
                    <div><h3 class="text-xl font-bold mb-4">Quick Links</h3><ul class="space-y-2"><li><a href="#" class="text-slate-400 hover:text-white transition duration-300">Home</a></li><li><a href="#" id="aboutUsLink" class="text-slate-400 hover:text-white transition duration-300">About Us</a></li><li><a href="privacy.html" class="text-slate-400 hover:text-white transition duration-300">Privacy Policy</a></li><li><a href="terms.html" class="text-slate-400 hover:text-white transition duration-300">Terms & Conditions</a></li></ul></div>
                    <div><h3 class="text-xl font-bold mb-4">Contact Us</h3><p class="text-slate-400">Email: support@secondhandcell.com</p></div>
                </div>
                <div class="bg-slate-700 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-2 text-white">Stay Updated</h3>
                    <p class="text-slate-300 mb-4">Sign up for promos, price increases, and more!</p>
                    <form id="footerEmailSignupForm" class="flex flex-col sm:flex-row gap-2">
                        <label for="footerPromoEmail" class="sr-only">Email Address</label>
                        <input type="email" id="footerPromoEmail" placeholder="Enter your email" class="w-full flex-grow border border-slate-400 bg-slate-800 text-white p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <button type="submit" id="footerSignupBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-300 shadow-sm">Sign Up</button>
                    </form>
                    <p id="footerSignupMessage" class="mt-3 text-sm text-center text-slate-400 hidden"></p>
                </div>
            </div>
            <div class="mt-12 border-t border-slate-700 pt-8 text-center">
                <p class="text-slate-400 text-sm">&copy; 2024 SecondHandCell. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div id="loginModal" class="modal fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="modal-content bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-slate-800" id="authModalTitle">Login to Your Account</h2>
                <button class="text-slate-400 hover:text-slate-600 transition close-modal-btn" aria-label="Close modal"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            <div class="flex justify-center mb-6 border-b border-slate-200">
                <button id="loginTabBtn" class="px-4 py-2 font-semibold text-slate-800 border-b-2 border-indigo-600 transition-colors duration-200">Login</button>
                <button id="signupTabBtn" class="px-4 py-2 font-semibold text-slate-500 hover:text-slate-800 transition-colors duration-200">Sign Up</button>
            </div>
            <div id="authMessage" class="hidden p-3 rounded-lg text-sm mb-4" role="alert"></div>

            <form id="loginForm" class="space-y-4">
                <p class="text-slate-600 text-center">Sign in to track your trade-in and manage orders.</p>
                <button type="button" id="googleLoginBtn" class="btn-google-style">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google icon" class="w-5 h-5 mr-3">
                    Login with Google
                </button>
                <div class="text-center text-slate-500 relative my-4">
                    <span class="bg-white px-2 z-10 relative">or</span>
                    <hr class="absolute inset-0 top-1/2 border-t border-slate-200">
                </div>
                <div>
                    <label for="loginEmail" class="sr-only">Email Address</label>
                    <input type="email" id="loginEmail" placeholder="Email Address" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="loginPassword" class="sr-only">Password</label>
                    <input type="password" id="loginPassword" placeholder="Password" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="current-password">
                </div>
                <button type="submit" id="emailLoginBtn" class="btn-dark-slate">Login</button>
                <p class="text-center text-sm text-slate-600">
                    Forgot your password?
                    <a href="#" id="forgotPasswordLink" class="text-blue-600 font-semibold hover:underline">Reset it here</a>
                </p>
            </form>

            <form id="signupForm" class="space-y-4 hidden">
                <p class="text-slate-600 text-center">Create an account to complete your order.</p>
                <button type="button" id="googleSignupBtn" class="btn-google-style">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google icon" class="w-5 h-5 mr-3">
                    Sign Up with Google
                </button>
                <div class="text-center text-slate-500 relative my-4">
                    <span class="bg-white px-2 z-10 relative">or</span>
                    <hr class="absolute inset-0 top-1/2 border-t border-slate-200">
                </div>
                <div>
                    <label for="signupName" class="sr-only">Full Name</label>
                    <input type="text" id="signupName" placeholder="Full Name" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="signupEmail" class="sr-only">Email Address</label>
                    <input type="email" id="signupEmail" placeholder="Email Address" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="email">
                </div>
                <div>
                    <label for="signupPassword" class="sr-only">Password</label>
                    <input type="password" id="signupPassword" placeholder="Password (min 6 characters)" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="new-password">
                </div>
                <button type="submit" id="emailSignupBtn" class="btn-dark-slate">Sign Up</button>
                <p class="text-center text-sm text-slate-600">
                    Already have an account?
                    <a href="#" id="switchToLogin" class="text-blue-600 font-semibold hover:underline">Login here</a>
                </p>
            </form>

            <form id="forgotPasswordForm" class="space-y-4 hidden">
                <p class="text-slate-600 text-center">Enter your email address to receive a password reset link.</p>
                <div>
                    <label for="forgotEmail" class="sr-only">Email Address</label>
                    <input type="email" id="forgotEmail" placeholder="Email Address" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit" id="resetPasswordBtn" class="btn-dark-slate">Send Reset Link</button>
                <p class="text-center text-sm text-slate-600">
                    <a href="#" id="returnToLogin" class="text-blue-600 font-semibold hover:underline">Return to Login</a>
                </p>
            </form>
        </div>
    </div>
    
    <div id="aboutUsModal" class="modal fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="modal-content bg-white p-8 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h2 class="text-3xl font-extrabold text-slate-800">About SecondHandCell</h2>
                <button class="text-slate-400 hover:text-slate-600 transition close-modal-btn" aria-label="Close modal"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            <div class="prose text-left">
                <h2 class="text-indigo-600">Our Mission</h2>
                <p>At SecondHandCell, we believe selling your used electronics should be simple, safe, and rewarding. Our mission is to provide the most transparent and competitive buyback service in the industry, ensuring you get maximum value for your device with zero hassle.</p>
                
                <h2 class="text-indigo-600">Why Choose Us?</h2>
                <h3>Top Prices, Guaranteed</h3>
                <p>We constantly monitor the market to ensure our offers are the best. Our price-lock guarantee means the price we quote is the price you get, provided the condition matches your description.</p>

                <h3>Fast Shipping Options</h3>
                <p>No need to worry about postage. We provide a prepaid shipping kit, making it easy to send your device safely. Once it's in the mail, your job is done!</p>
                
                <h3>Quick Payment</h3>
                <p>Time is money. As soon as your device arrives and passes inspection (usually within 24 hours of receipt), we send your payout instantly via Venmo, Zelle, or PayPal. No long waits, no checks in the mail.</p>
                
                <h3>Data Security First</h3>
                <p>Your privacy is paramount. Every device is professionally and securely wiped upon arrival, ensuring all your personal data is completely removed before the device is processed further.</p>

                <h2 class="text-indigo-600">How It Works (3 Simple Steps)</h2>
                <ol>
                    <li>**Get a Quote:** Select your device, answer a few quick questions about its condition, and get an instant, guaranteed offer.</li>
                    <li>**Ship It:** We'll send you a shipping kit. Drop your device off at any USPS location.</li>
                    <li>**Get Paid:** We inspect the device, and your payment is sent within 24 hours via your preferred method.</li>
                </ol>
                
                <p class="mt-8 italic text-slate-600">Join the thousands of satisfied customers who have trusted SecondHandCell to turn their old phones into cash. Sell smart, sell easy!</p>

            </div>
        </div>
    </div>
    
    <div id="chat-widget-container" class="relative">
        <div id="chat-window" class="z-50 rounded-xl overflow-hidden shadow-2xl">
            <div id="chat-header" class="bg-indigo-700 text-white p-4 flex justify-between items-center rounded-t-xl">
                <div class="flex items-center">
                    <i class="fa-solid fa-headset mr-3"></i>
                    <h3 class="text-lg font-semibold">Live Support</h3>
                </div>
                <div class="flex gap-3">
                    <button id="chat-minimize-btn" class="chat-header-button text-indigo-200 hover:text-white transition-colors duration-200" data-tooltip-text="Minimize Chat">
                        <i class="fa-solid fa-minus"></i>
                    </button>
                    <button id="chat-close-btn" class="chat-header-button text-indigo-200 hover:text-white transition-colors duration-200" data-tooltip-text="End Chat">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>

            <div id="chat-messages">
                </div>
            
            <div id="order-selection-container" class="p-4 border-t border-slate-200 bg-white hidden">
                <div class="flex justify-between items-center mb-3">
                    <p class="text-sm text-slate-600 font-semibold" id="order-selection-prompt">Please select your order:</p>
                    <button id="close-order-selection-btn" class="chat-header-button text-slate-400 hover:text-slate-600 transition-colors duration-200" data-tooltip-text="Close Order Selection">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>
                </div>
                <div id="order-list" class="space-y-2 max-h-48 overflow-y-auto">
                </div>
            </div>

            <div id="typing-indicator-container" class="p-2 hidden">
                <div class="p-3 rounded-lg max-w-[85%] mb-2 break-words chat-bubble-agent">
                    <div class="typing-indicator"><span></span><span></span><span></span></div>
                </div>
            </div>

            <div id="chat-survey-container" class="p-4 border-t border-slate-200 hidden bg-white">
                <p class="text-center font-semibold text-slate-700 mb-3">Rate your chat experience:</p>
                <form id="chat-survey-form" class="space-y-4">
                    <div>
                        <p class="text-sm text-slate-600 mb-2">How friendly was the agent? (<span id="friendliness-value">3</span>/5)</p>
                        <div id="star-rating" class="text-center text-xl star-rating">
                            <i class="fa-solid fa-star" data-rating="1"></i>
                            <i class="fa-solid fa-star" data-rating="2"></i>
                            <i class="fa-solid fa-star selected" data-rating="3"></i>
                            <i class="fa-solid fa-star" data-rating="4"></i>
                            <i class="fa-solid fa-star" data-rating="5"></i>
                            <input type="hidden" id="friendliness-rating" value="3">
                        </div>
                    </div>
                    <div>
                        <label for="surveyComment" class="text-sm text-slate-600">Additional comments (optional):</label>
                        <textarea id="surveyComment" class="w-full border border-slate-300 p-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-300">Submit Feedback</button>
                </form>
            </div>

            <div id="chat-input-container" class="p-4 border-t border-slate-200 flex items-center">
                <input type="text" id="chat-input" placeholder="Type your message..." class="flex-grow border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mr-2">
                <button id="send-message-btn" class="bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-sm" data-tooltip-text="Send Message">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>

            <div id="guest-prompt-container" class="p-4 border-t border-slate-200 hidden bg-slate-900/60">
                <p class="text-center text-sm text-orange-200 mb-4 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-ghost text-orange-400"></i>
                    Sign in to unlock live chat support.
                </p>
                <button id="guest-login-btn" class="btn-dark-slate">Sign In to Chat</button>
                <p class="text-center text-xs text-orange-200/50 mt-2">Chat history will be saved when logged in.</p>
            </div>
        </div>

        <div id="chat-open-btn">
            <i class="fa-solid fa-message text-2xl"></i>
            <span id="unread-counter"></span>
        </div>

        <div id="end-chat-confirm-modal" class="hidden absolute inset-0 bg-black/50 backdrop-blur-sm items-center justify-center p-4 rounded-xl">
            <div class="bg-white p-6 rounded-lg shadow-xl text-center w-full max-w-xs">
                <p class="font-semibold text-lg text-slate-800 mb-4">Are you sure you want to end this chat?</p>
                <div class="flex justify-around gap-4">
                    <button id="end-chat-yes" class="bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition-colors duration-300">Yes, End</button>
                    <button id="end-chat-no" class="bg-slate-300 text-slate-800 px-4 py-2 rounded-lg font-semibold hover:bg-slate-400 transition-colors duration-300">No, Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="globalTooltip" role="tooltip"></div>

    <script src="/workspaces/BuyBacking/assets/js/pages/index.js" defer></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, sendPasswordResetEmail, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, doc, onSnapshot, query, orderBy, serverTimestamp, updateDoc, setDoc, getDocs, runTransaction, FieldValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        setLogLevel('debug');

        // Use global variables provided by the platform
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        const firebaseConfig = {
            apiKey: "AIzaSyAmUGWbpbJIWLrBMJpZb8iMpFt-uc24J0k",
            authDomain: "buyback-a0f05.firebaseapp.com",
            databaseURL: "https://buyback-a0f05-default-rtdb.firebaseio.com",
            projectId: "buyback-a0f05",
            storageBucket: "buyback-a0f05.firebasestorage.app",
            messagingSenderId: "876430429098",
            appId: "1:876430429098:web:f6dd64b1960d90461979d3",
            measurementId: "G-6WWQN44JHT"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Initialize Firebase with the provided config
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Firebase Click Tracker Function ---
        const trackButtonClick = async (buttonName) => {
            const cleanedButtonName = buttonName.replace(/\s/g, '_').replace(/'/g, '');
            const buttonDocRef = doc(db, "button_clicks", cleanedButtonName);
            const userId = auth.currentUser?.uid || getOrCreateGuestId();

            try {
                await runTransaction(db, async (transaction) => {
                    const buttonDoc = await transaction.get(buttonDocRef);
                    if (!buttonDoc.exists()) {
                        transaction.set(buttonDocRef, {
                            count: 1,
                            buttonName: buttonName,
                            history: [{ timestamp: serverTimestamp(), userId: userId }],
                            lastClicked: serverTimestamp()
                        });
                    } else {
                        const newCount = buttonDoc.data().count + 1;
                        const newHistory = [...(buttonDoc.data().history || []), { timestamp: serverTimestamp(), userId: userId }].slice(-50); // Keep last 50
                        transaction.update(buttonDocRef, { 
                            count: newCount, 
                            history: newHistory,
                            lastClicked: serverTimestamp()
                        });
                    }
                });
            } catch (e) {
                console.error("Transaction failed: ", e);
            }
        };

        // Utility to load images with fallbacks
        const loadImageWithFallback = (imgElement) => {
            const baseSrc = imgElement.dataset.baseSrc;
            const extensions = ['.webp', '.png', '.jpg'];
            let current = 0;

            const tryLoad = () => {
                if (current >= extensions.length) {
                    if (imgElement.id.includes('_cat_img')) {
                        imgElement.src = `https://placehold.co/150x150/e0e7ff/4338ca?text=Category`;
                    } else {
                        imgElement.src = `https://placehold.co/200x200/f0f4ff/6366f1?text=No+Image`;
                    }
                    imgElement.alt = "Image not available";
                    return;
                }

                const testSrc = baseSrc + extensions[current];
                const img = new Image();

                img.onload = () => {
                    imgElement.src = testSrc;
                };

                img.onerror = () => {
                    current++;
                    tryLoad();
                };

                img.src = testSrc;
            }

            tryLoad();
        }

        document.querySelectorAll('img[data-base-src]').forEach(loadImageWithFallback);

        const modals = document.querySelectorAll('.modal');
        const openModal = (modalId) => document.getElementById(modalId)?.classList.add('is-visible');
        const closeModal = (modal) => modal.classList.remove('is-visible');

        document.getElementById('loginNavBtn').addEventListener('click', (e) => {
            e.preventDefault();
            openModal('loginModal');
        });

        document.getElementById('aboutUsLink').addEventListener('click', (e) => {
            e.preventDefault();
            openModal('aboutUsModal');
        });

        modals.forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal(modal);
            });
            modal.querySelector('.close-modal-btn')?.addEventListener('click', () => closeModal(modal));
        });

        document.getElementById('heroOfferBtn').addEventListener('click', () => trackButtonClick('Hero_Get_Instant_Offer'));
        document.getElementById('finalOfferBtn').addEventListener('click', () => trackButtonClick('Final_Sell_Device_Now'));

        document.querySelectorAll('.feature-card h3').forEach(card => {
            card.addEventListener('click', () => {
                trackButtonClick(`Feature_Card_${card.textContent.trim()}`);
            });
        });
        
        document.querySelectorAll('.homepage-card-link').forEach(link => {
            link.addEventListener('click', (e) => {
                const deviceName = e.currentTarget.querySelector('h3').textContent;
                trackButtonClick(`Popular_Device_Get_Offer_${deviceName}`);
            });
        });

        // NEW: Click handlers for external review links
        document.querySelectorAll('.review-link-card').forEach(link => {
            link.addEventListener('click', () => {
                const platformName = link.querySelector('h3').textContent;
                trackButtonClick(`External_Review_Click_${platformName.replace(/\s/g, '_')}`);
            });
        });

        const customerReviewsTrack = document.getElementById('customerReviewsTrack');
        if (customerReviewsTrack) {
            const testimonialData = [
                {
                    name: 'Jennifer Martinez',
                    role: 'iPhone 15 Pro Max Seller',
                    rating: 5,
                    review: 'SecondHandCell handled my iPhone trade-in in days. The shipping kit arrived quickly, inspection was honest, and the payout hit my account the same afternoon.',
                    avatar: 'https://thispersondoesnotexist.com/?id=shc1'
                },
                {
                    name: 'Robert Johnson',
                    role: 'Galaxy S23 Ultra Seller',
                    rating: 4.5,
                    review: 'The $10 shipping kit deduction was worth it‚Äîeverything I needed was in the box. Their portal kept me updated until the payout cleared the next morning.',
                    avatar: 'https://thispersondoesnotexist.com/?id=shc2'
                },
                {
                    name: 'Lisa Thompson',
                    role: 'Teacher ‚Ä¢ Chicago, IL',
                    rating: 5,
                    review: 'As a teacher with zero free time, I loved how transparent the process was. I chose an email label, shipped the same day, and had my Zelle transfer within 24 hours.',
                    avatar: 'https://thispersondoesnotexist.com/?id=shc3'
                },
                {
                    name: 'Avery Chen',
                    role: 'Entrepreneur ‚Ä¢ Austin, TX',
                    rating: 4.5,
                    review: 'I recycle phones from my business upgrades. Every order with SecondHandCell has been smooth, and they always explain any adjustments before finalizing the quote.',
                    avatar: 'https://thispersondoesnotexist.com/?id=shc4'
                },
                {
                    name: 'Marisol Rivera',
                    role: 'Nurse ‚Ä¢ Tampa, FL',
                    rating: 5,
                    review: 'Customer support answered my questions in minutes and the payout matched what I was promised. It felt like working with a friend instead of a company.',
                    avatar: 'https://thispersondoesnotexist.com/?id=shc5'
                },
                {
                    name: 'Darius Patel',
                    role: 'Software Engineer ‚Ä¢ Seattle, WA',
                    rating: 4.8,
                    review: 'I compared half a dozen services and this one actually paid what they quoted. The dashboard makes tracking each step effortless.',
                    avatar: 'https://thispersondoesnotexist.com/?id=shc6'
                }
            ];

            const createStarMarkup = (rating) => {
                const stars = [];
                for (let i = 1; i <= 5; i += 1) {
                    if (rating >= i) {
                        stars.push('<i class="fa-solid fa-star"></i>');
                    } else if (rating >= i - 0.5) {
                        stars.push('<i class="fa-solid fa-star-half-stroke"></i>');
                    } else {
                        stars.push('<i class="fa-regular fa-star"></i>');
                    }
                }
                return stars.join('');
            };

            const renderReviewCard = (testimonial) => `
                <article class="testimonial-card testimonial-card-enter">
                    <div>
                        <div class="testimonial-stars" aria-hidden="true">
                            ${createStarMarkup(testimonial.rating)}
                        </div>
                        <p class="mt-3 text-slate-600 leading-relaxed">‚Äú${testimonial.review}‚Äù</p>
                    </div>
                    <div class="testimonial-profile">
                        <img src="${testimonial.avatar}" alt="Portrait of ${testimonial.name}" class="testimonial-avatar">
                        <div>
                            <p class="testimonial-name">${testimonial.name}</p>
                            <p class="testimonial-role">${testimonial.role}</p>
                        </div>
                    </div>
                </article>
            `;

            let carouselIndex = 0;
            const testimonialsPerSlide = 3;

            const renderTestimonials = () => {
                const cards = [];
                for (let offset = 0; offset < testimonialsPerSlide; offset += 1) {
                    const data = testimonialData[(carouselIndex + offset) % testimonialData.length];
                    cards.push(renderReviewCard(data));
                }
                customerReviewsTrack.innerHTML = cards.join('');
            };

            const advanceCarousel = () => {
                carouselIndex = (carouselIndex + testimonialsPerSlide) % testimonialData.length;
                renderTestimonials();
            };

            renderTestimonials();

            const intervalDelay = 5000;
            let carouselTimer = window.setInterval(advanceCarousel, intervalDelay);

            const pauseCarousel = () => {
                if (carouselTimer) {
                    window.clearInterval(carouselTimer);
                    carouselTimer = null;
                }
            };

            const startCarousel = () => {
                if (!carouselTimer) {
                    carouselTimer = window.setInterval(advanceCarousel, intervalDelay);
                }
            };

            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    pauseCarousel();
                } else {
                    startCarousel();
                }
            });
        }

        const footerEmailSignupForm = document.getElementById('footerEmailSignupForm');
        const footerSignupMessage = document.getElementById('footerSignupMessage');

        footerEmailSignupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('footerPromoEmail').value;
            footerSignupMessage.textContent = 'Submitting...';
            footerSignupMessage.className = 'mt-3 text-sm text-center text-blue-700';
            footerSignupMessage.classList.remove('hidden');

            try {
                // In a real application, you would send this to a server endpoint (e.g., a Firebase function)
                await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate API call
                console.log(`Email submitted: ${email}`);
                footerSignupMessage.textContent = 'Thank you for signing up!';
                footerSignupMessage.className = 'mt-3 text-sm text-center text-green-700';
                document.getElementById('footerPromoEmail').value = '';
                trackButtonClick('Footer_Email_Signup');
            } catch (error) {
                footerSignupMessage.textContent = 'Error: Could not subscribe.';
                footerSignupMessage.className = 'mt-3 text-sm text-center text-red-600';
            }
        });

        // --- AUTH LOGIC ---
        const loginTabBtn = document.getElementById('loginTabBtn');
        const signupTabBtn = document.getElementById('signupTabBtn');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        const authModalTitle = document.getElementById('authModalTitle');
        const authMessage = document.getElementById('authMessage');

        const showAuthMessage = (message, type) => {
            authMessage.textContent = message;
            authMessage.className = 'p-3 rounded-lg text-sm mb-4';
            authMessage.classList.remove('bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
            if (type === 'error') authMessage.classList.add('bg-red-100', 'text-red-700');
            else if (type === 'success') authMessage.classList.add('bg-green-100', 'text-green-700');
            else authMessage.classList.add('bg-blue-100', 'text-blue-700');
            authMessage.classList.remove('hidden');
        };

        const showTab = (tab) => {
            loginTabBtn.classList.remove('border-indigo-600', 'text-slate-800');
            signupTabBtn.classList.remove('border-indigo-600', 'text-slate-800');
            loginTabBtn.classList.add('border-transparent', 'text-slate-500');
            signupTabBtn.classList.add('border-transparent', 'text-slate-500');

            loginForm.classList.add('hidden');
            signupForm.classList.add('hidden');
            forgotPasswordForm.classList.add('hidden');
            authMessage.classList.add('hidden');

            if (tab === 'login') {
                loginTabBtn.classList.add('border-indigo-600', 'text-slate-800');
                loginForm.classList.remove('hidden');
                authModalTitle.textContent = 'Login to Your Account';
            } else if (tab === 'signup') {
                signupTabBtn.classList.add('border-indigo-600', 'text-slate-800');
                signupForm.classList.remove('hidden');
                authModalTitle.textContent = 'Create an Account';
            } else if (tab === 'forgotPassword') {
                forgotPasswordForm.classList.remove('hidden');
                authModalTitle.textContent = 'Reset Password';
            }
        };

        loginTabBtn.addEventListener('click', () => showTab('login'));
        signupTabBtn.addEventListener('click', () => showTab('signup'));
        document.getElementById('switchToLogin').addEventListener('click', (e) => {
            e.preventDefault();
            showTab('login');
        });
        document.getElementById('forgotPasswordLink').addEventListener('click', (e) => {
            e.preventDefault();
            showTab('forgotPassword');
        });
        document.getElementById('returnToLogin').addEventListener('click', (e) => {
            e.preventDefault();
            showTab('login');
        });

        const googleProvider = new GoogleAuthProvider();
        const signInWithGoogle = async () => {
            try {
                showAuthMessage('Redirecting to Google...', 'info');
                await signInWithPopup(auth, googleProvider);
            } catch (error) {
                showAuthMessage(`Google sign-in failed: ${error.message}`, 'error');
            }
        };

        document.getElementById('googleLoginBtn').addEventListener('click', signInWithGoogle);
        document.getElementById('googleSignupBtn').addEventListener('click', signInWithGoogle);

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            try {
                showAuthMessage('Logging in...', 'info');
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                showAuthMessage(`Login failed: ${error.message}`, 'error');
            }
        });

        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            if (password.length < 6) {
                showAuthMessage('Password must be at least 6 characters.', 'error');
                return;
            }

            try {
                showAuthMessage('Creating account...', 'info');
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(userCredential.user, { displayName: name });
            } catch (error) {
                showAuthMessage(`Sign up failed: ${error.message}`, 'error');
            }
        });

        forgotPasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;
            try {
                showAuthMessage('Sending reset email...', 'info');
                await sendPasswordResetEmail(auth, email);
                showAuthMessage('Password reset email sent! Check your inbox.', 'success');
            } catch (error) {
                showAuthMessage(`Failed to send email: ${error.message}`, 'error');
            }
        });

        let currentActiveUserId = null;
        const headerContainer = document.querySelector('header .container');
        const logoTextContainer = document.querySelector('.logo-text-container-center');
        const loginNavBtn = document.getElementById('loginNavBtn');
        const userMonogram = document.getElementById('userMonogram');
        const authDropdown = document.getElementById('authDropdown');
        const authStatusContainer = document.getElementById('authStatusContainer');
        const logoutBtn = document.getElementById('logoutBtn');

        const updateAuthUI = (user) => {
            if (user && !user.isAnonymous) {
                loginNavBtn.classList.add('hidden');
                userMonogram.classList.remove('hidden');
                
                const initials = (user.displayName || user.email || 'U')[0].toUpperCase();
                userMonogram.textContent = initials;
                
                logoTextContainer?.classList.add('hidden');
                headerContainer?.classList.remove('justify-between');
                headerContainer?.classList.add('justify-end');
                
                closeModal(document.getElementById('loginModal'));
            } else {
                loginNavBtn.classList.remove('hidden');
                userMonogram.classList.add('hidden');
                authDropdown.classList.add('hidden');
                
                logoTextContainer?.classList.remove('hidden');
                headerContainer?.classList.add('justify-between');
                headerContainer?.classList.remove('justify-end');
            }
        };

        userMonogram.addEventListener('click', (e) => {
            e.stopPropagation();
            authDropdown.classList.toggle('hidden');
        });

        document.addEventListener('click', (e) => {
            if (!authStatusContainer.contains(e.target)) {
                authDropdown.classList.add('hidden');
            }
        });

        logoutBtn.addEventListener('click', () => {
            clearStoredChatSession();
            currentChatId = null;
            signOut(auth);
        });

        // --- CHAT WIDGET LOGIC ---
        const chatWindow = document.getElementById('chat-window');
        const chatOpenBtn = document.getElementById('chat-open-btn');
        const chatCloseBtn = document.getElementById('chat-close-btn');
        const chatMinimizeBtn = document.getElementById('chat-minimize-btn');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatInputContainer = document.getElementById('chat-input-container');
        const guestPromptContainer = document.getElementById('guest-prompt-container');
        const guestLoginBtn = document.getElementById('guest-login-btn');
        const unreadCounter = document.getElementById('unread-counter');
        const typingIndicatorContainer = document.getElementById('typing-indicator-container');
        const surveyContainer = document.getElementById('chat-survey-container');
        const surveyForm = document.getElementById('chat-survey-form');
        const starRatingContainer = document.getElementById('star-rating');
        const friendlinessRating = document.getElementById('friendliness-rating');
        const friendlinessValue = document.getElementById('friendliness-value');
        const endChatConfirmModal = document.getElementById('end-chat-confirm-modal');
        const endChatYesBtn = document.getElementById('end-chat-yes');
        const endChatNoBtn = document.getElementById('end-chat-no');
        const orderSelectionContainer = document.getElementById('order-selection-container');
        const orderList = document.getElementById('order-list');
        const closeOrderSelectionBtn = document.getElementById('close-order-selection-btn');
        const sendMessageBtn = document.getElementById('send-message-btn');
        const globalTooltip = document.getElementById('globalTooltip');

        const CHAT_STORAGE_KEY = 'chatSessionState';
        let currentChatId = null;
        let isFirstMessageSent = false;
        let unsubscribeFromMessages = null;
        let unsubscribeFromChatSession = null;
        let isChatMinimized = true;

        const storeChatSession = (chatId) => {
            const user = auth.currentUser;
            if (!user || user.isAnonymous || !chatId) return;
            localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify({ chatId, uid: user.uid }));
        };

        const getStoredChatSession = () => {
            const raw = localStorage.getItem(CHAT_STORAGE_KEY);
            if (!raw) return null;
            try {
                const parsed = JSON.parse(raw);
                const user = auth.currentUser;
                if (!user || user.isAnonymous || parsed.uid !== user.uid) return null;
                return parsed;
            } catch (error) {
                console.error("Error parsing stored chat session:", error);
                return null;
            }
        };

        const clearStoredChatSession = () => {
            localStorage.removeItem(CHAT_STORAGE_KEY);
            localStorage.removeItem(`agentJoined_${currentChatId}`);
            if (unsubscribeFromMessages) unsubscribeFromMessages();
            if (unsubscribeFromChatSession) unsubscribeFromChatSession();
            chatMessages.innerHTML = '';
            unreadCounter.classList.remove('visible');
            unreadCounter.textContent = '';
            chatInputContainer.classList.remove('hidden');
            guestPromptContainer.classList.add('hidden');
            surveyContainer.classList.add('hidden');
            orderSelectionContainer.classList.add('hidden');
        };

        const getOrCreateGuestId = () => {
            let guestId = localStorage.getItem('guestId');
            if (!guestId) {
                guestId = `guest-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;
                localStorage.setItem('guestId', guestId);
            }
            return guestId;
        };

        const ensureUserAuthenticatedForChat = () => {
            const user = auth.currentUser;
            if (user && !user.isAnonymous) {
                chatInputContainer.classList.remove('hidden');
                guestPromptContainer.classList.add('hidden');
                return true;
            }
            chatInputContainer.classList.add('hidden');
            guestPromptContainer.classList.remove('hidden');
            return false;
        };
        
        const listenForMessages = (chatId) => {
            if (unsubscribeFromMessages) unsubscribeFromMessages();
            const messagesRef = collection(db, `chats/${chatId}/messages`);
            const q = query(messagesRef, orderBy("timestamp", "asc"));
            let initialLoad = true;
            let unreadCount = 0;

            unsubscribeFromMessages = onSnapshot(q, (snapshot) => {
                const changes = snapshot.docChanges();
                let hasNewMessage = false;

                changes.forEach((change) => {
                    if (change.type === "added") {
                        const msg = change.doc.data();
                        renderMessage(msg);
                        if (!initialLoad && msg.sender !== auth.currentUser?.uid) {
                            hasNewMessage = true;
                            if (isChatMinimized) unreadCount++;
                        }
                    }
                });

                if (initialLoad) {
                    initialLoad = false;
                }
                
                if (isChatMinimized && unreadCount > 0) {
                    unreadCounter.textContent = unreadCount;
                    unreadCounter.classList.add('visible');
                } else {
                    unreadCount = 0;
                    unreadCounter.classList.remove('visible');
                    unreadCounter.textContent = '';
                }

                if (hasNewMessage && !isChatMinimized) {
                    // Reset counter if a new message comes in while chat is open
                    unreadCount = 0;
                    unreadCounter.classList.remove('visible');
                    unreadCounter.textContent = '';
                }

                // Scroll to bottom on new message
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        };

        const getOrCreateChatSession = async () => {
            const user = auth.currentUser;
            if (!user || user.isAnonymous) {
                // Should not happen if ensureUserAuthenticatedForChat is called first, but as a safeguard:
                alert("Please log in or sign up to start a chat.");
                return null;
            }

            const chatSessionsRef = collection(db, "chats");
            const docRef = await addDoc(chatSessionsRef, {
                userId: user.uid,
                status: 'pending',
                createdAt: serverTimestamp(),
                userEmail: user.email,
                userName: user.displayName || user.email,
                lastActive: serverTimestamp()
            });

            const chatId = docRef.id;
            storeChatSession(chatId);
            return chatId;
        };

        const renderMessage = (msg) => {
            const messageDiv = document.createElement('div');
            const user = auth.currentUser;
            const isMyMessage = !!user && !user.isAnonymous && msg.sender === user.uid;
            let classes = 'p-3 rounded-lg max-w-[85%] mb-2 break-words';

            if (msg.type === 'system') {
                classes = 'text-center text-sm text-slate-500 my-2';
                messageDiv.innerHTML = `<span class="bg-white px-2 py-1 rounded-full">${msg.text}</span>`;
            } else {
                classes += isMyMessage ? ' bg-gray-200 text-slate-800 self-end' : ' bg-blue-100 text-blue-800 self-start';
                messageDiv.textContent = msg.text;
            }

            messageDiv.className = classes;
            
            if (msg.type === 'system' && msg.text.includes('has joined the chat.')) {
                messageDiv.id = `agent-joined-${currentChatId}`;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        };

        const listenForChatSessionChanges = (chatId) => {
            if (unsubscribeFromChatSession) unsubscribeFromChatSession();

            unsubscribeFromChatSession = onSnapshot(doc(db, "chats", chatId), async (docSnap) => {
                const data = docSnap.data();
                if (!data) return;

                const agentJoinedFlag = localStorage.getItem(`agentJoined_${chatId}`);
                if (data.agentName && data.agentHasJoined && !agentJoinedFlag) {
                    const joinMsgText = `<i class="fa-solid fa-headset mr-2"></i>${data.agentName} has joined the chat.`;
                    await addDoc(collection(db, `chats/${chatId}/messages`), {
                        text: joinMsgText,
                        timestamp: serverTimestamp(),
                        sender: 'system',
                        type: 'system'
                    });
                    localStorage.setItem(`agentJoined_${chatId}`, 'true');
                }
                
                typingIndicatorContainer.style.display = data.isAgentTyping ? 'block' : 'none';
                if (data.isAgentTyping) chatMessages.scrollTop = chatMessages.scrollHeight;

                if (data.status === 'ended_by_agent') {
                    chatInputContainer.classList.add('hidden');
                    guestPromptContainer.classList.add('hidden');
                    surveyContainer.classList.remove('hidden');
                    orderSelectionContainer.classList.add('hidden');
                    clearStoredChatSession(); // Clear session state for a new chat
                }
            });
        };

        const openChat = async () => {
            if (chatWindow.classList.contains('is-visible')) {
                return;
            }

            chatWindow.classList.add('is-visible');
            isChatMinimized = false;
            // Clear unread counter when chat is opened
            unreadCounter.classList.remove('visible');
            unreadCounter.textContent = '';

            const user = auth.currentUser;
            if (!user || user.isAnonymous) {
                // If guest, show login prompt and stop
                ensureUserAuthenticatedForChat();
                return;
            }

            // If logged in, proceed to restore or create chat session
            let storedSession = getStoredChatSession();
            
            if (storedSession) {
                currentChatId = storedSession.chatId;
                listenForMessages(currentChatId);
                listenForChatSessionChanges(currentChatId);
                
                const welcomeBack = {
                    text: `Welcome back, ${user.displayName || user.email}!`,
                    timestamp: serverTimestamp(),
                    sender: 'system',
                    type: 'system'
                };
                renderMessage(welcomeBack);

            } else {
                // Render initial message for new chat
                const initialMsg = {
                    text: `Hi ${user.displayName || 'there'}! How can I help you with your trade-in today?`,
                    timestamp: serverTimestamp(),
                    sender: 'system',
                    type: 'system'
                };
                renderMessage(initialMsg);

                // Check for user's active orders (if any)
                const orders = await fetchUserOrders();
                if (orders.requiresLogin || orders.error || orders.length === 0) {
                    // Do nothing, let user type
                } else {
                    orderSelectionContainer.classList.remove('hidden');
                    renderOrderSelection(orders);
                }
            }

            if (currentChatId) {
                listenForMessages(currentChatId);
                listenForChatSessionChanges(currentChatId);
            }
        };

        chatOpenBtn.addEventListener('click', openChat);

        const minimizeChat = () => {
            chatWindow.classList.remove('is-visible');
            isChatMinimized = true;
        };
        chatMinimizeBtn.addEventListener('click', minimizeChat);

        chatCloseBtn.addEventListener('click', () => {
            endChatConfirmModal.classList.add('flex');
            endChatConfirmModal.classList.remove('hidden');
        });

        endChatNoBtn.addEventListener('click', () => {
            endChatConfirmModal.classList.add('hidden');
            endChatConfirmModal.classList.remove('flex');
        });

        endChatYesBtn.addEventListener('click', async () => {
            if (currentChatId) {
                await addDoc(collection(db, `chats/${currentChatId}/messages`), {
                    text: "Chat ended by user.",
                    timestamp: serverTimestamp(),
                    sender: 'system',
                    type: 'system'
                });
                await updateDoc(doc(db, "chats", currentChatId), {
                    status: 'ended_by_user'
                });
            }
            clearStoredChatSession();
            localStorage.removeItem(`agentJoined_${currentChatId}`);
            currentChatId = null;
            chatMessages.innerHTML = '';
            endChatConfirmModal.classList.add('hidden');
            endChatConfirmModal.classList.remove('flex');
            minimizeChat();
        });

        const sendMessage = async (text) => {
            if (text.trim() === '') return;
            if (!ensureUserAuthenticatedForChat()) return;
            
            if (!currentChatId) {
                currentChatId = await getOrCreateChatSession();
                isFirstMessageSent = false;
                if (!currentChatId) return;
            }

            const user = auth.currentUser;
            if (!user || user.isAnonymous) return;

            if (!isFirstMessageSent) {
                isFirstMessageSent = true;
                try {
                    const cloudFunctionUrl = 'https://us-central1-buyback-a0f05.cloudfunctions.net/api/email-support';
                    const userEmail = user.email || 'Member';
                    const userName = user.displayName || userEmail;
                    const firstMessage = text;

                    await fetch(cloudFunctionUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            chatId: currentChatId,
                            userName: userName,
                            userEmail: userEmail,
                            firstMessage: firstMessage
                        })
                    });
                    console.log('Support email sent for new chat session.');
                } catch (error) {
                    console.error("Error sending support email:", error);
                }
            }

            // Add user message to Firestore
            await addDoc(collection(db, `chats/${currentChatId}/messages`), {
                text: text,
                timestamp: serverTimestamp(),
                sender: user.uid,
                type: 'user'
            });

            // Update chat session with new activity
            await updateDoc(doc(db, "chats", currentChatId), {
                lastActive: serverTimestamp(),
                lastMessageText: text
            });

            chatInput.value = '';
            // Reset unread counter and selection box
            orderSelectionContainer.classList.add('hidden');
        };

        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMessage(chatInput.value);
            }
        });
        sendMessageBtn.addEventListener('click', () => sendMessage(chatInput.value));
        guestLoginBtn.addEventListener('click', () => openModal('loginModal'));

        // --- SURVEY LOGIC ---
        let surveyData = {
            friendliness: 3,
            comment: '',
            chatId: ''
        };

        starRatingContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('fa-star')) {
                const rating = parseInt(e.target.dataset.rating);
                friendlinessRating.value = rating;
                friendlinessValue.textContent = rating;
                surveyData.friendliness = rating;
                
                // Update stars visually
                starRatingContainer.querySelectorAll('.fa-star').forEach(star => {
                    const starRating = parseInt(star.dataset.rating);
                    if (starRating <= rating) {
                        star.classList.add('selected');
                    } else {
                        star.classList.remove('selected');
                    }
                });
            }
        });

        surveyForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            surveyData.comment = document.getElementById('surveyComment').value;
            surveyData.chatId = currentChatId;
            
            // Log survey data to Firestore
            await setDoc(doc(db, "chat_feedback", currentChatId), { 
                ...surveyData, 
                submittedAt: serverTimestamp() 
            });

            try {
                const cloudFunctionUrl = 'https://us-central1-buyback-a0f05.cloudfunctions.net/api/submit-chat-feedback';
                const response = await fetch(cloudFunctionUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ chatId: currentChatId, surveyData: surveyData })
                });

                if (!response.ok) throw new Error(`Server responded with status: ${response.status}`);
                console.log('Feedback email sent successfully:', await response.json());
            } catch (error) {
                console.error("Error sending feedback email:", error);
            }

            surveyContainer.innerHTML = '<p class="text-center font-semibold text-green-600">Thank you for your feedback!</p>';
        });

        // --- ORDER SELECTION LOGIC ---

        const fetchUserOrders = async () => {
            return new Promise((resolve) => {
                const unsubscribe = onAuthStateChanged(auth, async (user) => {
                    unsubscribe();
                    if (!user || user.isAnonymous) {
                        console.log("fetchUserOrders: User not logged in, returning requiresLogin: true");
                        resolve({ requiresLogin: true });
                        return;
                    }
                    
                    const userId = user.uid;
                    console.log("fetchUserOrders: Current user ID:", userId);

                    const ordersRef = collection(db, `users/${userId}/orders`);
                    const q = query(ordersRef, orderBy("timestamp", "desc"));
                    
                    try {
                        await createDummyOrder(userId);
                        const snapshot = await getDocs(q);
                        console.log("fetchUserOrders: Orders snapshot size:", snapshot.size);
                        
                        if (snapshot.empty) {
                            console.log("fetchUserOrders: No orders found for this user in Firestore path:", `users/${userId}/orders`);
                        }

                        const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        console.log("fetchUserOrders: Fetched orders:", orders);
                        resolve(orders);
                    } catch (error) {
                        console.error("fetchUserOrders: Error fetching user orders:", error);
                        resolve({ error: error.message });
                    }
                });
            });
        };
        
        const createDummyOrder = async (userId) => {
            const ordersRef = collection(db, `users/${userId}/orders`);
            const existingOrders = await getDocs(ordersRef);

            if (existingOrders.empty) {
                console.log("Creating initial dummy orders for user:", userId);

                let lastOrderNum = parseInt(localStorage.getItem('lastOrderNum') || '0', 10);
                const generateSequentialOrderId = () => {
                    lastOrderNum++;
                    localStorage.setItem('lastOrderNum', lastOrderNum);
                    return `SHC-${String(100000 + lastOrderNum).slice(-6)}`;
                };

                const dummyOrders = [
                    {
                        orderId: generateSequentialOrderId(),
                        device: "iPhone 15 Pro Max 256GB - Flawless",
                        price: "$720.00",
                        status: "Processing",
                        timestamp: new Date(Date.now() - 86400000 * 2), // 2 days ago
                    },
                    {
                        orderId: generateSequentialOrderId(),
                        device: "Samsung Galaxy S22 128GB - Fair",
                        price: "$250.00",
                        status: "Re-Offer Issued",
                        reofferAmount: "$180.00",
                        reofferReason: "Cracked screen on inspection",
                        timestamp: new Date(Date.now() - 86400000 * 5), // 5 days ago
                    },
                    {
                        orderId: generateSequentialOrderId(),
                        device: "iPhone 12 Mini 64GB - Good",
                        price: "$200.00",
                        status: "Completed",
                        paymentMethod: "Zelle",
                        timestamp: new Date(Date.now() - 86400000 * 15), // 15 days ago
                    }
                ];

                for (const order of dummyOrders) {
                    await addDoc(ordersRef, {
                        ...order,
                        timestamp: order.timestamp,
                    });
                }
            }
        };

        const parseCurrencyValue = (currencyString) => {
            if (typeof currencyString !== 'string') return null;
            const match = currencyString.match(/(\d[\d,]*\.?\d{0,2})/);
            return match ? parseFloat(match[0].replace(/,/g, '')) : null;
        };

        const getRelevantPrice = (order) => {
            // Check reoffer first, then final price, then estimated quote (though not in dummy data)
            const candidates = [
                order.reofferAmount,
                order.price,
                order.estimatedQuote,
            ];

            for (const candidate of candidates) {
                const numeric = parseCurrencyValue(candidate);
                if (numeric !== null) {
                    return numeric;
                }
            }
            return 0;
        };

        const renderOrderSelection = (orders) => {
            orderList.innerHTML = '';
            const orderSelectionPrompt = document.getElementById('order-selection-prompt');

            if (orders.requiresLogin) {
                orderList.innerHTML = '<p class="text-center text-slate-500">Please <a href="#" id="orderLoginPromptLink" class="text-blue-600 font-semibold hover:underline">log in</a> to view and select your orders.</p>';
                document.getElementById('orderLoginPromptLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    openModal('loginModal');
                    orderSelectionContainer.classList.add('hidden');
                });
                orderSelectionPrompt.textContent = 'Login to access your orders:';
                return;
            }

            if (orders.length === 0) {
                orderList.innerHTML = '<p class="text-center text-slate-500">No recent orders found.</p>';
                orderSelectionPrompt.textContent = 'Please select your order:';
                return;
            }

            orderSelectionPrompt.textContent = 'Please select your order:';

            orders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'order-card';
                orderCard.dataset.orderId = order.orderId;

                const reofferAmount = parseCurrencyValue(order.reofferAmount);
                const hasReoffer = order.status === 'Re-Offer Issued' && reofferAmount > 0;

                let priceDisplay = order.price;
                if (hasReoffer) {
                    priceDisplay = `<span class="reoffer">${order.reofferAmount}</span> (Re-Offer)`;
                } else if (order.status === 'Completed') {
                    priceDisplay = `${order.price} (${order.paymentMethod || 'Paid'})`;
                }

                orderCard.innerHTML = `
                    <div class="mr-3 text-2xl">${hasReoffer ? 'üö®' : (order.status === 'Completed' ? '‚úÖ' : 'üì¶')}</div>
                    <div class="order-card-details">
                        <strong>Order #${order.orderId}</strong>
                        <span>${order.device}</span>
                        <span class="${hasReoffer ? 'reoffer' : ''}">Status: ${order.status}</span>
                    </div>
                    <div class="text-right font-bold text-lg">
                        ${priceDisplay}
                    </div>
                `;

                orderCard.addEventListener('click', () => {
                    const orderSummary = `Order #${order.orderId} (${order.device}, Status: ${order.status}, Price: ${order.price}${hasReoffer ? ' Re-Offer: ' + order.reofferAmount : ''})`;
                    const initialMessage = `I'm contacting you about my order: ${orderSummary}. ${hasReoffer ? 'I have received a re-offer and need to discuss it.' : 'I have a question about its status.'}`;
                    
                    if (chatInput) {
                        chatInput.value = initialMessage;
                        sendMessage(initialMessage);
                    }
                    orderSelectionContainer.classList.add('hidden');
                });

                orderList.appendChild(orderCard);
            });
        };
        
        closeOrderSelectionBtn.addEventListener('click', () => {
            orderSelectionContainer.classList.add('hidden');
        });

        // Fire initial UI update on load
        onAuthStateChanged(auth, async (user) => {
            updateAuthUI(user);
            currentActiveUserId = user?.uid;
            
            // Re-check chat session status
            if (user && !user.isAnonymous) {
                const storedSession = getStoredChatSession();
                if (storedSession) {
                    currentChatId = storedSession.chatId;
                    // Listeners will be established when chat is opened
                }
            } else {
                clearStoredChatSession();
            }
        });
        
        // --- TOOLTIP LOGIC ---
        const tooltipButtons = document.querySelectorAll('#chat-header button, #chat-input-container button');

        tooltipButtons.forEach(button => {
            let tooltipTimeout;

            button.addEventListener('mouseover', () => {
                clearTimeout(tooltipTimeout);
                const text = button.getAttribute('data-tooltip-text');
                if (!text) return;

                globalTooltip.textContent = text;
                globalTooltip.style.visibility = 'visible';
                globalTooltip.style.opacity = '1';

                const rect = button.getBoundingClientRect();
                const tooltipRect = globalTooltip.getBoundingClientRect();
                
                // Position above the button
                globalTooltip.style.top = `${rect.top - tooltipRect.height - 5}px`;

                // Center horizontally
                globalTooltip.style.left = `${rect.left + rect.width / 2}px`;
                globalTooltip.style.transform = `translateX(-50%)`;
            });

            button.addEventListener('mouseout', () => {
                tooltipTimeout = setTimeout(() => {
                    globalTooltip.style.visibility = 'hidden';
                    globalTooltip.style.opacity = '0';
                }, 100);
            });

            button.addEventListener('mouseenter', () => {
                clearTimeout(tooltipTimeout);
            });
        });

        // NEW: Intersection Observer for scroll-triggered animations
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fadeInUp');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        document.querySelectorAll('.animate-on-scroll').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            observer.observe(el);
        });
    </script>

  <script defer src="/assets/js/cookie-consent.js"></script>
</body>
</html>