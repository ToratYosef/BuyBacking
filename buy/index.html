<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buy Devices in Bulk | SecondHandCell</title>
    <link rel="icon" href="/favicon/favicon.ico" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
    />
    <style>
        body {
            background: radial-gradient(circle at top, rgba(16, 185, 129, 0.04), transparent 55%),
                radial-gradient(circle at bottom, rgba(59, 130, 246, 0.04), transparent 55%),
                #020617;
        }
    </style>
</head>
<body class="min-h-screen text-slate-100">
    <div id="notificationBar" class="fixed inset-x-0 top-0 z-40 hidden px-4 py-3 text-sm">
        <div class="mx-auto flex max-w-4xl items-center justify-between rounded-2xl px-4 py-3">
            <span id="notificationMessage" class="font-medium"></span>
            <button
                type="button"
                id="dismissNotification"
                class="rounded-full bg-white/10 px-3 py-1 text-xs uppercase tracking-[0.2em] text-white/90 transition hover:bg-white/20"
            >
                Close
            </button>
        </div>
    </div>

    <header class="border-b border-white/5 bg-slate-950/70 backdrop-blur">
        <div class="mx-auto flex max-w-7xl flex-wrap items-center justify-between gap-4 px-6 py-5">
            <a href="/" class="flex items-center gap-3 text-slate-100">
                <img src="/assets/logo.svg" alt="SecondHandCell" class="h-10 w-10" onerror="this.style.display='none'" />
                <div>
                    <p class="text-xs uppercase tracking-[0.35em] text-emerald-300/80">SecondHandCell</p>
                    <h1 class="text-xl font-semibold tracking-tight">Wholesale Device Store</h1>
                </div>
            </a>
            <div class="flex items-center gap-4 text-sm">
                <a href="#catalog" class="rounded-full border border-white/10 px-4 py-2 font-medium text-slate-200 transition hover:border-emerald-400 hover:text-emerald-200">
                    Browse stock
                </a>
                <button
                    type="button"
                    id="cartButton"
                    class="relative flex items-center gap-2 rounded-full bg-emerald-500 px-4 py-2 font-semibold text-slate-950 transition hover:bg-emerald-400"
                >
                    <i class="fa-solid fa-cart-shopping"></i>
                    Cart
                    <span
                        id="cartBadge"
                        class="absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full bg-slate-950 text-xs font-bold text-emerald-300 shadow-lg shadow-emerald-500/40"
                    >
                        0
                    </span>
                </button>
            </div>
        </div>
    </header>

    <main class="mx-auto flex max-w-7xl flex-col gap-16 px-6 py-16">
        <section class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr]">
            <div class="space-y-8">
                <span class="inline-flex items-center gap-2 rounded-full border border-emerald-400/40 bg-emerald-500/10 px-4 py-1 text-xs font-semibold uppercase tracking-[0.35em] text-emerald-200">
                    Direct from our warehouse
                </span>
                <h2 class="text-4xl font-bold tracking-tight text-slate-50 sm:text-5xl">
                    Bulk Apple & Samsung inventory you can inspect, quote, and submit offers on instantly.
                </h2>
                <p class="text-lg leading-relaxed text-slate-300/90">
                    Every device on this page is owned, tested, and kitted by the SecondHandCell refurbishment team. Mix grades, set quantities, and tell us what you are willing to pay&mdash;we respond fast with approvals or counter offers.
                </p>
                <div class="grid gap-4 sm:grid-cols-3">
                    <div class="rounded-2xl border border-white/5 bg-slate-900/70 p-5">
                        <p class="text-xs uppercase tracking-[0.3em] text-emerald-200">Owned stock</p>
                        <p class="mt-2 text-sm text-slate-300">IMEI cleared, R2-tested, ready to ship next business day.</p>
                    </div>
                    <div class="rounded-2xl border border-white/5 bg-slate-900/70 p-5">
                        <p class="text-xs uppercase tracking-[0.3em] text-cyan-200">Flexible offers</p>
                        <p class="mt-2 text-sm text-slate-300">Set your own per-grade offer during checkout with blended deals.</p>
                    </div>
                    <div class="rounded-2xl border border-white/5 bg-slate-900/70 p-5">
                        <p class="text-xs uppercase tracking-[0.3em] text-amber-200">Status visibility</p>
                        <p class="mt-2 text-sm text-slate-300">We confirm availability, reserve stock, and coordinate freight.</p>
                    </div>
                </div>
            </div>
            <div class="relative">
                <div class="absolute inset-0 -translate-x-12 -translate-y-12 rotate-6 rounded-3xl bg-emerald-500/5 blur-3xl"></div>
                <div class="relative h-full rounded-3xl border border-white/10 bg-slate-900/80 p-8 shadow-2xl shadow-emerald-500/20">
                    <h3 class="text-lg font-semibold text-slate-100">How wholesale offers work</h3>
                    <ol class="mt-6 space-y-5 text-sm text-slate-200">
                        <li class="flex gap-4">
                            <span class="flex h-8 w-8 items-center justify-center rounded-full bg-emerald-500/20 text-sm font-semibold text-emerald-200">1</span>
                            <div>
                                <p class="font-semibold text-slate-100">Add quantities by grade</p>
                                <p class="text-slate-300/80">Choose the exact mix of A, B, C, or F stock you need for each SKU.</p>
                            </div>
                        </li>
                        <li class="flex gap-4">
                            <span class="flex h-8 w-8 items-center justify-center rounded-full bg-emerald-500/20 text-sm font-semibold text-emerald-200">2</span>
                            <div>
                                <p class="font-semibold text-slate-100">Name your price</p>
                                <p class="text-slate-300/80">Provide a per-unit offer when you open the cart. We'll compare to our asking price.</p>
                            </div>
                        </li>
                        <li class="flex gap-4">
                            <span class="flex h-8 w-8 items-center justify-center rounded-full bg-emerald-500/20 text-sm font-semibold text-emerald-200">3</span>
                            <div>
                                <p class="font-semibold text-slate-100">Submit &amp; reserve</p>
                                <p class="text-slate-300/80">Our team locks stock, shares an official quote, and coordinates shipping.</p>
                            </div>
                        </li>
                    </ol>
                    <p class="mt-8 rounded-2xl border border-emerald-400/30 bg-emerald-500/10 p-4 text-xs text-emerald-200/90">
                        Need pallet quantities or custom testing? Add it in the offer notes and an account manager will follow up.
                    </p>
                </div>
            </div>
        </section>

        <section class="space-y-8" id="catalog">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h2 class="text-3xl font-semibold text-slate-50">Available devices</h2>
                    <p class="mt-2 text-slate-300/80">Adjust quantities inside each card and add them to your wholesale cart.</p>
                </div>
                <button
                    type="button"
                    id="clearCart"
                    class="rounded-full border border-white/10 px-4 py-2 text-sm font-medium text-slate-300 transition hover:border-emerald-400 hover:text-emerald-200"
                >
                    Clear cart
                </button>
            </div>
            <div id="deviceGrid" class="grid gap-6 md:grid-cols-2 xl:grid-cols-3"></div>
        </section>

        <section class="rounded-3xl border border-white/10 bg-slate-900/70 p-8 text-sm text-slate-300">
            <div class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
                <div>
                    <h3 class="text-xl font-semibold text-slate-100">Need serialized inventory or additional grades?</h3>
                    <p class="mt-2 max-w-2xl text-slate-300/80">Email <a class="text-emerald-300 underline" href="mailto:wholesale@secondhandcell.com">wholesale@secondhandcell.com</a> with your request. All devices ship with detailed cosmetic grading sheets and 45-point functionality reports.</p>
                </div>
                <a
                    href="mailto:wholesale@secondhandcell.com"
                    class="inline-flex items-center justify-center gap-2 rounded-full bg-emerald-500 px-6 py-3 text-sm font-semibold text-slate-950 transition hover:bg-emerald-400"
                >
                    <i class="fa-solid fa-envelope"></i>
                    Contact wholesale desk
                </a>
            </div>
        </section>
    </main>

    <footer class="border-t border-white/5 bg-slate-950/70">
        <div class="mx-auto flex max-w-7xl flex-col gap-4 px-6 py-8 text-xs text-slate-400 sm:flex-row sm:items-center sm:justify-between">
            <p>&copy; <span id="currentYear"></span> SecondHandCell. All devices owned and processed in-house.</p>
            <p class="text-slate-500">Warehouse hubs: Dallas · Phoenix · Newark</p>
        </div>
    </footer>

    <div id="cartModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-slate-950/80" id="closeCartBackdrop"></div>
        <div class="absolute inset-y-0 right-0 flex h-full w-full max-w-3xl flex-col bg-slate-950 shadow-2xl shadow-black/50">
            <div class="flex items-center justify-between border-b border-white/10 px-6 py-4">
                <div>
                    <p class="text-xs uppercase tracking-[0.3em] text-emerald-200">Wholesale offer</p>
                    <h2 class="text-2xl font-semibold text-slate-50">Review cart &amp; submit pricing</h2>
                </div>
                <button id="closeCart" class="rounded-full border border-white/10 p-2 text-slate-300 transition hover:border-emerald-400 hover:text-emerald-200">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto px-6 py-6" id="cartContent">
                <div id="cartItems" class="space-y-6"></div>
                <div class="mt-8 grid gap-6 lg:grid-cols-[1.3fr_0.7fr]">
                    <div class="space-y-4">
                        <label class="block text-sm text-slate-300">
                            Offer notes (optional)
                            <textarea
                                id="offerNotes"
                                rows="3"
                                class="mt-2 w-full rounded-2xl border border-white/10 bg-slate-900 px-4 py-3 text-sm text-slate-100 focus:border-emerald-400 focus:outline-none"
                                placeholder="Share inspection preferences, pallet splits, or target ship dates"
                            ></textarea>
                        </label>
                    </div>
                    <div class="space-y-4 rounded-3xl border border-white/10 bg-slate-900/70 p-6 text-sm text-slate-200">
                        <h3 class="text-base font-semibold text-slate-100">Totals</h3>
                        <dl class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <dt>Total units</dt>
                                <dd id="summaryUnits" class="font-semibold text-slate-100">0</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt>Our asking price (if accepted)</dt>
                                <dd id="summaryAsking" class="font-semibold text-slate-100">$0</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt>Your blended offer</dt>
                                <dd id="summaryOffer" class="font-semibold text-emerald-300">$0</dd>
                            </div>
                        </dl>
                        <p class="text-xs text-slate-400">We'll review offers against current market demand and email a counter if needed.</p>
                        <button
                            id="submitOffer"
                            class="w-full rounded-full bg-emerald-500 px-4 py-3 text-sm font-semibold text-slate-950 transition hover:bg-emerald-400"
                        >
                            Submit offer for review
                        </button>
                    </div>
                </div>
            </div>
            <div id="offerSuccess" class="hidden flex-1 flex-col items-center justify-center gap-6 px-6 text-center">
                <div class="flex h-16 w-16 items-center justify-center rounded-full bg-emerald-500/20 text-emerald-300">
                    <i class="fa-solid fa-check text-2xl"></i>
                </div>
                <div class="space-y-3">
                    <h3 class="text-2xl font-semibold text-slate-50">Offer received!</h3>
                    <p class="text-sm text-slate-300/80">A member of our wholesale desk will email confirmation shortly. We hold inventory for 24 hours while we finalize paperwork.</p>
                </div>
                <div class="w-full max-w-xl rounded-3xl border border-white/10 bg-slate-900/70 p-6 text-left text-sm text-slate-300">
                    <h4 class="text-sm font-semibold text-slate-100">Submitted mix</h4>
                    <ul id="submittedSummary" class="mt-3 space-y-2"></ul>
                    <p id="submittedNotes" class="mt-4 text-xs text-slate-500"></p>
                </div>
                <div class="flex flex-wrap justify-center gap-3">
                    <button id="closeSuccess" class="rounded-full border border-white/10 px-5 py-2 text-sm font-medium text-slate-300 transition hover:border-emerald-400 hover:text-emerald-200">
                        Close
                    </button>
                    <button id="startNewOffer" class="rounded-full bg-emerald-500 px-5 py-2 text-sm font-semibold text-slate-950 transition hover:bg-emerald-400">
                        Start new offer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const storageKey = "wholesaleInventoryV1";
            const defaultInventory = [
                {
                    id: "iphone-14-128",
                    brand: "Apple",
                    model: "iPhone 14",
                    storage: "128GB · Midnight",
                    tagline: "Unlocked GSM/CDMA — 12-month warranty",
                    image: "https://images.unsplash.com/photo-1661961110671-80d19bca82d5?auto=format&fit=crop&w=600&q=80",
                    grades: {
                        A: { label: "Like New", stock: 42, price: 525 },
                        B: { label: "Light Wear", stock: 63, price: 495 },
                        C: { label: "Heavy Wear", stock: 18, price: 435 },
                        F: { label: "For Parts", stock: 9, price: 160 }
                    }
                },
                {
                    id: "iphone-13-pro-256",
                    brand: "Apple",
                    model: "iPhone 13 Pro",
                    storage: "256GB · Graphite",
                    tagline: "Includes MagSafe + OEM accessories on request",
                    image: "https://images.unsplash.com/photo-1611472173362-3f53db8bbcbb?auto=format&fit=crop&w=600&q=80",
                    grades: {
                        A: { label: "Retail Ready", stock: 28, price: 610 },
                        B: { label: "Refurbished", stock: 51, price: 565 },
                        C: { label: "Value", stock: 14, price: 475 }
                    }
                },
                {
                    id: "s23-128",
                    brand: "Samsung",
                    model: "Galaxy S23",
                    storage: "128GB · Phantom Black",
                    tagline: "North American variant with 12-month warranty",
                    image: "https://images.unsplash.com/photo-1674710645957-9fef8a329565?auto=format&fit=crop&w=600&q=80",
                    grades: {
                        A: { label: "Pristine", stock: 36, price: 490 },
                        B: { label: "Gently Used", stock: 44, price: 455 },
                        C: { label: "Operational", stock: 22, price: 390 }
                    }
                },
                {
                    id: "ipad-air-5",
                    brand: "Apple",
                    model: "iPad Air 5",
                    storage: "256GB · Wi-Fi",
                    tagline: "Includes OEM USB-C cable and charger",
                    image: "https://images.unsplash.com/photo-1610792516305-cb4c9c736d72?auto=format&fit=crop&w=600&q=80",
                    grades: {
                        A: { label: "Like New", stock: 24, price: 540 },
                        B: { label: "Retail Return", stock: 33, price: 505 },
                        F: { label: "Housing/Battery", stock: 11, price: 180 }
                    }
                }
            ];

            const storedInventory = (() => {
                try {
                    const value = localStorage.getItem(storageKey);
                    const parsed = value ? JSON.parse(value) : null;
                    return Array.isArray(parsed) && parsed.length ? parsed : null;
                } catch (error) {
                    console.warn("Unable to read inventory from localStorage", error);
                    return null;
                }
            })();

            let inventory = storedInventory || defaultInventory;
            if (!storedInventory) {
                try {
                    localStorage.setItem(storageKey, JSON.stringify(defaultInventory));
                } catch (error) {
                    console.warn("Unable to store default inventory", error);
                }
            }

            const notificationBar = document.getElementById("notificationBar");
            const notificationMessage = document.getElementById("notificationMessage");
            const dismissNotification = document.getElementById("dismissNotification");
            const deviceGrid = document.getElementById("deviceGrid");
            const cartBadge = document.getElementById("cartBadge");
            const cartButton = document.getElementById("cartButton");
            const cartModal = document.getElementById("cartModal");
            const closeCart = document.getElementById("closeCart");
            const closeCartBackdrop = document.getElementById("closeCartBackdrop");
            const cartItemsContainer = document.getElementById("cartItems");
            const cartContent = document.getElementById("cartContent");
            const offerSuccess = document.getElementById("offerSuccess");
            const submittedSummary = document.getElementById("submittedSummary");
            const submittedNotes = document.getElementById("submittedNotes");
            const closeSuccess = document.getElementById("closeSuccess");
            const startNewOffer = document.getElementById("startNewOffer");
            const submitOfferButton = document.getElementById("submitOffer");
            const summaryUnits = document.getElementById("summaryUnits");
            const summaryAsking = document.getElementById("summaryAsking");
            const summaryOffer = document.getElementById("summaryOffer");
            const offerNotes = document.getElementById("offerNotes");
            const clearCartButton = document.getElementById("clearCart");
            const currentYear = document.getElementById("currentYear");
            const cart = [];

            currentYear.textContent = new Date().getFullYear();

            function showNotification(message, tone = "info") {
                const toneConfig = {
                    info: "bg-slate-800/95 border border-white/10",
                    success: "bg-emerald-600/10 border border-emerald-400/40 text-emerald-100",
                    warning: "bg-amber-600/20 border border-amber-400/40 text-amber-100",
                    error: "bg-rose-600/20 border border-rose-400/40 text-rose-100"
                };
                notificationMessage.textContent = message;
                notificationBar.className = `fixed inset-x-0 top-0 z-40 px-4 py-3 text-sm ${toneConfig[tone] || toneConfig.info}`;
                notificationBar.classList.remove("hidden");
            }

            function hideNotification() {
                notificationBar.classList.add("hidden");
            }

            dismissNotification.addEventListener("click", hideNotification);

            function formatCurrency(value) {
                return new Intl.NumberFormat("en-US", { style: "currency", currency: "USD", maximumFractionDigits: 0 }).format(value);
            }

            function findDevice(deviceId) {
                return inventory.find((item) => item.id === deviceId);
            }

            function renderCatalog() {
                deviceGrid.innerHTML = "";
                inventory.forEach((device) => {
                    const card = document.createElement("article");
                    card.className = "group flex flex-col gap-5 rounded-3xl border border-white/10 bg-slate-900/60 p-6 shadow-2xl shadow-black/30 transition hover:border-emerald-400/40 hover:shadow-emerald-500/10";
                    card.dataset.deviceId = device.id;

                    card.innerHTML = `
                        <div class="relative overflow-hidden rounded-2xl border border-white/10">
                            <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/10 via-transparent to-slate-900/80"></div>
                            <img src="${device.image}" alt="${device.brand} ${device.model}" class="h-48 w-full object-cover" loading="lazy" onerror="this.style.display='none'" />
                        </div>
                        <div>
                            <p class="text-xs uppercase tracking-[0.3em] text-emerald-200/80">${device.brand}</p>
                            <h3 class="mt-1 text-xl font-semibold text-slate-50">${device.model}</h3>
                            <p class="text-sm text-slate-300/80">${device.storage}</p>
                            <p class="mt-3 text-sm text-slate-400">${device.tagline || ""}</p>
                        </div>
                        <div class="space-y-3" data-grade-list>
                            ${Object.entries(device.grades)
                                .map(([gradeKey, grade]) => {
                                    const asking = formatCurrency(grade.price);
                                    return `
                                        <div class="flex flex-col gap-3 rounded-2xl border border-white/10 bg-slate-950/60 p-4 text-sm text-slate-200" data-grade-row data-grade="${gradeKey}">
                                            <div class="flex flex-wrap items-center justify-between gap-2">
                                                <div class="flex items-center gap-3 text-slate-100">
                                                    <span class="flex h-9 w-9 items-center justify-center rounded-full bg-emerald-500/10 text-sm font-semibold text-emerald-200">${gradeKey}</span>
                                                    <div>
                                                        <p class="font-semibold">${grade.label}</p>
                                                        <p class="text-xs text-slate-400">${grade.stock} units available</p>
                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Asking</p>
                                                    <p class="text-sm font-semibold text-slate-100">${asking}</p>
                                                </div>
                                            </div>
                                            <label class="flex items-center justify-between gap-3 text-xs text-slate-300">
                                                <span>Select quantity</span>
                                                <input
                                                    type="number"
                                                    min="0"
                                                    max="${grade.stock}"
                                                    value="0"
                                                    data-quantity-input
                                                    data-grade="${gradeKey}"
                                                    class="w-24 rounded-full border border-white/10 bg-slate-900 px-3 py-2 text-right text-sm text-slate-100 focus:border-emerald-400 focus:outline-none"
                                                />
                                            </label>
                                        </div>
                                    `;
                                })
                                .join("")}
                        </div>
                        <div class="flex flex-wrap gap-3">
                            <button
                                type="button"
                                data-add-to-cart
                                class="flex-1 rounded-full bg-emerald-500 px-4 py-3 text-sm font-semibold text-slate-950 transition hover:bg-emerald-400"
                            >
                                Add selected to cart
                            </button>
                            <button
                                type="button"
                                data-reset-quantities
                                class="rounded-full border border-white/10 px-4 py-3 text-sm font-medium text-slate-300 transition hover:border-emerald-400 hover:text-emerald-200"
                            >
                                Reset
                            </button>
                        </div>
                    `;

                    deviceGrid.appendChild(card);
                });
            }

            function updateCartBadge() {
                const totalUnits = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartBadge.textContent = totalUnits;
                cartBadge.classList.toggle("hidden", totalUnits === 0);
            }

            function getCartItem(deviceId, gradeKey) {
                return cart.find((entry) => entry.deviceId === deviceId && entry.grade === gradeKey);
            }

            function addToCart(deviceId, gradeKey, quantity) {
                if (quantity <= 0) return;
                const device = findDevice(deviceId);
                if (!device) return;
                const grade = device.grades[gradeKey];
                if (!grade) return;

                const existing = getCartItem(deviceId, gradeKey);
                const alreadyInCart = existing ? existing.quantity : 0;
                if (quantity + alreadyInCart > grade.stock) {
                    showNotification(`Only ${grade.stock} units of ${device.model} grade ${gradeKey} are available.`, "warning");
                    return false;
                }

                if (existing) {
                    existing.quantity += quantity;
                } else {
                    cart.push({
                        deviceId,
                        grade: gradeKey,
                        quantity,
                        askingPrice: grade.price,
                        offer: grade.price
                    });
                }
                return true;
            }

            function renderCartItems() {
                cartItemsContainer.innerHTML = "";
                if (!cart.length) {
                    cartItemsContainer.innerHTML = `
                        <div class="rounded-3xl border border-white/10 bg-slate-900/60 p-6 text-sm text-slate-300">
                            <p class="font-semibold text-slate-100">Your cart is empty</p>
                            <p class="mt-2 text-slate-400">Add devices from the catalog to set quantities and submit your offer.</p>
                        </div>
                    `;
                    submitOfferButton.disabled = true;
                    submitOfferButton.classList.add("opacity-50", "cursor-not-allowed");
                } else {
                    submitOfferButton.disabled = false;
                    submitOfferButton.classList.remove("opacity-50", "cursor-not-allowed");
                }

                cart.forEach((item, index) => {
                    const device = findDevice(item.deviceId);
                    if (!device) return;
                    const grade = device.grades[item.grade];
                    const row = document.createElement("div");
                    row.className = "space-y-4 rounded-3xl border border-white/10 bg-slate-900/70 p-6 text-sm text-slate-200";
                    row.dataset.cartIndex = index;
                    row.innerHTML = `
                        <div class="flex flex-wrap items-start justify-between gap-4">
                            <div>
                                <p class="text-xs uppercase tracking-[0.3em] text-emerald-200/80">${device.brand}</p>
                                <h3 class="text-lg font-semibold text-slate-50">${device.model} · Grade ${item.grade}</h3>
                                <p class="text-xs text-slate-400">${device.storage}</p>
                                <p class="mt-2 text-xs text-slate-500">${grade ? grade.stock : 0} units available</p>
                            </div>
                            <button
                                type="button"
                                class="rounded-full border border-white/10 px-3 py-1 text-xs font-medium text-slate-300 transition hover:border-rose-400 hover:text-rose-200"
                                data-remove-item
                            >
                                Remove
                            </button>
                        </div>
                        <div class="grid gap-4 sm:grid-cols-3">
                            <label class="text-xs text-slate-300">
                                Quantity
                                <input
                                    type="number"
                                    min="1"
                                    max="${grade ? grade.stock : item.quantity}"
                                    value="${item.quantity}"
                                    data-input-type="quantity"
                                    class="mt-2 w-full rounded-2xl border border-white/10 bg-slate-950 px-3 py-2 text-right text-sm text-slate-100 focus:border-emerald-400 focus:outline-none"
                                />
                            </label>
                            <label class="text-xs text-slate-300">
                                Your offer (per unit)
                                <input
                                    type="number"
                                    min="0"
                                    step="1"
                                    value="${item.offer}"
                                    data-input-type="offer"
                                    class="mt-2 w-full rounded-2xl border border-white/10 bg-slate-950 px-3 py-2 text-right text-sm text-slate-100 focus:border-emerald-400 focus:outline-none"
                                />
                            </label>
                            <div class="self-end rounded-2xl border border-white/5 bg-white/5 px-3 py-3 text-xs text-slate-200">
                                <p>Asking total</p>
                                <p class="text-sm font-semibold text-slate-50">${formatCurrency(item.askingPrice * item.quantity)}</p>
                                <p class="mt-2 text-xs text-slate-400">Your offer total</p>
                                <p class="text-sm font-semibold text-emerald-300" data-offer-total>${formatCurrency(item.offer * item.quantity)}</p>
                            </div>
                        </div>
                    `;
                    cartItemsContainer.appendChild(row);
                });
                updateSummary();
            }

            function updateSummary() {
                const totals = cart.reduce(
                    (acc, item) => {
                        acc.units += item.quantity;
                        acc.asking += item.askingPrice * item.quantity;
                        acc.offer += item.offer * item.quantity;
                        return acc;
                    },
                    { units: 0, asking: 0, offer: 0 }
                );
                summaryUnits.textContent = totals.units;
                summaryAsking.textContent = formatCurrency(totals.asking);
                summaryOffer.textContent = formatCurrency(totals.offer);
            }

            function openCart() {
                cartModal.classList.remove("hidden");
                document.body.classList.add("overflow-hidden");
                cartContent.classList.remove("hidden");
                offerSuccess.classList.add("hidden");
                renderCartItems();
            }

            function closeCartModal() {
                cartModal.classList.add("hidden");
                document.body.classList.remove("overflow-hidden");
            }

            function resetCart(silent = false) {
                cart.splice(0, cart.length);
                updateCartBadge();
                renderCartItems();
                if (!silent) {
                    showNotification("Cart cleared.", "info");
                }
            }

            deviceGrid.addEventListener("click", (event) => {
                const resetButton = event.target.closest("[data-reset-quantities]");
                if (resetButton) {
                    const card = resetButton.closest("[data-device-id]");
                    card.querySelectorAll("[data-quantity-input]").forEach((input) => {
                        input.value = 0;
                    });
                    return;
                }

                const addButton = event.target.closest("[data-add-to-cart]");
                if (!addButton) return;

                const card = addButton.closest("[data-device-id]");
                const deviceId = card.dataset.deviceId;
                let addedAny = false;

                card.querySelectorAll("[data-quantity-input]").forEach((input) => {
                    const quantity = parseInt(input.value, 10) || 0;
                    if (quantity > 0) {
                        const gradeKey = input.dataset.grade;
                        const added = addToCart(deviceId, gradeKey, quantity);
                        if (added) {
                            addedAny = true;
                            input.value = 0;
                        }
                    }
                });

                if (addedAny) {
                    showNotification("Added selections to cart.", "success");
                    updateCartBadge();
                } else {
                    showNotification("Select a quantity before adding to cart.", "warning");
                }
            });

            cartItemsContainer.addEventListener("click", (event) => {
                const removeButton = event.target.closest("[data-remove-item]");
                if (!removeButton) return;
                const row = removeButton.closest("[data-cart-index]");
                const index = Number(row.dataset.cartIndex);
                cart.splice(index, 1);
                renderCartItems();
                updateCartBadge();
                showNotification("Removed item from cart.", "info");
            });

            cartItemsContainer.addEventListener("input", (event) => {
                const input = event.target;
                const row = input.closest("[data-cart-index]");
                if (!row) return;
                const index = Number(row.dataset.cartIndex);
                const item = cart[index];
                const device = findDevice(item.deviceId);
                const grade = device ? device.grades[item.grade] : null;

                if (input.dataset.inputType === "quantity") {
                    let newQuantity = parseInt(input.value, 10) || 0;
                    const max = grade ? grade.stock : newQuantity;
                    if (newQuantity < 1) newQuantity = 1;
                    if (newQuantity > max) {
                        newQuantity = max;
                        showNotification(`Limited to ${max} units for ${device.model} grade ${item.grade}.`, "warning");
                    }
                    item.quantity = newQuantity;
                    input.value = newQuantity;
                }

                if (input.dataset.inputType === "offer") {
                    let offer = parseFloat(input.value);
                    if (Number.isNaN(offer) || offer < 0) {
                        offer = 0;
                    }
                    item.offer = offer;
                    input.value = offer;
                }

                const offerTotalElement = row.querySelector("[data-offer-total]");
                if (offerTotalElement) {
                    offerTotalElement.textContent = formatCurrency(item.offer * item.quantity);
                }
                updateSummary();
            });

            submitOfferButton.addEventListener("click", () => {
                if (!cart.length) {
                    showNotification("Add items before submitting an offer.", "warning");
                    return;
                }

                const notes = offerNotes.value.trim();
                submittedSummary.innerHTML = cart
                    .map((item) => {
                        const device = findDevice(item.deviceId);
                        if (!device) return "";
                        return `<li><span class="font-semibold text-slate-100">${item.quantity}× ${device.model} (Grade ${item.grade})</span> &mdash; asking ${formatCurrency(item.askingPrice)} / your offer ${formatCurrency(item.offer)}</li>`;
                    })
                    .join("");

                submittedNotes.textContent = notes ? `Notes: ${notes}` : "No additional notes provided.";

                cartContent.classList.add("hidden");
                offerSuccess.classList.remove("hidden");

                showNotification("Offer submitted. We'll reply shortly.", "success");
            });

            function resetAfterSubmit() {
                offerSuccess.classList.add("hidden");
                cartContent.classList.remove("hidden");
                offerNotes.value = "";
                submittedSummary.innerHTML = "";
                submittedNotes.textContent = "";
                resetCart(true);
                closeCartModal();
            }

            closeSuccess.addEventListener("click", resetAfterSubmit);
            startNewOffer.addEventListener("click", () => {
                offerSuccess.classList.add("hidden");
                cartContent.classList.remove("hidden");
                offerNotes.value = "";
                submittedSummary.innerHTML = "";
                submittedNotes.textContent = "";
                resetCart(true);
            });

            cartButton.addEventListener("click", openCart);
            closeCart.addEventListener("click", closeCartModal);
            closeCartBackdrop.addEventListener("click", closeCartModal);
            clearCartButton.addEventListener("click", () => resetCart());

            renderCatalog();
            updateCartBadge();
        })();
    </script>
</body>
</html>
