<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SecondHandCell - Sell Your Device</title>
    <link rel="icon" href="/favicon/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/assets/halloween-theme.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9evSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Google tag (gtag.js) -->
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W3BM2JC8');</script>
    
    <!-- End Google Tag Manager -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17534255111"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'AW-17534255111');
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            signInWithPopup,
            GoogleAuthProvider,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            updateProfile,
            sendPasswordResetEmail
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import {
            getFirestore,
            collection,
            addDoc,
            serverTimestamp,
            doc,
            getDoc
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmUGWbpbJIWLrBMJpZb8iMpFt-uc24J0k",
            authDomain: "auth.secondhandcell.com",
            projectId: "buyback-a0f05",
            storageBucket: "buyback-a0f05.appspot.com",
            messagingSenderId: "876430429098",
            appId: "1:876430429098:web:f6dd64b1960d90461979d3",
            measurementId: "G-6WWQN44JHT"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseAuth = auth;
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.signInWithPopup = signInWithPopup;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.updateProfile = updateProfile;
        window.sendPasswordResetEmail = sendPasswordResetEmail;
        window.firebaseDb = db;
        window.firebaseServerTimestamp = serverTimestamp;
        window.firebase = {
            firestore: {
                doc: doc,
                getDoc: getDoc
            }
        };
    </script>
    <style>
        body {
            font-family: sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Custom styles for hidden radio buttons and clickable images */
        .carrier-option input[type="radio"],
        .shipping-option input[type="radio"],
        .payment-option input[type="radio"] {
            display: none;
        }
        .carrier-option label,
        .shipping-option label,
        .payment-option label {
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
        }
        .carrier-option input[type="radio"]:checked + label,
        .shipping-option input[type="radio"]:checked + label,
        .payment-option input[type="radio"]:checked + label {
            border-color: #4f46e5;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
            transform: scale(1.02);
            background-color: #e0e7ff;
        }
        .carrier-option label:hover,
        .shipping-option label:hover,
        .payment-option label:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        #quoteModal {
            transition: opacity 0.4s ease-out, transform 0.4s ease-out, visibility 0.4s ease-out;
            opacity: 0;
            transform: scale(0.9);
            visibility: hidden;
        }
        #quoteModal.is-visible {
            opacity: 1;
            transform: scale(1);
            visibility: visible;
        }
        .custom-checkbox input[type="checkbox"] {
            display: none;
        }
        .custom-checkbox .checkmark {
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #94a3b8;
            border-radius: 0.25rem;
            position: relative;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .custom-checkbox input[type="checkbox"]:checked + .checkmark {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        .custom-checkbox input[type="checkbox"]:checked + .checkmark::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0.5rem;
            height: 1rem;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: translate(-50%, -60%) rotate(45deg);
        }
        .btn-primary-blue {
            background-color: #2563eb;
            color: white;
            padding: 1rem 2rem;
            border-radius: 9999px;
            font-weight: 700;
            font-size: 1.125rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            transform: scale(1);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }
        .btn-primary-blue:hover {
            background-color: #1d4ed8;
            transform: scale(1.05);
        }
        .btn-primary-blue:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.5);
        }
        .btn-secondary-green {
            background-color: #22c55e;
            color: white;
            padding: 1rem 2rem;
            border-radius: 9999px;
            font-weight: 700;
            font-size: 1.125rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            transform: scale(1);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }
        .btn-secondary-green:hover {
            background-color: #16a34a;
            transform: scale(1.05);
        }
        .btn-secondary-green:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.5);
        }
        
        .btn-primary-indigo {
            background-color: #4f46e5;
            color: white;
            padding: 1rem 2rem;
            border-radius: 9999px;
            font-weight: 700;
            font-size: 1.125rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            transform: scale(1);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }
        .btn-primary-indigo:hover {
            background-color: #4338ca;
            transform: scale(1.05);
        }
        .btn-primary-indigo:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.5);
        }
        .btn-disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #94a3b8 !important;
            box-shadow: none;
            transform: none;
        }
        /* Mobile-first adjustments for layout and typography */
        @media (max-width: 1023px) {
            .main-content-layout {
                flex-direction: column-reverse;
            }
            .quote-display-mobile-first {
                order: -1;
                margin-bottom: 2rem;
            }
            .main-content-layout > div:nth-child(1) {
                margin-top: 2rem;
            }
            .text-4xl {
                font-size: 2.25rem;
            }
            .text-3xl {
                font-size: 1.875rem;
            }
            .text-lg {
                font-size: 1rem;
            }
            .question-group {
                padding: 0.75rem;
            }
            .carrier-option label,
            .shipping-option label,
            .payment-option label {
                padding: 0.75rem;
            }
            .h-10.w-10 {
                height: 2rem;
                width: 2rem;
            }
            .text-4xl {
                font-size: 2rem;
            }
            .text-3xl {
                font-size: 1.75rem;
            }
            .btn-primary-blue,
            .btn-secondary-green,
            .btn-primary-indigo {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }
            .modal-content .text-5xl {
                font-size: 3rem;
            }
            /* Specific mobile adjustments for scrollable content modals */
            #fullyFunctionalModal .modal-content-scroll,
            #privacyPolicyModal .modal-content-scroll,
            #termsAndConditionsModal .modal-content-scroll {
                max-width: 95%; /* Make it wide on small screens */
                width: 95%;
                padding: 1.5rem;
            }
            #fullyFunctionalModal .prose p, 
            #fullyFunctionalModal .prose ul,
            #fullyFunctionalModal .prose li {
                font-size: 0.8rem; /* Smaller font on mobile */
            }
            #fullyFunctionalModal .prose h2 {
                font-size: 1.25rem;
            }
            #fullyFunctionalModal .prose h3 {
                font-size: 1rem;
            }
        }
        /* Desktop-specific layout rules */
        @media (min-width: 1024px) {
            .lg\:text-left .question-group .flex {
                justify-content: flex-start;
            }
            .quote-display-mobile-first {
                order: unset;
            }
        }
        .highlight-missing {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5) !important;
        }
        .carrier-option input[type="radio"]:not(:checked) + label.highlight-missing,
        .shipping-option input[type="radio"]:not(:checked) + label.highlight-missing,
        .payment-option input[type="radio"]:not(:checked) + label.highlight-missing {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5) !important;
        }
        .custom-checkbox input[type="checkbox"]:not(:checked) + .checkmark.highlight-missing {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5) !important;
        }
        /* Style for required select dropdown */
        #state:required:invalid:not(:focus) {
            color: #64748b; /* slate-500 for unselected placeholder text */
        }
        #state.highlight-missing {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5) !important;
        }

        /* --- STYLES FROM SECONDHANDCELL --- */
        .user-monogram {
            display: flex; align-items: center; justify-content: center;
            width: 2.5rem; height: 2.5rem;
            border-radius: 9999px;
            background-color: #dbeafe; color: #1d4ed8; /* blue-100, blue-700 */
            font-weight: 700; font-size: 1.125rem;
            cursor: pointer; user-select: none;
        }
        .auth-dropdown {
            position: absolute; right: 0; margin-top: 0.5rem;
            width: 12rem; background-color: white;
            border-radius: 0.375rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding-top: 0.25rem; padding-bottom: 0.25rem;
            z-index: 50;
        }
        .modal {
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            opacity: 0; visibility: hidden;
        }
        .modal.is-visible {
            opacity: 1; visibility: visible;
        }
        .modal-content {
            transform: translateY(-20px);
            transition: transform 0.3s ease-out;
        }
        .modal.is-visible .modal-content {
            transform: translateY(0);
        }
        /* NEW: General modal structure for scrollable content */
        .modal-content-scroll {
            max-height: 90vh; /* Set a max height for the modal box itself */
            display: flex;
            flex-direction: column;
        }
        /* NEW: Style for the scrollable body of the content */
        .modal-content-body {
            overflow-y: auto;
            padding-right: 0.5rem; /* Space for the scrollbar */
        }

        .btn-google-style {
            display: flex; align-items: center; justify-content: center;
            width: 100%; background-color: white; color: #475569;
            padding: 0.75rem 1rem; border-radius: 0.5rem;
            border: 1px solid #cbd5e1; font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            cursor: pointer;
        }
        .btn-google-style:hover { background-color: #f8fafc; }
        .btn-dark-slate {
            width: 100%; background-color: #1e293b; color: white;
            padding: 0.75rem 1rem; border-radius: 0.5rem;
            font-weight: 600; transition: all 0.3s ease;
            border: none; cursor: pointer;
        }
        .btn-dark-slate:hover { background-color: #0f172a; }
        .btn-red-logout {
            display: block; width: 100%; text-align: left;
            padding: 0.5rem 1rem; font-size: 0.875rem; color: #dc2626;
            background-color: transparent; border: none;
            transition: background-color 0.2s ease; cursor: pointer;
        }
        .btn-red-logout:hover { background-color: #fef2f2; }
        .prose {
            max-width: 65ch;
            color: #334155; /* slate-700 */
        }
        .prose h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        .prose h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        .prose p, .prose ul {
            margin-bottom: 1em;
        }
        .prose ul {
            list-style-position: inside;
            padding-left: 1em;
        }
        .prose li {
                margin-bottom: 0.5em;
        }
        /* Specific styling for the Fully Functional Modal content (smaller font, scrolling) */
        #fullyFunctionalModal .prose p, 
        #fullyFunctionalModal .prose ul,
        #fullyFunctionalModal .prose li {
            font-size: 0.9rem; /* Slightly smaller text for info density */
        }
        #fullyFunctionalModal .prose h3 {
            font-size: 1.1rem;
        }
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 1rem;
            height: 200px;
        }

        /* --- Glass & Gimmick Enhancements --- */
        body.sell-landing {
            background: radial-gradient(120% 120% at 10% 10%, rgba(168, 85, 247, 0.18) 0%, rgba(15, 23, 42, 0.92) 46%, #020617 100%);
        }

        .glass-hero {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.92) 0%, rgba(76, 29, 149, 0.88) 55%, rgba(30, 64, 175, 0.9) 100%);
            border: 1px solid rgba(148, 163, 184, 0.35);
            box-shadow: 0 35px 70px -45px rgba(15, 23, 42, 0.75);
        }

        .glass-hero::before {
            content: '';
            position: absolute;
            inset: -30%;
            background: radial-gradient(circle at 20% 20%, rgba(244, 114, 182, 0.45), transparent 55%);
            opacity: 0.7;
            filter: blur(60px);
            z-index: 0;
        }

        .glass-hero > * {
            position: relative;
            z-index: 1;
        }

        .glimmer-button {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.9rem 2.75rem;
            border-radius: 9999px;
            font-weight: 700;
            font-size: 1.05rem;
            letter-spacing: 0.04em;
            background: linear-gradient(135deg, #22c55e 0%, #0ea5e9 50%, #f97316 100%);
            color: #0f172a;
            box-shadow: 0 20px 35px -18px rgba(14, 165, 233, 0.65);
            transition: transform 0.35s ease, box-shadow 0.35s ease;
        }

        .glimmer-button:hover {
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 28px 45px -20px rgba(14, 165, 233, 0.8);
        }

        .feature-grid {
            display: grid;
            gap: 1.75rem;
        }

        @media (min-width: 768px) {
            .feature-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        .feature-card {
            position: relative;
            overflow: hidden;
            border-radius: 1.75rem;
            padding: 2rem;
            background: linear-gradient(160deg, rgba(15, 23, 42, 0.88), rgba(30, 58, 138, 0.75));
            border: 1px solid rgba(148, 163, 184, 0.25);
            color: #e2e8f0;
            box-shadow: 0 30px 60px -40px rgba(2, 6, 23, 0.9);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.25), transparent 60%);
            opacity: 0.6;
        }

        .feature-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 45px 80px -45px rgba(30, 64, 175, 0.8);
        }

        .feature-card > * {
            position: relative;
            z-index: 1;
        }

        .feature-icon {
            width: 3.25rem;
            height: 3.25rem;
            border-radius: 1rem;
            background: rgba(226, 232, 240, 0.12);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #38bdf8;
        }

        .glass-hero .feature-icon {
            width: 2.75rem;
            height: 2.75rem;
            font-size: 1.25rem;
            color: #facc15;
            margin-bottom: 0;
        }

        .event-section {
            border-radius: 1.75rem;
            padding: 2.5rem;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.85), rgba(99, 102, 241, 0.85));
            color: #f8fafc;
            position: relative;
            overflow: hidden;
        }

        .event-section::before {
            content: '';
            position: absolute;
            inset: -20% 10% 10% -30%;
            background: radial-gradient(circle at center, rgba(244, 114, 182, 0.55), transparent 65%);
            filter: blur(70px);
        }

        .event-content {
            position: relative;
            display: grid;
            gap: 1.5rem;
            z-index: 1;
        }

        @media (min-width: 1024px) {
            .event-content {
                grid-template-columns: 1.5fr 1fr;
                align-items: center;
            }
        }

        .countdown-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.25rem;
            border-radius: 9999px;
            background: rgba(15, 23, 42, 0.35);
            border: 1px solid rgba(255, 255, 255, 0.35);
            font-size: 0.85rem;
            letter-spacing: 0.08em;
        }

        .countdown-display {
            font-size: 2.25rem;
            font-weight: 700;
            letter-spacing: 0.08em;
        }

        .gimmick-grid {
            display: grid;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .gimmick-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        .gimmick-card {
            border-radius: 1.5rem;
            padding: 1.75rem;
            background: rgba(248, 250, 252, 0.88);
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 25px 55px -40px rgba(15, 23, 42, 0.6);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .gimmick-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 38px 70px -40px rgba(15, 23, 42, 0.75);
        }

        .spark-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.85rem;
            border-radius: 9999px;
            background: rgba(56, 189, 248, 0.12);
            color: #0369a1;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.06em;
        }

        .stat-marquee {
            display: grid;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .stat-marquee {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        .stat-block {
            border-radius: 1.5rem;
            padding: 1.5rem;
            background: rgba(15, 23, 42, 0.85);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #f8fafc;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            box-shadow: 0 25px 55px -45px rgba(15, 23, 42, 0.8);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.05em;
        }

        .stat-caption {
            font-size: 0.85rem;
            color: rgba(226, 232, 240, 0.8);
        }

        .aurora-border {
            position: relative;
            overflow: hidden;
        }

        .aurora-border::after {
            content: '';
            position: absolute;
            inset: -40%;
            background: conic-gradient(from 180deg, rgba(59, 130, 246, 0.35), rgba(244, 114, 182, 0.25), rgba(129, 140, 248, 0.35), rgba(59, 130, 246, 0.35));
            filter: blur(60px);
            opacity: 0.6;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen flex flex-col sell-landing">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W3BM2JC8"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex-1">
                <a href="https://secondhandcell.com" class="h-16 inline-block">
                    <img src="https://raw.githubusercontent.com/ToratYosef/BuyBacking/refs/heads/main/assets/logo.png" alt="SecondHandCell Logo" class="h-full w-auto" onerror="this.onerror=null;this.src='https://placehold.co/200x64/ffffff/1e293b?text=SecondHandCell';">
                </a>
            </div>
            <!-- Updated header with the requested coloring -->
            <div class="hidden md:flex flex-col items-center flex-1">
                <div class="text-2xl font-extrabold">
                    <span class="text-black">Second</span><span style="color: #54a929;">HandCell</span>
                </div>
                <p class="text-sm -mt-1" style="color: #54a929;">Turn Your Old<span class="text-black"> Phone Into Cash!</span></p>
            </div>
            <nav class="flex items-center space-x-4 flex-1 justify-end">
                <div id="authStatusContainer" class="relative inline-block">
                    <a href="#" id="loginNavBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-300 shadow-sm">Login/Sign Up</a>
                    <div id="userMonogram" class="user-monogram hidden"></div>
                    <div id="authDropdown" class="auth-dropdown hidden">
                        <a href="https://secondhandcell.com/my-account.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">My Account</a>
                        <button id="logoutBtn" class="btn-red-logout">Logout</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-12 space-y-12">
        <section class="relative text-center">
            <div class="card glass-hero aurora-border relative overflow-hidden px-6 py-10 md:py-12 rounded-3xl shadow-2xl max-w-3xl mx-auto text-white">
                <div class="halloween-confetti"></div>
                <div class="relative space-y-8">
                    <div class="countdown-chip mx-auto">
                        <i class="fa-solid fa-moon"></i>
                        Halloween Blitz Bonus Active
            <div class="card relative overflow-hidden px-6 py-10 md:py-12 rounded-3xl shadow-2xl max-w-3xl mx-auto text-white">
                <div class="halloween-confetti"></div>
                <div class="relative space-y-6">
                    <div class="halloween-badge justify-center text-xs md:text-sm tracking-[0.3em] mx-auto">
                        <i class="fa-solid fa-hat-wizard text-base md:text-lg"></i>
                        <span>Halloween Trade-In Treat</span>
                    </div>
                    <h1 class="text-3xl md:text-4xl font-extrabold leading-tight">
                        Sell Your <span id="halloweenDeviceName" class="halloween-highlight">Device</span> for a Spooky Bonus
                    </h1>
                    <p class="text-base md:text-lg text-orange-100/90 max-w-2xl mx-auto">
                        Lock in an extra treat when you ship your device by October 31. Free cauldron-ready shipping kits and frightfully fast payouts included.
                    </p>
                    <div class="grid md:grid-cols-3 gap-5 text-left text-sm text-slate-100/90">
                        <div class="flex items-start gap-3 justify-center md:justify-start">
                            <span class="feature-icon"><i class="fa-solid fa-wand-magic-sparkles"></i></span>
                            <div>
                                <p class="font-semibold text-base">+$35 Treat Boost</p>
                                <p class="text-xs text-slate-200/75">Auto-applied on flawless devices during October.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3 justify-center md:justify-start">
                            <span class="feature-icon"><i class="fa-solid fa-truck-fast"></i></span>
                            <div>
                                <p class="font-semibold text-base">Instant Kit Dispatch</p>
                                <p class="text-xs text-slate-200/75">Drop-off labels emailed within minutes of checkout.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3 justify-center md:justify-start">
                            <span class="feature-icon"><i class="fa-solid fa-face-grin-stars"></i></span>
                            <div>
                                <p class="font-semibold text-base">Seller Satisfaction 4.9★</p>
                                <p class="text-xs text-slate-200/75">Real humans, instant chat, and lightning-fast payouts.</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col items-center gap-3">
                        <a href="#questionContainer" class="glimmer-button">
                            Start My Halloween Quote
                            <i class="fa-solid fa-arrow-right-long"></i>
                        </a>
                        <p class="text-xs md:text-sm text-slate-200/85">Sign in to unlock live chat support and keep your quote spooky-fast.</p>
                    </div>
                    <div class="halloween-divider max-w-md mx-auto"></div>
                    <a href="#questionContainer" class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-full bg-emerald-500 text-white font-semibold hover:bg-emerald-400 transition-transform duration-300 hover:scale-105">
                        Start My Halloween Quote
                        <i class="fa-solid fa-arrow-right-long"></i>
                    </a>
                    <p class="text-xs md:text-sm text-slate-200/80">Sign in to unlock live chat support and keep your quote spooky-fast.</p>
                </div>
            </div>
        </section>

        <div class="bg-white p-8 rounded-3xl shadow-xl flex flex-col lg:flex-row items-center justify-center gap-12 main-content-layout">
            <div class="w-full lg:w-2/5 text-center quote-display-mobile-first">
                <div class="relative w-full max-w-sm mx-auto mb-6 rounded-3xl shadow-lg overflow-hidden transform transition-transform duration-500 hover:scale-105">
                    <img id="deviceImage" data-base-src="" alt="" class="w-full h-full object-cover">
                </div>
                <div class="bg-indigo-600 text-white p-6 rounded-2xl shadow-lg hidden" id="mainQuoteDisplay">
                    <h2 class="text-3xl font-extrabold mb-2">Your Instant Quote</h2>
                    <p class="text-5xl font-extrabold" id="finalQuoteAmountMain">$0</p>
                    <p class="text-sm mt-2 opacity-80">Final offer subject to certified inspection.</p>
                </div>
            </div>

            <div class="w-full lg:w-3/5 text-center lg:text-left">
                <h1 class="text-4xl font-extrabold text-slate-900 mb-4 sm:text-3xl">Sell Your <span id="deviceDisplayName"></span></h1>
                <p class="text-lg text-slate-600 mb-8 max-w-xl mx-auto lg:mx-0 sm:text-base">
                    Ready to sell your <span id="deviceDisplayNameText"></span>? Get an instant, competitive quote for your device today.
                    We offer a quick, transparent, and hassle-free process with free shipping and certified inspection.
                </p>
                
                <div id="loadingIndicator" class="loading-container">
                    <i class="fas fa-spinner fa-spin text-4xl text-blue-600"></i>
                    <p class="text-slate-500">Loading device data...</p>
                </div>

                <div id="errorDisplay" class="loading-container hidden">
                    <i class="fa-solid fa-triangle-exclamation text-4xl text-red-500 mb-4"></i>
                    <p class="text-lg text-red-500 font-semibold mb-4">Error: Device not found or invalid URL.</p>
                    <p class="text-slate-600 text-center">Please ensure you have navigated to this page from our device selection list.</p>
                    <a href="https://secondhandcell.com/index.html" class="mt-4 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">Go to Home Page</a>
                </div>

                <div id="questionContainer" class="space-y-6 hidden">

                    <div class="mb-8" id="storageSection">
                        <label class="block text-xl font-bold text-slate-800 mb-4 sm:text-lg">1. Select Storage Amount</label>
                        <div class="flex justify-center lg:justify-start">
                            <select id="storage" class="mt-1 block w-full md:w-1/2 px-4 py-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="">Select Storage</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-8 hidden" id="carrierSection">
                        <label class="block text-xl font-bold text-slate-800 mb-4 sm:text-lg">2. Select Your Carrier</label>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4" id="carrierOptions">
                            <div class="carrier-option">
                                <input type="radio" id="att" name="carrier" value="att">
                                <label for="att" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200 sm:p-3">
                                    <i class="fa-solid fa-signal text-3xl text-indigo-600 mb-2 sm:text-2xl"></i>
                                    <span class="block text-slate-700 font-medium sm:text-sm">AT&T</span>
                                </label>
                            </div>
                            <div class="carrier-option">
                                <input type="radio" id="tmobile" name="carrier" value="tmobile">
                                <label for="tmobile" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200 sm:p-3">
                                    <i class="fa-solid fa-mobile-screen-button text-3xl text-pink-600 mb-2 sm:text-2xl"></i>
                                    <span class="block text-slate-700 font-medium sm:text-sm">T-Mobile</span>
                                </label>
                            </div>
                            <div class="carrier-option">
                                <input type="radio" id="verizon" name="carrier" value="verizon">
                                <label for="verizon" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200 sm:p-3">
                                    <i class="fa-solid fa-wifi text-3xl text-red-600 mb-2 sm:text-2xl"></i>
                                    <span class="block text-slate-700 font-medium sm:text-sm">Verizon</span>
                                </label>
                            </div>
                            <div class="carrier-option">
                                <input type="radio" id="unlocked" name="carrier" value="unlocked">
                                <label for="unlocked" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200 sm:p-3">
                                    <i class="fa-solid fa-lock-open text-3xl text-teal-600 mb-2 sm:text-2xl"></i>
                                    <span class="block text-slate-700 font-medium sm:text-sm">Unlocked</span>
                                </label>
                            </div>
                            <div class="carrier-option">
                                <input type="radio" id="other-carrier" name="carrier" value="other">
                                <label for="other-carrier" class="bg-slate-50 p-4 rounded-xl text-center hover:bg-slate-200 transition duration-200 sm:p-3">
                                    <i class="fa-solid fa-globe text-3xl text-yellow-600 mb-2 sm:text-2xl"></i>
                                    <span class="block text-slate-700 font-medium sm:text-sm">Other</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 rounded-lg bg-slate-50 border border-slate-200 shadow-sm question-group hidden sm:p-4" id="powerOnSection">
                        <p class="text-lg font-semibold text-slate-700 mb-3 text-center lg:text-left sm:text-base">3. Does the device power on?</p>
                        <div class="flex space-x-6 justify-center lg:justify-start" id="q1Options">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="q1_power_on" value="yes" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">Yes</span>
                            </label>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="q1_power_on" value="no" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">No</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="p-6 rounded-lg bg-slate-50 border border-slate-200 shadow-sm question-group hidden sm:p-4" id="functionalSection">
                        <p class="text-lg font-semibold text-slate-700 mb-3 text-center lg:text-left flex items-center justify-center lg:justify-start sm:text-base">
                            4. Is the screen fully functional and free of defects?
                            <!-- MODIFIED: Replaced "(What's this?)" hyperlink text with Font Awesome info icon -->
                            <a href="#" id="functionalDetailsLink" class="ml-2 text-indigo-600 hover:text-indigo-800 transition-colors duration-200" aria-label="What does Fully Functional mean?">
                                <i class="fa-solid fa-circle-info text-xl"></i>
                            </a>
                        </p>
                        <!-- REMOVED: original functionalDetails div -->
                        <div class="flex space-x-6 justify-center lg:justify-start" id="q2Options">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="q2_fully_functional" value="yes" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">Yes</span>
                            </label>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="q2_fully_functional" value="no" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">No</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="p-6 rounded-lg bg-slate-50 border border-slate-200 shadow-sm question-group hidden sm:p-4" id="cracksSection">
                        <p class="text-lg font-semibold text-slate-700 mb-3 text-center lg:text-left sm:text-base">5. Are the front and back free of cracks?</p>
                        <div class="flex space-x-6 justify-center lg:justify-start" id="q3Options">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="q3_no_cracks" value="yes" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">Yes</span>
                            </label>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="q3_no_cracks" value="no" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">No</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="p-6 rounded-lg bg-slate-50 border border-slate-200 shadow-sm question-group hidden sm:p-4" id="cosmeticSection">
                        <p class="text-lg font-semibold text-slate-700 mb-3 text-center lg:text-left sm:text-base">6. What’s the overall cosmetic condition?</p>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="q4Options">
                            <label class="flex items-center p-3 border border-slate-300 rounded-md hover:bg-indigo-50 transition-colors duration-200 cursor-pointer sm:p-2">
                                <input type="radio" name="q4_cosmetic_condition" value="flawless" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">Flawless</span>
                            </label>
                            <label class="flex items-center p-3 border border-slate-300 rounded-md hover:bg-indigo-50 transition-colors duration-200 cursor-pointer sm:p-2">
                                <input type="radio" name="q4_cosmetic_condition" value="good" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">Good</span>
                            </label>
                            <label class="flex items-center p-3 border border-slate-300 rounded-md hover:bg-indigo-50 transition-colors duration-200 cursor-pointer sm:p-2">
                                <input type="radio" name="q4_cosmetic_condition" value="fair" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">Fair</span>
                            </label>
                            <label class="flex items-center p-3 border border-slate-300 rounded-md hover:bg-indigo-50 transition-colors duration-200 cursor-pointer sm:p-2">
                                <input type="radio" name="q4_cosmetic_condition" value="damaged" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 text-slate-700 sm:text-sm">Damaged</span>
                            </label>
                        </div>
                        <div id="cosmeticConditionDescription" class="mt-4 p-3 bg-slate-100 rounded-md text-sm text-slate-700 text-left hidden sm:text-xs">
                        </div>
                    </div>
                </div>

                <div id="cta-section" class="flex flex-col items-center">
                    <button id="getQuoteBtn" class="btn-primary-blue w-full max-w-sm hidden">
                        Get My Instant Quote!
                    </button>
                    <div id="quoteMessage" class="mt-4 p-3 rounded-lg text-sm text-center hidden w-full max-w-sm"></div>
                </div>

                <div id="nextSteps" class="mt-12 hidden flex flex-col items-center gap-8">
                    <div id="shippingSection" class="w-full">
                        <hr class="my-10 border-slate-200">
                        <h2 class="text-2xl font-bold text-slate-800 mb-6 sm:text-xl">7. How would you like to ship your device?</h2>
                        <div class="mb-8 grid grid-cols-1 md:grid-cols-2 gap-4" id="shippingOptions">
                            <div class="shipping-option">
                                <input type="radio" id="ship_kit" name="shipping_preference" value="ship_kit">
                                <label for="ship_kit" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200 sm:p-3">
                                    <i class="fa-solid fa-box text-4xl text-indigo-600 mb-2 sm:text-2xl"></i>
                                    <span class="font-semibold block sm:text-sm">Ship Me a Box (Shipping Kit)</span>
                                    <p class="text-xs text-slate-500 mt-1">Receive a grey bag with a prepaid label and another grey bag inside to send your device to us.</p>
                                </label>
                            </div>
                            <div class="shipping-option">
                                <input type="radio" id="email_label" name="shipping_preference" value="email_label">
                                <label for="email_label" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200 sm:p-3">
                                    <i class="fa-solid fa-envelope text-4xl text-green-600 mb-2 sm:text-2xl"></i>
                                    <span class="font-semibold block sm:text-sm">Email Me a Label (I have a box)</span>
                                    <p class="text-xs text-slate-500 mt-1">Receive a prepaid shipping label via email to print and use with your own packaging.</p>
                                </label>
                            </div>
                        </div>

                        <h2 class="text-2xl font-bold text-slate-800 mb-6 sm:text-xl">8. Shipping Information</h2>
                        <div class="mb-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- MODIFIED: Full Name now spans 2 columns for better focus on desktop -->
                            <div class="md:col-span-2">
                                <label for="fullName" class="block text-sm font-medium text-slate-700">Full Name</label>
                                <input type="text" id="fullName" required class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 sm:text-sm" autocomplete="name">
                            </div>
                            <!-- NEW: Phone Number added as the third contact detail -->
                            <div>
                                <label for="phone" class="block text-sm font-medium text-slate-700">Phone Number (Required)</label>
                                <input type="tel" id="phone" required autocomplete="tel" placeholder="(555) 555-5555" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 sm:text-sm">
                            </div>
                            <!-- Email Address moved to the fourth slot (second column on desktop) -->
                            <div>
                                <label for="email" class="block text-sm font-medium text-slate-700">Email Address</label>
                                <input type="email" id="email" required autocomplete="email" placeholder="Email Address" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 sm:text-sm">
                            </div>
                            <!-- Street Address moved to the next row, spanning 2 columns -->
                            <div class="md:col-span-2">
                                <label for="street-address" class="block text-sm font-medium text-slate-700">Street Address</label>
                                <input type="text" id="street-address" required class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 sm:text-sm" placeholder="Start typing your address..." autocomplete="street-address">
                            </div>
                            <div>
                                <label for="city" class="block text-sm font-medium text-slate-700">City</label>
                                <input type="text" id="city" required class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 sm:text-sm" autocomplete="address-level2">
                            </div>
                            <div>
                                <label for="state" class="block text-sm font-medium text-slate-700">State (Required)</label>
                                <!-- MODIFIED: Uses required select dropdown -->
                                <select id="state" required class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 sm:text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" autocomplete="address-level1">
                                    <option value="" disabled selected>Select State</option>
                                </select>
                            </div>
                            <div>
                                <label for="zip-code" class="block text-sm font-medium text-slate-700">ZIP Code</label>
                                <input type="text" id="zip-code" required class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 sm:text-sm" autocomplete="postal-code">
                            </div>
                        </div>

                        <div id="orderOverview" class="mt-8 p-6 bg-indigo-50 rounded-xl shadow-inner sm:p-4">
                            <h3 class="text-2xl font-bold text-indigo-800 mb-4 sm:text-xl">Order Overview</h3>
                            <div class="space-y-2 text-lg text-slate-700 sm:text-base">
                                <p><span class="font-semibold">Device:</span> <span id="overviewDevice"></span></p>
                                <p><span class="font-semibold">Carrier:</span> <span id="overviewCarrier">Not Selected</span></p>
                                <p><span class="font-semibold">Estimated Payout:</span> <span id="overviewQuote" class="text-indigo-600 font-bold">$0</span></p>
                                <p><span class="font-semibold">Shipping Preference:</span> <span id="overviewShippingPreference">Not Selected</span></p>
                                <!-- NEW: Overview item for Phone Number -->
                                <p><span class="font-semibold">Contact Phone:</span> <span id="overviewPhone">Not Entered</span></p>
                                <p><span class="font-semibold">Shipping Address:</span> <span id="overviewAddress">Not Entered</span></p>
                            </div>

                            <div class="mt-6 p-4 rounded-lg bg-white shadow-sm sm:p-3">
                                <label class="custom-checkbox flex items-start cursor-pointer">
                                    <input type="checkbox" id="termsAccepted">
                                    <span class="checkmark mt-1"></span>
                                    <span class="ml-4 text-sm text-slate-700 sm:text-xs">I accept the terms and conditions and certify that this device is not lost or stolen.</span>
                                </label>
                            </div>

                            <button id="sendPhoneBtn" class="btn-primary-indigo w-full mt-6">
                                Send Phone In Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <section class="feature-grid">
            <article class="feature-card">
                <div class="feature-icon"><i class="fa-solid fa-stopwatch"></i></div>
                <h3 class="text-xl font-semibold mb-2">Lightning Payouts</h3>
                <p class="text-sm text-slate-100/80">Most sellers see funds land within <span class="font-semibold">72 hours</span> of inspection. No mystery holds, no zombie slowdowns.</p>
            </article>
            <article class="feature-card">
                <div class="feature-icon"><i class="fa-solid fa-sparkles"></i></div>
                <h3 class="text-xl font-semibold mb-2">Glass Kit Experience</h3>
                <p class="text-sm text-slate-100/80">From holographic welcome cards to tamper-proof baggies, every kit is engineered to impress buyers and unboxers alike.</p>
            </article>
            <article class="feature-card">
                <div class="feature-icon"><i class="fa-solid fa-headset"></i></div>
                <h3 class="text-xl font-semibold mb-2">Live Concierge</h3>
                <p class="text-sm text-slate-100/80">Chat, text, or call—our Halloween command center is staffed 7 days a week with real humans that love spooky puns.</p>
            </article>
        </section>

        <section class="event-section text-left">
            <div class="event-content">
                <div class="space-y-4">
                    <div class="spark-badge"><i class="fa-solid fa-bullhorn"></i> Live Event</div>
                    <h2 class="text-3xl font-bold">Haunted Drop-Off Weekend</h2>
                    <p class="text-base text-slate-100/85">Bring your kit to any USPS counter between <strong>Oct 25 – Oct 27</strong> and trigger an automatic <strong>$25 express bonus</strong>.</p>
                    <div class="countdown-display" id="promoCountdown">--</div>
                    <p class="text-sm text-slate-100/70">Bonus crates include glow-in-the-dark packing slips and priority processing the moment your tracking number scans.</p>
                </div>
                <div class="gimmick-card space-y-4">
                    <h3 class="text-xl font-semibold text-slate-900">RSVP & Save Your Spot</h3>
                    <p class="text-sm text-slate-600">Let us know you’re shipping during Haunted Drop-Off and we’ll pre-stage your inspection so payouts fly.</p>
                    <button type="button" id="rsvpEventBtn" class="btn-primary-blue w-full justify-center"><i class="fa-solid fa-ticket"></i><span>Reserve Bonus Slot</span></button>
                </div>
            </div>
        </section>

        <section class="gimmick-grid">
            <article class="gimmick-card">
                <div class="spark-badge"><i class="fa-solid fa-dice"></i> Spin to Win</div>
                <h3 class="text-xl font-semibold text-slate-900 mt-3 mb-2">Mystery Multiplier Wheel</h3>
                <p class="text-sm text-slate-600 mb-4">Every time you submit a quote, spin for a chance at 1.1×, 1.2×, or the coveted 1.31× payday multiplier.</p>
                <button type="button" id="spinWheelBtn" class="btn-secondary-green w-full justify-center"><i class="fa-solid fa-splotch"></i><span>Spin Now</span></button>
            </article>
            <article class="gimmick-card">
                <div class="spark-badge"><i class="fa-solid fa-ghost"></i> Referral Perk</div>
                <h3 class="text-xl font-semibold text-slate-900 mt-3 mb-2">Boo Crew Bounties</h3>
                <p class="text-sm text-slate-600 mb-4">Invite a friend to sell their device and you’ll both snag a $20 Visa treat card after they ship.</p>
                <button type="button" id="shareReferralBtn" class="btn-dark-slate"><i class="fa-solid fa-share-nodes"></i> Share My Link</button>
            </article>
            <article class="gimmick-card">
                <div class="spark-badge"><i class="fa-solid fa-bolt"></i> Express Lane</div>
                <h3 class="text-xl font-semibold text-slate-900 mt-3 mb-2">Midnight Inspection Fastpass</h3>
                <p class="text-sm text-slate-600 mb-4">Upgrade to priority verification to skip the queue and trigger payouts before sunrise.</p>
                <button type="button" id="fastPassBtn" class="btn-primary-indigo w-full justify-center"><i class="fa-solid fa-rocket"></i><span>Activate Fastpass</span></button>
            </article>
        </section>

        <section class="stat-marquee">
            <div class="stat-block">
                <span class="stat-value" id="quoteVelocityStat">97%</span>
                <span class="stat-caption">Quotes paid within 72 hours of inspection.</span>
            </div>
            <div class="stat-block">
                <span class="stat-value" id="kitTurnaroundStat">18k</span>
                <span class="stat-caption">Shipping kits dispatched this season—and counting.</span>
            </div>
        </section>
    </main>
    
    <div id="paymentModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.6);">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-lg p-6 relative modal-content text-left">
            <button class="close-modal-btn absolute top-3 right-3 text-slate-400 hover:text-slate-600 transition-colors duration-200"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h2 class="text-2xl font-bold text-slate-800 mb-6 sm:text-xl">6. How would you like to get paid? </h2>
            
            <div class="mb-8 grid grid-cols-3 gap-4" id="paymentOptions">
                <div class="payment-option">
                    <input type="radio" id="venmo" name="payment_method" value="venmo">
                    <label for="venmo" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200 sm:p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48" viewBox="0 0 512 512" class="h-10 w-10 mb-2 mx-auto sm:h-8 sm:w-8" aria-label="Venmo" role="img">
                            <rect width="512" height="512" rx="15%" fill="#3396cd"/>
                            <path d="m381.4 105.3c11 18.1 15.9 36.7 15.9 60.3 0 75.1-64.1 172.7-116.2 241.2h-118.8l-47.6-285 104.1-9.9 25.3 202.8c23.5-38.4 52.6-98.7 52.6-139.7 0-22.5-3.9-37.8-9.9-50.4z" fill="#fff"/>
                        </svg>
                        <span class="font-semibold block sm:text-sm">Venmo</span>
                    </label>
                </div>
                <div class="payment-option">
                    <input type="radio" id="zelle" name="payment_method" value="zelle">
                    <label for="zelle" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200 sm:p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48" viewBox="0 0 48 48" class="h-10 w-10 mb-2 mx-auto sm:h-8 sm:w-8">
                            <path fill="#a0f" d="M35,42H13c-3.866,0-7-3.134-7-7V13c0-3.866,3.134-7,7-7h22c3.866,0,7,3.134,7,7v22 C42,38.866,38.866,42,35,42z"></path><path fill="#fff" d="M17.5,18.5h14c0.552,0,1-0.448,1-1V15c0-0.552-0.448-1-1-1h-14c-0.552,0-1,0.448-1,1v2.5 C16.5,18.052,16.948,18.5,17.5,18.5z"></path><path fill="#fff" d="M17,34.5h14.5c0.552,0,1-0.448,1-1V31c0-0.552-0.448-1-1-1H17c-0.552,0-1,0.448-1,1v2.5 C16,34.052,16.448,34.5,17,34.5z"></path><path fill="#fff" d="M22.25,11v6c0,0.276,0.5,0.5,0.5,0.5h3.5c0.276,0,0.5-0.224,0.5-0.5v-6c0-0.276-0.224-0.5-0.5-0.5 h-3.5C22.474,10.5,22.25,10.724,22.25,11z"></path><path fill="#fff" d="M22.25,32v6c0,0.276,0.224,0.5,0.5,0.5h3.5c0.276,0,0.5-0.224,0.5-0.5v-6c0-0.276-0.224-0.5-0.5-0.5 h-3.5C22.474,31.5,22.25,31.724,22.25,32z"></path><path fill="#fff" d="M16.578,30.938H22l10.294-12.839c0.178-0.222,0.019-0.552-0.266-0.552H26.5L16.275,30.298 C16.065,30.553,16.247,30.938,16.578,30.938z"></path>
                        </svg>
                        <span class="font-semibold block sm:text-sm">Zelle</span>
                    </label>
                </div>
                <div class="payment-option">
                    <input type="radio" id="paypal" name="payment_method" value="paypal">
                    <label for="paypal" class="p-4 bg-slate-50 rounded-xl text-center hover:bg-slate-200 transition-colors duration-200 sm:p-3">
                        <i class="fa-brands fa-paypal text-4xl text-blue-600 mb-2 sm:text-2xl"></i>
                        <span class="font-semibold block sm:text-sm">PayPal</span>
                    </label>
                </div>
            </div>

            <div id="venmoFields" class="mb-8 p-6 bg-slate-50 rounded-lg shadow-sm hidden sm:p-4">
                <h3 class="text-lg font-semibold text-slate-700 mb-3 sm:text-base">Venmo Details</h3>
                <div class="space-y-4">
                    <div>
                        <label for="venmoUsername" class="block text-sm font-medium text-slate-700">Venmo Username</label>
                        <input type="text" id="venmoUsername" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="venmoUsernameConfirm" class="block text-sm font-medium text-slate-700">Verify Venmo Username</label>
                        <input type="text" id="venmoUsernameConfirm" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>
            </div>

            <div id="zelleFields" class="mb-8 p-6 bg-slate-50 rounded-lg shadow-sm hidden sm:p-4">
                <h3 class="text-lg font-semibold text-slate-700 mb-3 sm:text-base">Zelle Details</h3>
                <div class="space-y-4">
                    <div>
                        <label for="zelleIdentifier" class="block text-sm font-medium text-slate-700">Zelle Email or Phone Number</label>
                        <input type="text" id="zelleIdentifier" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="zelleIdentifierConfirm" class="block text-sm font-medium text-slate-700">Verify Zelle Email or Phone Number</label>
                        <input type="text" id="zelleIdentifierConfirm" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>
            </div>

            <div id="paypalFields" class="mb-8 p-6 bg-slate-50 rounded-lg shadow-sm hidden sm:p-4">
                <h3 class="text-lg font-semibold text-slate-700 mb-3 sm:text-base">PayPal Details</h3>
                <div class="space-y-4">
                    <div>
                        <label for="paypalEmail" class="block text-sm font-medium text-slate-700">PayPal Email Address</label>
                        <input type="email" id="paypalEmail" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="paypalEmailConfirm" class="block text-sm font-medium text-slate-700">Verify PayPal Email Address</label>
                        <input type="email" id="paypalEmailConfirm" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>
            </div>
            
            <button id="submitOrderBtn" class="btn-primary-indigo w-full mt-6 btn-disabled">
                Submit Order
            </button>
            <div id="paymentMessage" class="mt-4 p-3 rounded-lg text-sm text-center hidden w-full"></div>
        </div>
    </div>


    <div id="quoteModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.6);">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-md p-6 relative modal-content text-center">
            <button class="close-modal-btn absolute top-3 right-3 text-slate-400 hover:text-slate-600 transition-colors duration-200"><i class="fa-solid fa-xmark text-xl"></i></button>
            <div class="bg-red-100 text-red-800 p-3 rounded-lg mb-4 text-sm font-medium">
                Important: Devices cannot be lost, reported stolen, have an outstanding balance, or a blacklisted IMEI.
            </div>
            <h2 class="text-3xl font-extrabold text-indigo-800 mb-4 sm:text-2xl">Your Instant Quote!</h2>
            <p class="text-5xl font-extrabold text-indigo-600 mb-4 sm:text-4xl" id="finalQuoteAmountPopup">$0</p>
            <p class="text-md text-slate-600 mb-6 sm:text-sm">This is an estimate. Final offer subject to certified inspection.</p>
            <button id="quoteModalContinueBtn" class="btn-secondary-green w-full max-w-xs mx-auto">
                Continue
            </button>
        </div>
    </div>

    <!-- UPDATED: Fully Functional Definition Modal -->
    <div id="fullyFunctionalModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.6);">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-xl p-6 relative modal-content modal-content-scroll">
            <button class="close-modal-btn absolute top-3 right-3 text-slate-400 hover:text-slate-600 transition-colors duration-200"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h2 class="text-2xl font-bold text-slate-800 mb-4 flex-shrink-0">What does "Fully Functional" mean?</h2>
            <div class="modal-content-body">
                <div class="prose max-w-none text-left">
                    <p class="font-semibold text-lg text-indigo-700 mb-3">For a device to qualify as **"Fully Functional"**, all of the following criteria must be met and pass our certified inspection:</p>
                    <ul class="list-disc list-inside ml-4 space-y-2 text-slate-700">
                        <li>**Screen & Display:** The screen must work and fully light up (no dead pixels, discoloration, persistent image burn, or black dots/LCD damage).</li>
                        <li>**Original Parts:** The device must contain **all original manufacturer parts**. Devices with third-party, non-original, or aftermarket replacement parts will be considered "Not Functional" or "Damaged."</li>
                        <li>**Key Features:** All exterior buttons (power, volume, mute), front/back camera and flashes, speakers, and microphones must function correctly.</li>
                        <li>**Connectivity & Ports:** Headphone jack, charging port, Cellular, Wi-Fi, Bluetooth, and GPS must all work.</li>
                        <li>**Biometrics & Touch:** The touchscreen, voice commands, facial recognition (Face ID), and fingerprint sensor (Touch ID) must be fully operational.</li>
                        <li>**Battery Health:** The battery must hold a sufficient charge for normal operation.</li>
                    </ul>
                    <p class="mt-4 text-sm text-red-600 font-medium">If your device fails any of these checks, please select "No" to the functionality question for an accurate revised offer.</p>
                </div>
            </div>
        </div>
    </div>


    <div id="loginModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.6);"><div class="bg-white rounded-lg shadow-2xl w-full max-w-md p-6 relative modal-content"><button class="close-modal-btn absolute top-3 right-3 text-slate-400 hover:text-slate-600 transition-colors duration-200"><i class="fa-solid fa-xmark text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800 mb-6 text-center">Your SecondHandCell Account</h2><div class="flex border-b border-slate-200 mb-6"><button id="loginTabBtn" class="flex-1 py-3 text-center text-lg font-medium border-b-2 border-transparent text-slate-500 hover:text-blue-600 hover:border-blue-600 transition-colors duration-200">Login</button><button id="signupTabBtn" class="flex-1 py-3 text-center text-lg font-medium border-b-2 border-transparent text-slate-500 hover:text-blue-600 hover:border-blue-600 transition-colors duration-200">Sign Up</button></div><form id="loginForm" class="space-y-4"><p class="text-slate-600 text-center">Log in to continue with your order.</p><button type="button" id="googleLoginBtn" class="btn-google-style"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google icon" class="w-5 h-5 mr-3">Login with Google</button><div class="text-center text-slate-500 relative my-4"><span class="bg-white px-2 z-10 relative">or</span><hr class="absolute inset-0 top-1/2 border-t border-slate-200"></div><div><label for="loginEmail" class="sr-only">Email Address</label><input type="email" id="loginEmail" placeholder="Email Address" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="email"></div><div><label for="loginPassword" class="sr-only">Password</label><input type="password" id="loginPassword" placeholder="Password" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="current-password"></div><button type="submit" id="emailLoginBtn" class="btn-dark-slate">Login</button><p class="text-center text-sm text-slate-600">Forgot your password? <a href="#" id="forgotPasswordLink" class="text-blue-600 font-semibold hover:underline">Reset it here</a></p></form><form id="signupForm" class="space-y-4 hidden"><p class="text-slate-600 text-center">Create an account to complete your order.</p><button type="button" id="googleSignupBtn" class="btn-google-style"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google icon" class="w-5 h-5 mr-3">Sign Up with Google</button><div class="text-center text-slate-500 relative my-4"><span class="bg-white px-2 z-10 relative">or</span><hr class="absolute inset-0 top-1/2 border-t border-slate-200"></div><div><label for="signupName" class="sr-only">Full Name</label><input type="text" id="signupName" placeholder="Full Name" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="name"></div><div><label for="signupEmail" class="sr-only">Email Address</label><input type="email" id="signupEmail" placeholder="Email Address" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="email"></div><div><label for="signupPassword" class="sr-only">Password</label><input type="password" id="signupPassword" placeholder="Password" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="new-password"></div><button type="submit" id="emailSignupBtn" class="btn-dark-slate">Sign Up</button><p class="text-center text-sm text-slate-600">Already have an account? <a href="#" id="switchToLogin" class="text-blue-600 font-semibold hover:underline">Log in here</a></p></form><form id="forgotPasswordForm" class="space-y-4 hidden"><p class="text-slate-600 text-center">Enter your email to receive a password reset link.</p><div><label for="forgotEmail" class="sr-only">Email Address</label><input type="email" id="forgotEmail" placeholder="Email Address" class="w-full border border-slate-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="email"></div><button type="submit" id="sendResetEmailBtn" class="btn-dark-slate">Send Reset Email</button><p class="text-center text-sm text-slate-600">Remember your password? <a href="#" id="returnToLogin" class="text-blue-600 font-semibold hover:underline">Return to Login</a></p></form><div id="authMessage" class="mt-4 p-3 rounded-lg text-sm text-center hidden w-full"></div></div></div>

    <div id="aboutUsModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.6);"><div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl p-6 relative modal-content"><button class="close-modal-btn absolute top-3 right-3 text-slate-400 hover:text-slate-600 transition-colors duration-200"><i class="fa-solid fa-xmark text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800 mb-4">About Us</h2><p class="text-slate-600">Welcome to SecondHandCell, where we believe in giving old tech a new life. Our mission is to make selling your used devices as simple, safe, and rewarding as possible. We offer competitive prices, a hassle-free process, and a commitment to sustainability.</p></div></div>

    <div id="privacyPolicyModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.6);"><div class="bg-white rounded-lg shadow-2xl w-full max-w-3xl p-8 relative modal-content modal-content-scroll"><button class="close-modal-btn absolute top-4 right-4 text-slate-400 hover:text-slate-600 transition-colors duration-200"><i class="fa-solid fa-xmark text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800 mb-4 flex-shrink-0">Privacy Policy</h2><div class="modal-content-body"><div class="prose max-w-none text-left"><p><strong>Last Updated: August 27, 2025</strong></p><p>SecondHandCell ("we," "us," or "our") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you visit our website.</p><h3>Information We Collect</h3><p>We may collect personal information from you such as your name, email address, postal address, phone number, and payment information (e.g., Venmo, Zelle, or PayPal details). We also collect information about the device you are selling, including its model, serial number, and condition.</p><h3>How We Use Your Information</h3><p>We use the information we collect to: process your transactions; send you shipping kits and communicate about your order status; process payments; respond to customer service requests; send you marketing and promotional communications, with your consent.</p><h3>Data Security and Wiping</h3><p>We implement a variety of security measures to maintain the safety of your personal information. All devices sold to us undergo a certified, multi-pass data-wiping process to ensure your personal information is professionally and permanently erased.</p><h3>Disclosure of Your Information</h3><p>We do not sell, trade, or otherwise transfer to outside parties your Personally Identifiable Information except to trusted third parties who assist us in operating our website, conducting our business, or servicing you (such as shipping carriers), so long as those parties agree to keep this information confidential.</p><h3>Your Consent </h3><p>By using our site, you consent to our website's privacy policy.</p></div></div></div></div>

    <div id="termsAndConditionsModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.6);"><div class="bg-white rounded-lg shadow-2xl w-full max-w-3xl p-8 relative modal-content modal-content-scroll"><button class="close-modal-btn absolute top-4 right-4 text-slate-400 hover:text-slate-600 transition-colors duration-200"><i class="fa-solid fa-xmark text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800 mb-4 flex-shrink-0">Terms & Conditions</h2><div class="modal-content-body"><div class="prose max-w-none text-left"><p><strong>Last Updated: August 27, 2025</strong></p><p>Please read these Terms and Conditions ("Terms") carefully before using the SecondHandCell website ("Service") operated by us.</p><h3>1. User Obligations</h3><p>By using the Service, you represent and warrant that:</p><ul><li>You are the legal owner of the device you are selling.</li><li>The device is not reported as lost or stolen, and its IMEI is not blacklisted.</li><li>The device has no outstanding balance and is not subject to any financing or lease agreement.</li><li>All information you provide about the device is accurate and truthful.</li></ul><h3>2. The Offer Process</h3><ul><li>The initial quote provided on our website is an estimate based on the information you provide.</li><li>Upon receiving your device, we will conduct a thorough inspection. If the device's condition differs from what was described, we will issue a revised offer via email.</li><li>**The device must contain all original manufacturer parts to qualify for "Fully Functional." If non-original parts are detected during inspection, the device will be automatically reclassified as "Not Functional" or "Damaged," and a revised offer will be issued.**</li><li>**You have seven (7) days to accept or decline the revised offer. If you do not respond within this 7-day period, the revised offer will be automatically accepted on your behalf, and we will proceed with payment.**</li><li>Once an offer (initial or revised) is accepted, it is locked in and final. There is no option for a re-offer or to have the device returned.</li></ul><h3>3. Shipping and Risk of Loss</h3><p>We provide a prepaid shipping label and materials. SecondHandCell is not responsible for any damage or loss that occurs before the device is received and scanned by our designated shipping carrier.</p><h3>4. Limitation of Liability</h3><p>In no event shall SecondHandCell, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from your access to or use of or inability to access or use the Service.</p><hr class="my-6 border-t border-slate-300"><h3>5. Policy on Lost/Stolen Devices & Legal Compliance (New York State & NYC)</h3><p>SecondHandCell is committed to operating in full compliance with all applicable laws and regulations regarding the purchase and sale of secondhand goods, particularly those concerning lost or stolen property. This section outlines our strict policy and the legal framework governing such transactions in New York State and New York City.</p><h4>Laws That May Apply (NY State + NYC)</h4><ul><li>**New York Penal Law § 155.05(2)(b) – Larceny by acquiring lost property:** If someone acquires lost property and does not take reasonable measures to return it, it counts as larceny.</li><li>**New York Penal Law § 165.40 – Criminal possession of stolen property in the 5th degree:** Knowingly possessing stolen property (or should reasonably know it’s stolen) is a misdemeanor.</li><li>**New York City Administrative Code § 20-272 et seq. (Secondhand Dealer Law):** Dealers in secondhand goods must:<ul><li>Keep records of all items received (including seller ID).</li><li>Provide daily reports to the NYPD of transactions (often through electronic reporting).</li><li>If police suspect an item is lost/stolen, you must hold and exhibit it to them.</li></ul></li><li>**New York City Administrative Code § 20-273:** It is unlawful to conceal, withhold, or refuse inspection of such goods.</li><li>**General Business Law (NY) GBL § 89-g and following – Regulation of pawnbrokers and secondhand dealers:** Requires keeping detailed records and prohibits resale of items flagged as stolen/lost until cleared.</li><li>**Federal Considerations (18 U.S.C. § 2315 – Possession or sale of stolen property):** If stolen goods (like phones) cross state lines or involve interstate commerce, federal law applies.</li></ul><h4>Process to Handle Lost/Stolen Phones in Your Buyback</h4><p>Here’s our step-by-step written policy to handle devices suspected of being lost or stolen:</p><h5>Intake & Verification</h5><ul><li>Every device received must be checked against:<ul><li>IMEI/serial number databases (e.g., GSMA, carrier blacklists).</li><li>Customer’s government-issued ID at time of transaction.</li></ul></li><li>Record the transaction in compliance with NYC Secondhand Dealer laws.</li></ul><h5>If a Device is Flagged as Lost or Stolen</h5><ul><li>Immediately set the device aside and do not refurbish, resell, or dispose of it.</li><li>Clearly label it as “On Hold – Suspected Lost/Stolen.”</li></ul><h5>Customer Communication</h5><ul><li>If the customer requests the item back:<ul><li>Explain: “Under New York law, we cannot return or release devices suspected to be lost or stolen. These items must be reported and may only be released by law enforcement.”</li></ul></li></ul><h5>Law Enforcement Notification</h5><ul><li>Report the device to the NYPD Property Clerk’s Office (or local precinct if outside NYC).</li><li>Provide transaction records, customer ID, and the device itself if requested.</li></ul><h5>Outcome</h5><ul><li>If police confirm the device is stolen:<ul><li>It will be seized and returned to the rightful owner or carrier.</li></ul></li><li>If cleared:<ul><li>You may proceed with processing the device as normal.</li></ul></li></ul><h5>Recordkeeping</h5><ul><li>Keep all paperwork of the transaction, report, and police correspondence for at least 5 years (per NYC dealer rules).</li></ul></div></div></div></div>

    <footer class="bg-slate-800 text-white">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-8">
                    <div>
                        <h3 class="text-xl font-bold mb-4">SecondHandCell</h3>
                        <p class="text-slate-400">Your trusted partner for selling used tech. Quick quotes, fair prices, and hassle-free service.</p>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-4">Quick Links</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-slate-400 hover:text-white transition duration-300">Home</a></li>
                            <li><a href="#" id="aboutUsLink" class="text-slate-400 hover:text-white transition duration-300">About Us</a></li>
                            <li><a href="#" id="privacyPolicyLink" class="text-slate-400 hover:text-white transition duration-300">Privacy Policy</a></li>
                            <li><a href="#" id="termsAndConditionsLink" class="text-slate-400 hover:text-white transition duration-300">Terms & Conditions</a></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-4">Contact Us</h3>
                        <p class="text-slate-400">Email: support@secondhandcell.com</p>

                    </div>
                </div>
                <div class="bg-slate-700 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-2 text-white">Stay Updated</h3>
                    <p class="text-slate-300 mb-4">Sign up for promos, price increases, and more!</p>
                    <form id="footerEmailSignupForm" class="flex flex-col sm:flex-row gap-2">
                        <label for="footerPromoEmail" class="sr-only">Email Address</label>
                        <input type="email" id="footerPromoEmail" placeholder="Enter your email" class="w-full flex-grow border border-slate-400 bg-slate-800 text-white p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-300 shadow-sm">Sign Up</button>
                    </form>
                    <div id="footerSignupMessage" class="mt-3 text-sm text-center"></div>
                </div>
            </div>
            <div class="border-t border-slate-700 mt-8 pt-6 text-center text-slate-400 text-sm"><p>&copy; 2025 SecondHandCell. All rights reserved.</p></div>
        </div>
    </footer>

    <script>
        // --- STATE DATA AND VALIDATION ---
        const US_STATES = [
            { name: "Alabama", code: "AL" }, { name: "Alaska", code: "AK" }, { name: "Arizona", code: "AZ" }, { name: "Arkansas", code: "AR" },
            { name: "California", code: "CA" }, { name: "Colorado", code: "CO" }, { name: "Connecticut", code: "CT" }, { name: "Delaware", code: "DE" },
            { name: "Florida", code: "FL" }, { name: "Georgia", code: "GA" }, { name: "Hawaii", code: "HI" }, { name: "Idaho", code: "ID" },
            { name: "Illinois", code: "IL" }, { name: "Indiana", code: "IN" }, { name: "Iowa", code: "IA" }, { name: "Kansas", code: "KS" },
            { name: "Kentucky", code: "KY" }, { name: "Louisiana", code: "LA" }, { name: "Maine", code: "ME" }, { name: "Maryland", code: "MD" },
            { name: "Massachusetts", code: "MA" }, { name: "Michigan", code: "MI" }, { name: "Minnesota", code: "MN" }, { name: "Mississippi", code: "MS" },
            { name: "Missouri", code: "MO" }, { name: "Montana", code: "MT" }, { name: "Nebraska", code: "NE" }, { name: "Nevada", code: "NV" },
            { name: "New Hampshire", code: "NH" }, { name: "New Jersey", code: "NJ" }, { name: "New Mexico", code: "NM" }, { name: "New York", code: "NY" },
            { name: "North Carolina", code: "NC" }, { name: "North Dakota", code: "ND" }, { name: "Ohio", code: "OH" }, { name: "Oklahoma", code: "OK" },
            { name: "Oregon", code: "OR" }, { name: "Pennsylvania", code: "PA" }, { name: "Rhode Island", code: "RI" }, { name: "South Carolina", code: "SC" },
            { name: "South Dakota", code: "SD" }, { name: "Tennessee", code: "TN" }, { name: "Texas", code: "TX" }, { name: "Utah", code: "UT" },
            { name: "Vermont", code: "VT" }, { name: "Virginia", code: "VA" }, { name: "Washington", code: "WA" }, { name: "West Virginia", code: "WV" },
            { name: "Wisconsin", code: "WI" }, { name: "Wyoming", code: "WY" }
        ];
        
        // NEW: Function to populate the <select> element
        function populateStateSelect() {
            const selectElement = document.getElementById('state');
            if (!selectElement) return;
            
            const fragment = document.createDocumentFragment();

            US_STATES.forEach(state => {
                const option = document.createElement('option');
                // Value is the short code for easy order processing
                option.value = state.code;
                // Text includes both name and code for user convenience
                option.textContent = `${state.name} (${state.code})`;
                fragment.appendChild(option);
            });
            selectElement.appendChild(fragment);
        }


        // Global variable to hold the autocomplete instance
        let autocomplete;

        // This function is called by the Google Maps script when it has loaded.
        function initAutocomplete() {
            // Get the input element
            const streetAddressInput = document.getElementById('street-address');
            
            // Create the autocomplete object, restricting the search to geographical location types.
            autocomplete = new google.maps.places.Autocomplete(streetAddressInput, {
                types: ['address'],
                componentRestrictions: { country: 'us' } // Restrict to US addresses
            });

            // When the user selects an address from the dropdown, populate the address fields in the form.
            autocomplete.addListener('place_changed', fillInAddress);
        }

        function fillInAddress() {
            // Get the place details from the autocomplete object.
            const place = autocomplete.getPlace();

            if (!place || !place.address_components) {
                console.warn("Autocomplete's returned place contains no address components");
                return;
            }

            // Get each component of the address from the place details,
            // and then fill-in the corresponding field on the form.
            const streetAddressInput = document.getElementById('street-address');
            const cityInput = document.getElementById('city');
            const stateInput = document.getElementById('state');
            const zipCodeInput = document.getElementById('zip-code');

            // Clear out the fields first
            streetAddressInput.value = '';
            cityInput.value = '';
            stateInput.value = '';
            zipCodeInput.value = '';

            let streetNumber = '';
            let route = '';

            for (const component of place.address_components) {
                const componentType = component.types[0];

                switch (componentType) {
                    case 'street_number':
                        streetNumber = component.long_name;
                        break;
                    case 'route':
                        route = component.short_name;
                        break;
                    case 'locality':
                        cityInput.value = component.long_name;
                        break;
                    case 'administrative_area_level_1':
                        // Use the short name (two-letter code) for the state input
                        stateInput.value = component.short_name;
                        break;
                    case 'postal_code':
                        zipCodeInput.value = component.long_name;
                        break;
                }
            }
            
            streetAddressInput.value = `${streetNumber} ${route}`.trim();

            // Manually trigger an input event on each field to let other scripts know they've changed
            const event = new Event('input', { bubbles: true });
            streetAddressInput.dispatchEvent(event);
            cityInput.dispatchEvent(event);
            stateInput.dispatchEvent(event);
            zipCodeInput.dispatchEvent(event);
        }
        
        let device = null;

        /**
         * Formats the phone number as the user types: (###) ###-####.
         * It restricts input to digits and automatically adds parentheses and dashes.
         * It handles optional leading '1' (country code).
         * @param {HTMLInputElement} input 
         */
        function formatPhoneNumber(input) {
            // 1. Get current value and strip all non-digits
            let cleaned = ('' + input.value).replace(/\D/g, '');
            
            // 2. Adjust for optional country code '1'
            if (cleaned.length === 11 && cleaned.startsWith('1')) {
                // If it's 11 digits and starts with '1', treat it as a US number with country code.
                cleaned = cleaned.substring(1);
            }
            
            // Limit to a maximum of 10 digits for formatting
            cleaned = cleaned.substring(0, 10);

            let formatted = '';

            // 3. Format based on the cleaned 10-digit number
            if (cleaned.length > 0) {
                // (XXX)
                formatted += '(' + cleaned.substring(0, 3);
            }
            if (cleaned.length >= 4) {
                // (XXX) XXX
                formatted += ') ' + cleaned.substring(3, 6);
            }
            if (cleaned.length >= 7) {
                // (XXX) XXX-XXXX
                formatted += '-' + cleaned.substring(6, 10);
            }

            // 4. Update the input value and limit length
            input.value = formatted;
            
            // Call updateOverview to update the display in real-time
            updateOverview();
        }

        document.addEventListener('DOMContentLoaded', async function() {
            // --- UPDATED: Populate the state select on load ---
            populateStateSelect();
            
            // --- NEW: Add event listener for real-time phone formatting ---
            const phoneInput = document.getElementById('phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', () => formatPhoneNumber(phoneInput));
                // Set the max length to 14 characters: "(555) 555-5555"
                phoneInput.maxLength = 14;
            }
            // --- END NEW PHONE FORMATTING LISTENER ---


            const auth = window.firebaseAuth;
            const GoogleAuthProvider = window.GoogleAuthProvider;
            const signInWithPopup = window.signInWithPopup;
            const signInWithEmailAndPassword = window.signInWithEmailAndPassword;
            const createUserWithEmailAndPassword = window.createUserWithEmailAndPassword;
            const signOut = window.signOut;
            const onAuthStateChanged = window.onAuthStateChanged;
            const updateProfile = window.updateProfile;
            const sendPasswordResetEmail = window.sendPasswordResetEmail;
            const db = window.firebaseDb;
            const { doc, getDoc } = window.firebase.firestore;
            const serverTimestamp = window.firebaseServerTimestamp;

            // --- DYNAMIC CONTENT SETUP ---
            const loadingIndicator = document.getElementById('loadingIndicator');
            const questionContainer = document.getElementById('questionContainer');
            const errorDisplay = document.getElementById('errorDisplay');
            
            // --- NEW ELEMENTS ---
            const functionalDetailsLink = document.getElementById('functionalDetailsLink');
            const fullyFunctionalModal = document.getElementById('fullyFunctionalModal');


            // Get the device slug from the URL query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const deviceParam = urlParams.get('device');
            
            function getBrandAndSlug(param) {
                if (!param || typeof param !== 'string') return null;
                const parts = param.split('-');
                const brands = ['iphone', 'samsung', 'google', 'ipad'];
                const brand = parts[0];
                if (brands.includes(brand)) {
                    return {
                        brand: brand,
                        slug: parts.slice(1).join('-')
                    };
                }
                return null;
            }

            const deviceInfo = getBrandAndSlug(deviceParam);

            if (!deviceInfo || !deviceInfo.slug) {
                loadingIndicator.classList.add('hidden');
                errorDisplay.classList.remove('hidden');
                console.error("Invalid device parameter in URL.");
                return;
            }

            async function fetchDevicePricing(brand, slug) {
                try {
                    const docRef = doc(db, `devices/${brand}/models`, slug);
                    const docSnap = await getDoc(docRef);
                    
                    if (docSnap.exists()) {
                        return docSnap.data();
                    } else {
                        console.error(`Device data for slug "${slug}" not found.`);
                        return null;
                    }
                } catch (error) {
                    console.error("Error fetching document:", error);
                    return null;
                }
            }
            
            device = await fetchDevicePricing(deviceInfo.brand, deviceInfo.slug);
            
            if (!device) {
                loadingIndicator.classList.add('hidden');
                errorDisplay.classList.remove('hidden');
                return;
            }

            loadingIndicator.classList.add('hidden');
            questionContainer.classList.remove('hidden');

            document.title = `SecondHandCell - Sell ${device.name}`;
            
            // --- IMAGE LOADING LOGIC ---
            function loadImageWithFallback(imgElement) {
                const baseSrc = imgElement.dataset.baseSrc;
                if (!baseSrc) return;
                const extensions = ['.webp', '.avif', '.png', '.jpeg', '.jpg'];
                let current = 0;
                function tryLoad() {
                    if (current >= extensions.length) {
                        imgElement.src = 'https://placehold.co/200x200/e0e7ff/4338ca?text=No+Image';
                        return;
                    }
                    const testSrc = baseSrc + extensions[current];
                    const img = new Image();
                    img.onload = () => { imgElement.src = testSrc; };
                    img.onerror = () => { current++; tryLoad(); };
                    img.src = testSrc;
                }
                tryLoad();
            }

            // Find the device image element
            const deviceImageElement = document.getElementById('deviceImage');
            if (deviceImageElement && device.imageUrl) {
                // Set the data-base-src attribute to the image path from Firestore
                deviceImageElement.dataset.baseSrc = device.imageUrl;
                // Call the loading function
                loadImageWithFallback(deviceImageElement);
            } else {
                console.error("Device image element not found or device.imageUrl is missing.");
            }
            
            document.getElementById('deviceImage').alt = device.name;
            document.getElementById('deviceDisplayName').textContent = device.name;
            document.getElementById('deviceDisplayNameText').textContent = device.name;
            const halloweenDeviceNameEl = document.getElementById('halloweenDeviceName');
            if (halloweenDeviceNameEl) {
                halloweenDeviceNameEl.textContent = device.name;
            }
            document.getElementById('overviewDevice').textContent = device.name;

            const storageSelect = document.getElementById('storage');
            const fragment = document.createDocumentFragment();
            // Use the fetched device data to populate the storage options
            for (const storage in device.prices) {
                const option = document.createElement('option');
                option.value = storage;
                option.textContent = storage;
                fragment.appendChild(option);
            }
            storageSelect.innerHTML = '<option value="">Select Storage</option>';
            storageSelect.appendChild(fragment);
            
            // --- REST OF THE CODE ---
            const getQuoteBtn = document.getElementById('getQuoteBtn');
            const quoteMessage = document.getElementById('quoteMessage');
            const nextSteps = document.getElementById('nextSteps');
            const finalQuoteAmountMainDisplay = document.getElementById('mainQuoteDisplay');
            const finalQuoteAmountMainText = document.getElementById('finalQuoteAmountMain');
            const finalQuoteAmountPopup = document.getElementById('finalQuoteAmountPopup');
            const shippingOptions = document.getElementById('shippingOptions');
            const overviewShippingPreference = document.getElementById('overviewShippingPreference');
            const overviewCarrier = document.getElementById('overviewCarrier');
            const overviewQuote = document.getElementById('overviewQuote');
            const overviewAddress = document.getElementById('overviewAddress');
            // NEW: Reference to Phone overview element
            const overviewPhone = document.getElementById('overviewPhone'); 
            const sendPhoneBtn = document.getElementById('sendPhoneBtn');
            const loginModal = document.getElementById('loginModal');
            // Using a more specific selector for the close button to avoid conflicts
            const closeLoginModalBtn = loginModal.querySelector('.close-modal-btn');
            const loginTabBtn = document.getElementById('loginTabBtn');
            const signupTabBtn = document.getElementById('signupTabBtn');
            const loginNavBtn = document.getElementById('loginNavBtn');
            const quoteModal = document.getElementById('quoteModal');
            const quoteModalContinueBtn = document.getElementById('quoteModalContinueBtn');
            const authStatusContainer = document.getElementById('authStatusContainer');
            const userMonogram = document.getElementById('userMonogram');
            const authDropdown = document.getElementById('authDropdown');
            const logoutBtn = document.getElementById('logoutBtn');
            const cosmeticConditionDescription = document.getElementById('cosmeticConditionDescription');
            const googleLoginBtn = document.getElementById('googleLoginBtn');
            const emailLoginBtn = document.getElementById('emailLoginBtn');
            const loginEmailInput = document.getElementById('loginEmail');
            const loginPasswordInput = document.getElementById('loginPassword');
            const googleSignupBtn = document.getElementById('googleSignupBtn');
            const emailSignupBtn = document.getElementById('emailSignupBtn');
            const signupNameInput = document.getElementById('signupName');
            const signupEmailInput = document.getElementById('signupEmail');
            const signupPasswordInput = document.getElementById('signupPassword');
            // Assuming signupPhone is not in the new modal, this will be null and should be handled.
            const signupPhoneInput = document.getElementById('signupPhone');
            const authMessage = document.getElementById('authMessage');
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const switchToLogin = document.getElementById('switchToLogin');
            
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            const forgotEmailInput = document.getElementById('forgotEmail');
            const sendResetEmailBtn = document.getElementById('sendResetEmailBtn');
            const returnToLoginLink = document.getElementById('returnToLogin');
            
            const footerEmailSignupForm = document.getElementById('footerEmailSignupForm');
            const footerPromoEmailInput = document.getElementById('footerPromoEmail');
            const footerSignupMessage = document.getElementById('footerSignupMessage');

            const shippingInfoEmailInput = document.getElementById('email');
            // const phoneInput = document.getElementById('phone'); // Already defined above

            const streetAddressInput = document.getElementById('street-address');
            const cityInput = document.getElementById('city');
            const stateInput = document.getElementById('state');
            const zipCodeInput = document.getElementById('zip-code');
            
            // New modal links
            const aboutUsLink = document.getElementById('aboutUsLink');
            const privacyPolicyLink = document.getElementById('privacyPolicyLink');
            const termsAndConditionsLink = document.getElementById('termsAndConditionsLink');
            
            // New payment modal elements
            const paymentModal = document.getElementById('paymentModal');
            const paymentOptions = document.querySelectorAll('input[name="payment_method"]');
            const venmoFields = document.getElementById('venmoFields');
            const zelleFields = document.getElementById('zelleFields');
            const paypalFields = document.getElementById('paypalFields');
            const submitOrderBtn = document.getElementById('submitOrderBtn');
            const paymentMessage = document.getElementById('paymentMessage');
            const promoCountdownEl = document.getElementById('promoCountdown');
            const quoteVelocityStatEl = document.getElementById('quoteVelocityStat');
            const kitTurnaroundStatEl = document.getElementById('kitTurnaroundStat');
            const rsvpEventBtn = document.getElementById('rsvpEventBtn');
            const spinWheelBtn = document.getElementById('spinWheelBtn');
            const shareReferralBtn = document.getElementById('shareReferralBtn');
            const fastPassBtn = document.getElementById('fastPassBtn');

            let isUserLoggedIn = false;
            let currentUserId = null;
            let finalQuote = 0;
            
            // Basic modal controls for the new modals
            const openModal = (modalId) => document.getElementById(modalId)?.classList.add('is-visible');
            const closeModal = (modal) => modal?.classList.remove('is-visible');
            
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal(modal);
                });
                modal.querySelector('.close-modal-btn')?.addEventListener('click', () => closeModal(modal));
            });

            if(aboutUsLink) aboutUsLink.addEventListener('click', (e) => { e.preventDefault(); openModal('aboutUsModal'); });
            if(privacyPolicyLink) privacyPolicyLink.addEventListener('click', (e) => { e.preventDefault(); openModal('privacyPolicyModal'); });
            if(termsAndConditionsLink) termsAndConditionsLink.addEventListener('click', (e) => { e.preventDefault(); openModal('termsAndConditionsModal'); });
            
            // Listener for the Functional Details Link
            if (functionalDetailsLink) {
                functionalDetailsLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    openModal('fullyFunctionalModal');
                });
            }


            function getRandomLightColor() {
                const hue = Math.floor(Math.random() * 360);
                const saturation = Math.floor(Math.random() * 30) + 70;
                const lightness = Math.floor(Math.random() * 20) + 70;
                return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
            }

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    isUserLoggedIn = true;
                    currentUserId = user.uid;
                    console.log("User is logged in:", user.uid);
                    loginNavBtn.classList.add('hidden');
                    userMonogram.classList.remove('hidden');

                    const displayName = user.displayName;
                    const email = user.email;
                    let initials = '';

                    if (displayName) {
                        initials = displayName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                    } else if (email) {
                        const username = email.split('@')[0];
                        const nameParts = username.split('.');
                        initials = nameParts.map(part => part.charAt(0)).join('').toUpperCase().substring(0, 2);
                    }

                    userMonogram.textContent = initials;
                    
                    hideLoginModal();

                    if (shippingInfoEmailInput && user.email) {
                        shippingInfoEmailInput.value = user.email;
                    }

                    if (finalQuote > 0 && nextSteps.classList.contains('hidden')) {
                        nextSteps.classList.remove('hidden');
                        updateOverview();
                        nextSteps.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                } else {
                    isUserLoggedIn = false;
                    currentUserId = null;
                    console.log("User is logged out.");
                    loginNavBtn.classList.remove('hidden');
                    userMonogram.classList.add('hidden');
                    userMonogram.textContent = '';
                    authDropdown.classList.add('hidden');

                    if (shippingInfoEmailInput) {
                        shippingInfoEmailInput.value = '';
                    }
                }
            });
            userMonogram.addEventListener('click', (e) => {
                e.stopPropagation();
                authDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', (e) => {
                if (!authStatusContainer.contains(e.target)) {
                    authDropdown.classList.add('hidden');
                }
            });

            logoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                } catch (error) {
                    console.error("Logout error:", error);
                }
            });

            const BACKEND_URL = 'https://us-central1-buyback-a0f05.cloudfunctions.net/api';

            function showAuthMessage(msg, type) {
                authMessage.textContent = msg;
                authMessage.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
                if (type === 'error') {
                    authMessage.classList.add('bg-red-100', 'text-red-700');
                } else if (type === 'success') {
                    authMessage.classList.add('bg-green-100', 'text-green-700');
                } else if (type === 'info') {
                    authMessage.classList.add('bg-blue-100', 'text-blue-700');
                }
                authMessage.classList.remove('hidden');
            }

            function clearAuthMessage() {
                authMessage.classList.add('hidden');
                authMessage.textContent = '';
            }

            function showLoginModal() {
                openModal('loginModal');
                clearAuthMessage();
                showTab('login');
            }

            function hideLoginModal() {
                closeModal(document.getElementById('loginModal'));
            }

            function showTab(tabName) {
                clearAuthMessage();
                loginTabBtn.classList.remove('border-blue-600', 'text-blue-600');
                signupTabBtn.classList.remove('border-blue-600', 'text-blue-600');
                loginTabBtn.classList.add('border-transparent', 'text-slate-500');
                signupTabBtn.classList.add('border-transparent', 'text-slate-500');

                if (tabName === 'login') {
                    loginForm.classList.remove('hidden');
                    signupForm.classList.add('hidden');
                    forgotPasswordForm.classList.add('hidden');
                    loginTabBtn.classList.add('border-blue-600', 'text-blue-600');
                    signupTabBtn.classList.remove('border-blue-600', 'text-blue-600');
                } else if (tabName === 'signup') {
                    signupForm.classList.remove('hidden');
                    loginForm.classList.add('hidden');
                    forgotPasswordForm.classList.add('hidden');
                    signupTabBtn.classList.add('border-blue-600', 'text-blue-600');
                    loginTabBtn.classList.remove('border-blue-600', 'text-blue-600');
                } else if (tabName === 'forgotPassword') {
                    forgotPasswordForm.classList.remove('hidden');
                    loginForm.classList.add('hidden');
                    signupForm.classList.add('hidden');
                    loginTabBtn.classList.remove('border-blue-600', 'text-blue-600');
                    signupTabBtn.classList.remove('border-blue-600', 'text-blue-600');
                }
            }


            function showQuotePopup() {
                quoteModal.classList.add('is-visible');
            }

            function hideQuotePopup() {
                quoteModal.classList.remove('is-visible');
            }

            if(closeLoginModalBtn) closeLoginModalBtn.addEventListener('click', hideLoginModal);
            
            loginTabBtn.addEventListener('click', () => {
                showTab('login');
            });
            signupTabBtn.addEventListener('click', () => {
                showTab('signup');
            });
            loginNavBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showLoginModal();
            });
            switchToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                showTab('login');
            });
            returnToLoginLink.addEventListener('click', (e) => {
                e.preventDefault();
                showTab('login');
            });
            
            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                showTab('forgotPassword');
            });

            forgotPasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = forgotEmailInput.value;
                if (!email) {
                    showAuthMessage('Please enter your email address.', 'error');
                    return;
                }
                
                try {
                    clearAuthMessage();
                    showAuthMessage('Sending password reset email...', 'info');
                    await sendPasswordResetEmail(auth, email);
                    showAuthMessage('A password reset link has been sent to your email. Check your inbox and spam folder.', 'success');
                    forgotEmailInput.value = '';
                } catch (error) {
                    console.error("Password reset error:", error);
                    showAuthMessage(`Password reset failed: ${error.message}`, 'error');
                }
            });

            quoteModalContinueBtn.addEventListener('click', () => {
                hideQuotePopup();
                finalQuoteAmountMainDisplay.classList.remove('hidden');
                if (isUserLoggedIn) {
                    nextSteps.classList.remove('hidden');
                    updateOverview();
                    nextSteps.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    showLoginModal();
                }
            });

            const googleProvider = new GoogleAuthProvider();

            googleLoginBtn.addEventListener('click', async () => {
                try {
                    clearAuthMessage();
                    showAuthMessage('Signing in with Google...', 'info');
                    await signInWithPopup(auth, googleProvider);
                } catch (error) {
                    console.error("Google login error:", error);
                    showAuthMessage(`Google login failed: ${error.message}`, 'error');
                }
            });

            googleSignupBtn.addEventListener('click', async () => {
                try {
                    clearAuthMessage();
                    showAuthMessage('Signing up with Google...', 'info');
                    await signInWithPopup(auth, googleProvider);
                } catch (error) {
                    console.error("Google signup error:", error);
                    showAuthMessage(`Google signup failed: ${error.message}`, 'error');
                }
            });

            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = loginEmailInput.value;
                const password = loginPasswordInput.value;
                if (!email || !password) {
                    showAuthMessage('Please enter both email and password.', 'error');
                    return;
                }
                try {
                    clearAuthMessage();
                    showAuthMessage('Logging in...', 'info');
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    console.error("Email login error:", error);
                    showAuthMessage(`Login failed: ${error.message}`, 'error');
                }
            });

            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = signupNameInput.value;
                const email = signupEmailInput.value;
                const password = signupPasswordInput.value;

                if (!name || !email || !password) {
                    showAuthMessage('Please enter your name, email, and password.', 'error');
                    return;
                }
                if (password.length < 6) {
                    showAuthMessage('Password should be at least 6 characters.', 'error');
                    return;
                }

                try {
                    clearAuthMessage();
                    showAuthMessage('Creating account...', 'info');
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await updateProfile(userCredential.user, {
                        displayName: name
                    });
                    showAuthMessage('Account created successfully! You are now logged in.', 'success');
                } catch (error) {
                    console.error("Email signup error:", error);
                    showAuthMessage(`Sign up failed: ${error.message}`, 'error');
                }
            });


            function showQuoteMessage(msg, type) {
                quoteMessage.textContent = msg;
                quoteMessage.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
                if (type === 'error') {
                    quoteMessage.classList.add('bg-red-100', 'text-red-700');
                } else if (type === 'success') {
                    quoteMessage.classList.add('bg-green-100', 'text-green-700');
                } else if (type === 'info') {
                    quoteMessage.classList.add('bg-blue-100', 'text-blue-700');
                }
                quoteMessage.classList.remove('hidden');
            }

            function clearQuoteMessage() {
                quoteMessage.classList.add('hidden');
                quoteMessage.textContent = '';
            }

            const broadcastPromo = (message, tone = 'info', duration = 7000) => {
                showQuoteMessage(message, tone);
                if (duration) {
                    setTimeout(() => {
                        clearQuoteMessage();
                    }, duration);
                }
            };

            const animateStat = (element, target, suffix = '', formatter = (value) => Math.round(value).toLocaleString()) => {
                if (!element) return;
                let frame = 0;
                const totalFrames = 40;
                const startValue = 0;
                const update = () => {
                    frame += 1;
                    const progress = Math.min(frame / totalFrames, 1);
                    const current = startValue + (target - startValue) * progress;
                    element.textContent = `${formatter(current)}${suffix}`;
                    if (progress < 1) {
                        requestAnimationFrame(update);
                    }
                };
                requestAnimationFrame(update);
            };

            if (quoteVelocityStatEl) {
                animateStat(quoteVelocityStatEl, 97, '%', (value) => Math.round(value));
            }

            if (kitTurnaroundStatEl) {
                animateStat(kitTurnaroundStatEl, 18000, '', (value) => Math.round(value).toLocaleString());
            }

            const updatePromoCountdown = () => {
                if (!promoCountdownEl) return;
                const now = new Date();
                let eventDate = new Date(`${now.getFullYear()}-10-25T09:00:00`);
                if (now > eventDate) {
                    eventDate = new Date(`${now.getFullYear() + 1}-10-25T09:00:00`);
                }
                const diff = eventDate - now;
                if (diff <= 0) {
                    promoCountdownEl.textContent = 'We\'re live!';
                    return;
                }
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const minutes = Math.floor((diff / (1000 * 60)) % 60);
                promoCountdownEl.textContent = `${days}d ${hours}h ${minutes}m`;
            };

            if (promoCountdownEl) {
                updatePromoCountdown();
                setInterval(updatePromoCountdown, 60000);
            }

            if (rsvpEventBtn) {
                rsvpEventBtn.addEventListener('click', () => {
                    broadcastPromo('RSVP received! We\'ll send over a calendar reminder and reserve your inspection slot.', 'success');
                });
            }

            if (spinWheelBtn) {
                spinWheelBtn.addEventListener('click', () => {
                    const multipliers = [1.1, 1.15, 1.2, 1.25, 1.31];
                    const reward = multipliers[Math.floor(Math.random() * multipliers.length)];
                    broadcastPromo(`Wheel result: ${reward.toFixed(2)}× payout boost unlocked! It will apply automatically to your next shipped device.`, 'success');
                });
            }

            if (shareReferralBtn) {
                shareReferralBtn.addEventListener('click', async () => {
                    const referralLink = `${window.location.origin}/sell/index.html?ref=${currentUserId || 'boo'}`;
                    if (navigator.clipboard?.writeText) {
                        try {
                            await navigator.clipboard.writeText(referralLink);
                        } catch (error) {
                            console.warn('Clipboard copy failed:', error);
                        }
                    }
                    broadcastPromo('Referral link copied! Share it with your boo crew and both of you earn $20 treats.', 'info');
                });
            }

            if (fastPassBtn) {
                fastPassBtn.addEventListener('click', () => {
                    broadcastPromo('Fastpass activated! We\'ll prioritize your kit the moment tracking scans.', 'success');
                });
            }
            
            function showPaymentMessage(msg, type) {
                paymentMessage.textContent = msg;
                paymentMessage.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
                if (type === 'error') {
                    paymentMessage.classList.add('bg-red-100', 'text-red-700');
                } else if (type === 'success') {
                    paymentMessage.classList.add('bg-green-100', 'text-green-700');
                } else if (type === 'info') {
                    paymentMessage.classList.add('bg-blue-100', 'text-blue-700');
                }
                paymentMessage.classList.remove('hidden');
            }
            
            function clearPaymentMessage() {
                paymentMessage.classList.add('hidden');
                paymentMessage.textContent = '';
            }


            function clearHighlights() {
                document.querySelectorAll('.highlight-missing').forEach(el => {
                    el.classList.remove('highlight-missing');
                });
                document.querySelectorAll('.carrier-option label, .shipping-option label, .payment-option label').forEach(label => {
                    label.classList.remove('highlight-missing');
                });
                document.querySelectorAll('.custom-checkbox .checkmark').forEach(checkmark => {
                    checkmark.classList.remove('highlight-missing');
                });
                document.getElementById('state').classList.remove('highlight-missing'); // Clear state input separately
            }

            const cosmeticDescriptions = {
                'flawless': 'Looks new with no signs of use. This is the best condition a used device can be in. There are no scratches, scuffs, or any other cosmetic imperfections visible to the naked eye. The device appears as if it just came out of its original packaging, offering a pristine aesthetic and feel.',
                'good': 'There may be a few light scuffs or scratches that are smaller than the size of a pencil eraser. These minor imperfections are typically on the casing or screen, but do not affect the device\'s functionality or overall aesthetic significantly. They are generally only noticeable upon close inspection and do not detract from the device\'s premium feel.',
                'fair': 'There are noticeable scratches or scuffs on the front and back. These could include multiple visible scratches, minor dents, or paint chips on the frame. While these cosmetic issues are more prominent, they do not impede the device\'s core functions, and the screen remains fully usable despite the marks.',
                'damaged': 'Major cosmetic damage includes being bent, chipped, dented, or sunbleached. This category also covers devices with significant wear and tear, deep scratches, or other substantial visual defects that clearly impact the device\'s appearance. These issues are immediately apparent and go beyond normal wear, affecting the overall integrity and look of the device.'
            };

            document.querySelectorAll('input[name="q4_cosmetic_condition"]').forEach(radio => {
                radio.addEventListener('change', (event) => {
                    const selectedCondition = event.target.value;
                    const description = cosmeticDescriptions[selectedCondition];
                    if (description) {
                        cosmeticConditionDescription.textContent = description;
                        cosmeticConditionDescription.classList.remove('hidden');
                    } else {
                        cosmeticConditionDescription.classList.add('hidden');
                        cosmeticConditionDescription.textContent = '';
                    }
                });
            });

            const carrierSection = document.getElementById('carrierSection');
            const powerOnSection = document.getElementById('powerOnSection');
            const functionalSection = document.getElementById('functionalSection');
            const cracksSection = document.getElementById('cracksSection');
            const cosmeticSection = document.getElementById('cosmeticSection');
            
            // Helper function to uncheck all radios in a container
            function uncheckRadiosInContainer(container) {
                container.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                });
            }

            function hideAndClearQuestions(...sections) {
                sections.forEach(section => {
                    section.classList.add('hidden');
                    uncheckRadiosInContainer(section);
                });
            }

            function showAndClearQuestions(section) {
                section.classList.remove('hidden');
                uncheckRadiosInContainer(section);
            }
            
            function hideAllQuestions() {
                [carrierSection, powerOnSection, functionalSection, cracksSection, cosmeticSection, getQuoteBtn].forEach(el => {
                    el.classList.add('hidden');
                });
                uncheckRadiosInContainer(carrierSection);
                uncheckRadiosInContainer(powerOnSection);
                uncheckRadiosInContainer(functionalSection);
                uncheckRadiosInContainer(cracksSection);
                uncheckRadiosInContainer(cosmeticSection);
                clearQuoteMessage();
                finalQuoteAmountMainDisplay.classList.add('hidden');
                nextSteps.classList.add('hidden');
            }
            
            document.getElementById('storage').addEventListener('change', function() {
                if (this.value) {
                    carrierSection.classList.remove('hidden');
                    // Reset all dependent questions when storage changes
                    hideAndClearQuestions(powerOnSection, functionalSection, cracksSection, cosmeticSection);
                    getQuoteBtn.classList.add('hidden');
                    
                    clearQuoteMessage();
                    this.classList.remove('highlight-missing');
                    saveFormState();
                } else {
                    hideAllQuestions();
                }
            });
            
            document.querySelectorAll('input[name="carrier"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    powerOnSection.classList.remove('hidden');
                    // Reset all dependent questions when carrier changes
                    hideAndClearQuestions(functionalSection, cracksSection, cosmeticSection);
                    getQuoteBtn.classList.add('hidden');

                    clearQuoteMessage();
                    saveFormState();
                });
            });

            document.querySelectorAll('input[name="q1_power_on"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'yes') {
                        functionalSection.classList.remove('hidden');
                        // Reset all dependent questions when power on changes
                        hideAndClearQuestions(cracksSection, cosmeticSection);
                        getQuoteBtn.classList.add('hidden');

                        clearQuoteMessage();
                    } else {
                        hideAndClearQuestions(functionalSection, cracksSection, cosmeticSection);
                        getQuoteBtn.classList.remove('hidden');
                    }
                    saveFormState();
                });
            });
            
            document.querySelectorAll('input[name="q2_fully_functional"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'yes') {
                        cracksSection.classList.remove('hidden');
                        // Reset all dependent questions when functional changes
                        hideAndClearQuestions(cosmeticSection);
                        getQuoteBtn.classList.add('hidden');

                        clearQuoteMessage();
                    } else {
                        hideAndClearQuestions(cracksSection, cosmeticSection);
                        getQuoteBtn.classList.remove('hidden');
                    }
                    saveFormState();
                });
            });
            
            document.querySelectorAll('input[name="q3_no_cracks"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'yes') {
                        cosmeticSection.classList.remove('hidden');
                        getQuoteBtn.classList.add('hidden');
                        clearQuoteMessage();
                    } else {
                        hideAndClearQuestions(cosmeticSection);
                        getQuoteBtn.classList.remove('hidden');
                    }
                    saveFormState();
                });
            });

            document.querySelectorAll('input[name="q4_cosmetic_condition"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    getQuoteBtn.classList.remove('hidden');
                    clearQuoteMessage();
                    saveFormState();
                });
            });
            
            function calculateQuoteAndDisplay() {
                clearQuoteMessage();
                clearHighlights();
                
                const selectedStorage = document.getElementById('storage').value;
                const selectedCarrier = document.querySelector('input[name="carrier"]:checked')?.value;
                const q1PowerOn = document.querySelector('input[name="q1_power_on"]:checked')?.value;
                const q2Functional = document.querySelector('input[name="q2_fully_functional"]:checked')?.value;
                const q3NoCracks = document.querySelector('input[name="q3_no_cracks"]:checked')?.value;
                const q4Cosmetic = document.querySelector('input[name="q4_cosmetic_condition"]:checked')?.value;

                let hasError = false;

                if (!selectedStorage) {
                    document.getElementById('storage').classList.add('highlight-missing');
                    hasError = true;
                }
                if (!selectedCarrier) {
                    document.getElementById('carrierOptions').classList.add('highlight-missing');
                    hasError = true;
                }
                if (!q1PowerOn) {
                    document.getElementById('powerOnSection').classList.add('highlight-missing');
                    hasError = true;
                }
                if (q1PowerOn === 'yes' && !q2Functional) {
                    document.getElementById('functionalSection').classList.add('highlight-missing');
                    hasError = true;
                }
                if (q1PowerOn === 'yes' && q2Functional === 'yes' && !q3NoCracks) {
                    document.getElementById('cracksSection').classList.add('highlight-missing');
                    hasError = true;
                }
                if (q1PowerOn === 'yes' && q2Functional === 'yes' && q3NoCracks === 'yes' && !q4Cosmetic) {
                    document.getElementById('cosmeticSection').classList.add('highlight-missing');
                    hasError = true;
                }

                if (hasError) {
                    showQuoteMessage('Please answer all visible questions to get a quote.', 'error');
                    return;
                }

                // Determine the correct pricing key based on the selected carrier
                let selectedCarrierPricingKey = selectedCarrier;
                if (['att', 'tmobile', 'verizon', 'other'].includes(selectedCarrier)) {
                    selectedCarrierPricingKey = 'locked';
                }

                // Get the base prices for the selected storage and carrier from the fetched device data.
                const basePrices = device.prices[selectedStorage]?.[selectedCarrierPricingKey];
                
                if (!basePrices) {
                    showQuoteMessage('Pricing data for this combination is not available.', 'error');
                    return;
                }
                
                let finalPrice = 0;
                
                if (q1PowerOn === 'yes' && q2Functional === 'yes' && q3NoCracks === 'yes') {
                    // Fully functional, no cracks
                    finalPrice = basePrices[q4Cosmetic];
                } else if (q1PowerOn === 'yes' && q2Functional === 'yes' && q3NoCracks === 'no') {
                    // Fully functional, but has cracks
                    finalPrice = basePrices.damaged;
                } else if (q1PowerOn === 'yes' && q2Functional === 'no') {
                    // Powers on, but not functional
                    finalPrice = basePrices.broken;
                } else if (q1PowerOn === 'no') {
                    // Doesn't power on
                    finalPrice = basePrices.noPower;
                }
                
                finalQuote = finalPrice ? parseFloat(finalPrice.toFixed(2)) : 0;
                
                finalQuoteAmountMainText.textContent = `$${finalQuote.toFixed(2)}`;
                finalQuoteAmountPopup.textContent = `$${finalQuote.toFixed(2)}`;

                showQuotePopup();
            }

            getQuoteBtn.addEventListener('click', calculateQuoteAndDisplay);

            // Logic to handle the new payment modal and order submission
            function validatePaymentFields() {
                const selectedPaymentMethod = document.querySelector('input[name="payment_method"]:checked')?.value;
                let isComplete = false;
                
                if (selectedPaymentMethod) {
                    if (selectedPaymentMethod === 'venmo') {
                        const username = document.getElementById('venmoUsername').value;
                        const usernameConfirm = document.getElementById('venmoUsernameConfirm').value;
                        isComplete = username && username === usernameConfirm;
                    } else if (selectedPaymentMethod === 'zelle') {
                        const identifier = document.getElementById('zelleIdentifier').value;
                        const identifierConfirm = document.getElementById('zelleIdentifierConfirm').value;
                        isComplete = identifier && identifier === identifierConfirm;
                    } else if (selectedPaymentMethod === 'paypal') {
                        const email = document.getElementById('paypalEmail').value;
                        const emailConfirm = document.getElementById('paypalEmailConfirm').value;
                        isComplete = email && email === emailConfirm;
                    }
                }
                return isComplete;
            }

            function updateSubmitButtonState() {
                if (validatePaymentFields()) {
                    submitOrderBtn.classList.remove('btn-disabled');
                    submitOrderBtn.textContent = 'Submit Order';
                    submitOrderBtn.disabled = false;
                } else {
                    submitOrderBtn.classList.add('btn-disabled');
                    submitOrderBtn.textContent = 'Submit Order';
                    submitOrderBtn.disabled = true;
                }
            }

            paymentOptions.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    venmoFields.classList.add('hidden');
                    zelleFields.classList.add('hidden');
                    paypalFields.classList.add('hidden');
                    
                    const selectedMethod = e.target.value;
                    if (selectedMethod === 'venmo') {
                        venmoFields.classList.remove('hidden');
                    } else if (selectedMethod === 'zelle') {
                        zelleFields.classList.remove('hidden');
                    } else if (selectedMethod === 'paypal') {
                        paypalFields.classList.remove('hidden');
                    }
                    updateSubmitButtonState();
                });
            });
            
            document.querySelectorAll('#paymentModal input').forEach(input => {
                input.addEventListener('input', () => {
                    clearPaymentMessage();
                    updateSubmitButtonState();
                });
            });
            
            // New logic for the "Send Phone In Now" button
            sendPhoneBtn.addEventListener('click', async () => {
                clearQuoteMessage();
                clearHighlights();

                const selectedShippingPreference = document.querySelector('input[name="shipping_preference"]:checked');
                const termsAccepted = document.getElementById('termsAccepted');
                const fullName = document.getElementById('fullName');
                const email = document.getElementById('email');
                const streetAddress = document.getElementById('street-address');
                const city = document.getElementById('city');
                const state = document.getElementById('state');
                const zipCode = document.getElementById('zip-code');
                
                let firstMissingElement = null;
                
                // --- UPDATED STATE VALIDATION (relies on select.value being non-empty) ---
                if (!state.value) { 
                    state.classList.add('highlight-missing'); 
                    if (!firstMissingElement) firstMissingElement = state; 
                } 
                // --- END UPDATED STATE VALIDATION ---

                if (!selectedShippingPreference) {
                    const shippingOptionsContainer = document.getElementById('shippingOptions');
                    if (shippingOptionsContainer) {
                        shippingOptionsContainer.classList.add('highlight-missing');
                        if (!firstMissingElement) firstMissingElement = shippingOptionsContainer;
                    }
                }
                
                // --- MODIFIED VALIDATION: Check phone length (14 chars = (###) ###-####) ---
                const cleanedPhone = phoneInput.value.replace(/\D/g, '');
                if (cleanedPhone.length !== 10) { 
                    phoneInput.classList.add('highlight-missing'); 
                    if (!firstMissingElement) firstMissingElement = phoneInput; 
                    showQuoteMessage('Please enter a complete 10-digit phone number.', 'error');
                    phoneInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }
                // --- END MODIFIED VALIDATION ---

                if (!fullName.value) { fullName.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = fullName; }
                if (!email.value) { email.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = email; }
                if (!streetAddress.value) { streetAddress.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = streetAddress; }
                if (!city.value) { city.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = city; }
                if (!zipCode.value) { zipCode.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = zipCode; }
                if (!termsAccepted.checked) {
                    document.querySelector('#orderOverview .checkmark').classList.add('highlight-missing');
                    if (!firstMissingElement) firstMissingElement = termsAccepted;
                }
                
                if (firstMissingElement) {
                    showQuoteMessage('Please fill out all required fields to proceed.', 'error');
                    firstMissingElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }
                
                // All fields are valid, open the payment modal
                openModal('paymentModal');
            });


            document.querySelectorAll('input[name="shipping_preference"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    document.querySelectorAll('.shipping-option label').forEach(label => label.classList.remove('highlight-missing'));
                    updateOverview();
                });
            });

            const shippingInputs = document.querySelectorAll('#shippingSection input, #shippingSection select');
            shippingInputs.forEach(input => {
                input.addEventListener('input', updateOverview);
            });

            function updateOverview() {
                const selectedShippingPreference = document.querySelector('input[name="shipping_preference"]:checked')?.value;
                const selectedCarrier = document.querySelector('input[name="carrier"]:checked')?.value;
                
                let displayShippingPreferenceText = 'Not Selected';
                if (selectedShippingPreference === 'ship_kit') {
                    displayShippingPreferenceText = 'Shipping Kit Requested';
                } else if (selectedShippingPreference === 'email_label') {
                    displayShippingPreferenceText = 'Email Label Requested';
                }

                let displayCarrierText = 'Not Selected';
                if (selectedCarrier) {
                    switch(selectedCarrier) {
                        case 'unlocked': displayCarrierText = 'Unlocked'; break;
                        case 'att': displayCarrierText = 'AT&T'; break;
                        case 'tmobile': displayCarrierText = 'T-Mobile'; break;
                        case 'verizon': displayCarrierText = 'Verizon'; break;
                        case 'other': displayCarrierText = 'Other Locked Carrier'; break;
                        default: displayCarrierText = 'Not Selected';
                    }
                }

                const fullName = document.getElementById('fullName').value;
                const phone = phoneInput?.value || ''; // Get new phone value
                const streetAddress = streetAddressInput.value;
                const city = cityInput.value;
                const state = stateInput.value;
                const zipCode = zipCodeInput.value;

                overviewQuote.textContent = `$${finalQuote.toFixed(2)}`;
                overviewShippingPreference.textContent = displayShippingPreferenceText;
                overviewCarrier.textContent = displayCarrierText;
                
                // NEW: Update phone overview display
                overviewPhone.textContent = phone || 'Not Entered';

                const fullAddress = [fullName, streetAddress, city, state, zipCode].filter(Boolean).join(', ');
                overviewAddress.textContent = fullAddress || 'Not Entered';
            }

            submitOrderBtn.addEventListener('click', async () => {
                clearPaymentMessage();
                clearHighlights();

                const selectedPayment = document.querySelector('input[name="payment_method"]:checked');
                let firstMissingElement = null;

                if (!selectedPayment) {
                    const paymentOptionsContainer = document.getElementById('paymentOptions');
                    paymentOptionsContainer.classList.add('highlight-missing');
                    firstMissingElement = paymentOptionsContainer;
                } else {
                    if (selectedPayment.value === 'venmo') {
                        const venmoUsername = document.getElementById('venmoUsername');
                        const venmoUsernameConfirm = document.getElementById('venmoUsernameConfirm');
                        if (!venmoUsername.value) { venmoUsername.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = venmoUsername; }
                        if (!venmoUsernameConfirm.value || venmoUsername.value !== venmoUsernameConfirm.value) { venmoUsernameConfirm.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = venmoUsernameConfirm; }
                    } else if (selectedPayment.value === 'zelle') {
                        const zelleIdentifier = document.getElementById('zelleIdentifier');
                        const zelleIdentifierConfirm = document.getElementById('zelleIdentifierConfirm');
                        if (!zelleIdentifier.value) { zelleIdentifier.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = zelleIdentifier; }
                        if (!zelleIdentifierConfirm.value || zelleIdentifier.value !== zelleIdentifierConfirm.value) { zelleIdentifierConfirm.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = zelleIdentifierConfirm; }
                    } else if (selectedPayment.value === 'paypal') {
                        const paypalEmail = document.getElementById('paypalEmail');
                        const paypalEmailConfirm = document.getElementById('paypalEmailConfirm');
                        if (!paypalEmail.value) { paypalEmail.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = paypalEmail; }
                        if (!paypalEmailConfirm.value || paypalEmail.value !== paypalEmailConfirm.value) { paypalEmailConfirm.classList.add('highlight-missing'); if (!firstMissingElement) firstMissingElement = paypalEmailConfirm; }
                    }
                }
                
                if (firstMissingElement) {
                    showPaymentMessage('Please fill out all required fields to proceed.', 'error');
                    firstMissingElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }

                submitOrderBtn.disabled = true;
                submitOrderBtn.textContent = 'Order Submitting...';
                submitOrderBtn.classList.remove('btn-primary-indigo');
                submitOrderBtn.classList.add('btn-disabled');
                
                const orderData = {
                    device: device.name,
                    brand: deviceInfo.brand,
                    modelSlug: deviceInfo.slug,
                    carrier: document.querySelector('input[name="carrier"]:checked').value,
                    storage: document.getElementById('storage').value,
                    condition_power_on: document.querySelector('input[name="q1_power_on"]:checked').value,
                    condition_functional: document.querySelector('input[name="q2_fully_functional"]:checked')?.value || 'N/A',
                    condition_cracks: document.querySelector('input[name="q3_no_cracks"]:checked')?.value || 'N/A',
                    condition_cosmetic: document.querySelector('input[name="q4_cosmetic_condition"]:checked')?.value || 'N/A',
                    estimatedQuote: finalQuote,
                    shippingPreference: document.querySelector('input[name="shipping_preference"]:checked').value === 'ship_kit' ? 'Shipping Kit Requested' : 'Email Label Requested',
                    paymentMethod: selectedPayment.value,
                    paymentDetails: {},
                    shippingInfo: {
                        fullName: document.getElementById('fullName').value,
                        email: document.getElementById('email').value,
                        // MODIFIED: Store the cleaned, unformatted 10-digit number in Firebase
                        phone: phoneInput.value.replace(/\D/g, ''),
                        streetAddress: streetAddressInput.value,
                        city: cityInput.value,
                        state: stateInput.value, // Now guaranteed to be a 2-letter code
                        zipCode: zipCodeInput.value
                    },
                    termsAccepted: document.getElementById('termsAccepted').checked,
                    userId: currentUserId,
                    createdAt: serverTimestamp()
                };
                
                // Add payment details to the order data
                if (selectedPayment.value === 'venmo') {
                    orderData.paymentDetails.venmoUsername = document.getElementById('venmoUsername').value;
                } else if (selectedPayment.value === 'zelle') {
                    orderData.paymentDetails.zelleIdentifier = document.getElementById('zelleIdentifier').value;
                } else if (selectedPayment.value === 'paypal') {
                    orderData.paymentDetails.paypalEmail = document.getElementById('paypalEmail').value;
                }
                
                try {
                    showPaymentMessage('Submitting your order...', 'info');
                    const response = await fetch(`${BACKEND_URL}/submit-order`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(orderData),
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        throw new Error(result.error || 'Failed to submit order.');
                    }
                    
                    // Get order ID from response and estimated price from deviceInfo or orderData
                    const orderId = result.orderId || result.id || Date.now().toString();
                    const totalPrice = deviceInfo.estimatedPrice || orderData.estimatedQuote || finalQuote || '0';

                    try {
                        const summaryPayload = {
                            orderId,
                            quote: parseFloat(totalPrice) || 0,
                            device: {
                                name: orderData.device,
                                brand: orderData.brand,
                                storage: orderData.storage,
                                carrier: orderData.carrier,
                                condition: {
                                    powerOn: orderData.condition_power_on,
                                    functional: orderData.condition_functional,
                                    cracks: orderData.condition_cracks,
                                    cosmetic: orderData.condition_cosmetic
                                }
                            },
                            shippingPreference: orderData.shippingPreference,
                            shippingInfo: orderData.shippingInfo,
                            paymentMethod: orderData.paymentMethod,
                            paymentDetails: orderData.paymentDetails,
                            submittedAt: new Date().toISOString()
                        };

                        localStorage.setItem('secondhandcell:lastOrderSummary', JSON.stringify(summaryPayload));
                    } catch (storageError) {
                        console.warn('Unable to persist order summary for confirmation view:', storageError);
                    }

                    setTimeout(() => {
                        window.location.href = `https://secondhandcell.com/order-submitted.html?shipping=${orderData.shippingPreference === 'Shipping Kit Requested' ? 'ship_kit' : 'email_label'}`;
                    }, 2000);
                    
                } catch (e) {
                    console.error("Error submitting order: ", e);
                    showPaymentMessage('There was an error submitting your order. Please try again.', 'error');
                    
                    submitOrderBtn.disabled = false;
                    submitOrderBtn.textContent = 'Submit Order';
                    submitOrderBtn.classList.remove('btn-disabled');
                    submitOrderBtn.classList.add('btn-primary-indigo');
                }
            });

            function saveFormState() {
                const formState = {
                    storage: document.getElementById('storage').value,
                    carrier: document.querySelector('input[name="carrier"]:checked')?.value,
                    q1_power_on: document.querySelector('input[name="q1_power_on"]:checked')?.value,
                    q2_fully_functional: document.querySelector('input[name="q2_fully_functional"]:checked')?.value,
                    q3_no_cracks: document.querySelector('input[name="q3_no_cracks"]:checked')?.value,
                    q4_cosmetic_condition: document.querySelector('input[name="q4_cosmetic_condition"]:checked')?.value,
                };
                // We're using localStorage for state persistence during page navigation or refresh.
                // In a real-world app, this might be a Firestore document specific to the user.
                localStorage.setItem(`${deviceInfo.brand}-${deviceInfo.slug}-FormState`, JSON.stringify(formState));
            }

            function loadFormState() {
                const savedState = localStorage.getItem(`${deviceInfo.brand}-${deviceInfo.slug}-FormState`);
                if (savedState) {
                    const formState = JSON.parse(savedState);
                    
                    const storageSelect = document.getElementById('storage');
                    storageSelect.value = formState.storage || '';
                    if (storageSelect.value) {
                           // unhide sections based on loaded state
                           carrierSection.classList.remove('hidden');
                           if (formState.carrier) {
                               powerOnSection.classList.remove('hidden');
                               if (formState.q1_power_on) {
                                   if (formState.q1_power_on === 'yes') {
                                       functionalSection.classList.remove('hidden');
                                       if (formState.q2_fully_functional === 'yes') {
                                           cracksSection.classList.remove('hidden');
                                           if (formState.q3_no_cracks === 'yes') {
                                               cosmeticSection.classList.remove('hidden');
                                               if (formState.q4_cosmetic_condition) {
                                                   getQuoteBtn.classList.remove('hidden');
                                               }
                                           } else { // cracked
                                               cosmeticSection.classList.add('hidden');
                                               getQuoteBtn.classList.remove('hidden');
                                           }
                                       } else { // not functional
                                           cracksSection.classList.add('hidden');
                                           cosmeticSection.classList.add('hidden');
                                           getQuoteBtn.classList.remove('hidden');
                                       }
                                   } else { // no power
                                       functionalSection.classList.add('hidden');
                                       cracksSection.classList.add('hidden');
                                       cosmeticSection.classList.add('hidden');
                                       getQuoteBtn.classList.remove('hidden');
                                   }
                               }
                           }
                    }

                    // Re-check radio buttons
                    if (formState.carrier) {
                        const carrierRadio = document.querySelector(`input[name="carrier"][value="${formState.carrier}"]`);
                        if (carrierRadio) carrierRadio.checked = true;
                    }
                    if (formState.q1_power_on) {
                        const powerOnRadio = document.querySelector(`input[name="q1_power_on"][value="${formState.q1_power_on}"]`);
                        if (powerOnRadio) powerOnRadio.checked = true;
                    }
                    if (formState.q2_fully_functional) {
                        const functionalRadio = document.querySelector(`input[name="q2_fully_functional"][value="${formState.q2_fully_functional}"]`);
                        if (functionalRadio) functionalRadio.checked = true;
                    }
                    if (formState.q3_no_cracks) {
                        const cracksRadio = document.querySelector(`input[name="q3_no_cracks"][value="${formState.q3_no_cracks}"]`);
                        if (cracksRadio) cracksRadio.checked = true;
                    }
                    if (formState.q4_cosmetic_condition) {
                        const cosmeticRadio = document.querySelector(`input[name="q4_cosmetic_condition"][value="${formState.q4_cosmetic_condition}"]`);
                        if (cosmeticRadio) {
                            cosmeticRadio.checked = true;
                            cosmeticConditionDescription.textContent = cosmeticDescriptions[formState.q4_cosmetic_condition];
                            cosmeticConditionDescription.classList.remove('hidden');
                        }
                    }
                }
            }
            // Add event listener to footer email signup form
            if (footerEmailSignupForm) {
                footerEmailSignupForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = footerPromoEmailInput.value;
                    const messageContainer = footerSignupMessage;
                    if (!email) {
                        messageContainer.textContent = 'Please enter a valid email address.';
                        messageContainer.className = 'mt-3 text-sm text-center text-red-500';
                        return;
                    }
                    try {
                        const response = await fetch(`${BACKEND_URL}/subscribe-to-newsletter`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ email: email })
                        });
                        const result = await response.json();
                        if (response.ok) {
                            messageContainer.textContent = 'Thank you for subscribing!';
                            messageContainer.className = 'mt-3 text-sm text-center text-green-500';
                            footerPromoEmailInput.value = '';
                        } else {
                            throw new Error(result.error || 'Failed to subscribe.');
                        }
                    } catch (error) {
                        messageContainer.textContent = `Error: ${error.message}`;
                        messageContainer.className = 'mt-3 text-sm text-center text-red-500';
                    }
                });
            }

            loadFormState();
        });
    </script>
</body>
</html>
